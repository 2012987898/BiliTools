"use strict";var e=require("pako"),t=require("path"),n=require("fs"),r=require("axios"),i=require("nodemailer"),o=require("tunnel"),a=require("crypto");require("vm");var s=require("json5");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var f=u(e),l=u(t),d=c(r),p=u(i),g=u(o),m=u(a),h=u(s);const _=["棒","棒唉","棒耶","加油~","UP加油!","支持~","支持支持！","催更啦","顶顶","留下脚印~","干杯","bilibili干杯","o(*￣▽￣*)o","(｡･∀･)ﾉﾞ嗨","(●ˇ∀ˇ●)","( •̀ ω •́ )y","(ง •_•)ง",">.<","^_~"],y=["舰","船","航海","代金券","优惠券","自拍","照","写真","图","提督","车车一局","再来一局","游戏道具"],w=["谢"],v=[65566781,1277481241,1643654862,603676925],T=e=>{try{return Buffer.from(f.gzip(encodeURIComponent(e),{to:"string"}).toString(),"binary").toString("base64")}catch(e){return"Error: 当前字符串不能被Gzip加密"}},b=e=>{try{const t=Buffer.from(e,"base64").toString("binary").split("").map((e=>e.charCodeAt(0))),n=f.inflate(new Uint8Array(t)),r=String.fromCharCode.apply(null,new Uint16Array(n));try{return decodeURIComponent(r)}catch(e){return r}}catch(e){throw new Error("Error: 当前字符串不能被Gzip解密")}},$=Object.prototype.toString;function I(e,t){return $.call(e)===`[object ${t}]`}function O(e){return null!==e&&I(e,"Object")}function S(e){return I(e,"String")}function E(e){return"function"==typeof e}function C(e){const t=e||x(),n=t.getFullYear(),r=t.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}function x(){const e=new Date,t=e.getTime(),n=e.getTimezoneOffset()/60;return new Date(t+36e5*(n+8))}function P(e,t){return Math.ceil(t/e)}function A(e=6e4,t){e=e||6e4;const n=x().getTime()+e,r=new Date(n),i=r.getSeconds(),o=r.getMinutes();return L({hours:r.getHours(),minutes:o,seconds:i},t)}function R(e,t,n){if(n&&"boolean"!=typeof n&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):void 0===t&&(t=e,e=0),e>t){const n=e;e=t,t=n}if(n||e%1||t%1){const n=Math.random();return Math.min(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)}return e+Math.floor(Math.random()*(t-e+1))}function N(e="17:30:00-23:40:00",t){const n=e.split("-"),r=n[0].split(":").map((e=>+e)),i=n[1].split(":").map((e=>+e)),o=R(r[0]??19,i[0]??23);let a=0;a=o==r[0]?R(r[1],59):o==i[0]?R(i[1]):R(59);let s=0;return s=o==r[0]?R(r[2],59):o==i[0]?R(i[2]):R(59),L({seconds:s,hours:o,minutes:a},t)}function L({hours:e,minutes:t,seconds:n},r){let i;switch(n=n||0,r){case"scf":default:i=`${n} ${t} ${e} * * * *`;break;case"fc":i=`${n} ${t} ${e} * * *`;break;case"cfc":i=`corn(${t} ${e} * * *)`}return{value:i,string:`${e}:${t}:${n}`}}function U(){return`${R(1,9)}${function(e,t){let n="";for(let t=0;t<e;t++)n+=q("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return t?n.toLowerCase():n}(10,!0)}0`}function k(e,t){e.includes(t)||e.push(t)}function D(e){return e||{}}function B(e,t=!1){return"object"!=typeof e?e:Array.isArray(e)?e.map((e=>B(e,t))):t?Object.keys(e).reduce(((n,r)=>(n[r]=B(e[r],t),n)),{}):Object.assign({},e)}function j(e,t){return void 0===e||void 0===t?e||t:O(e)&&O(t)?Array.isArray(e)&&Array.isArray(t)?e.concat(t):Object.keys(t).reduce(((n,r)=>(n[r]=j(e[r],t[r]),n)),e):t}function G(e){const t=new URLSearchParams;return Object.keys(e).forEach((n=>{t.append(n,String(e[n]))})),t.toString()}function q(e){return e[R(e.length-1)]}function M(e){return e?e.split("; ").map((e=>e.split("="))):[]}function K(e,t){return e?t&&0!==t.length?function(e){const t=Object.keys(e).reduce(((t,n)=>t+`${n}=${e[n]}; `),"");return t.substring(0,t.length-2||0)}(function(e,t){const n=M(null==t?void 0:t[0]).filter((e=>2===e.length)),r=M(e).concat(n).filter((e=>2===e.length)),i={};for(const e of r)i[e[0]]?i[e[0]]=e[1]:Object.defineProperty(i,e[0],{value:e[1],enumerable:!0,writable:!0});return i}(e,t)):e:""}function H(e,t){if(!e)return null;const n=`(?:^|)${t}=([^;]*)(?:;|$)`,r=e.match(n);return r?r[1]:null}function Y(e){return H(e,"bili_jct")||""}function F(e){return H(e,"LIVE_BUVID")||""}const J={value:""},Q={log:z,error:function(e){z("error",e)},warn:function(e){z("warn",e)},info:function(e){z("info",e)},verbose:function(e){z("verbose",e)},debug:function(e){z("debug",e)}};function z(e,t){const n=x().toString().match(/\w{2}:\w{2}:\w{2}/)[0];if(function(e="debug"){const t=["error","warn","info","verbose","debug"],n=t.indexOf(e);return n>0?t.slice(0,n+1):t}().includes(e)){const e=`[${n}] ${t}`;J.value+=e+"\n"}process.stdout.write(`[${e} ${n}] ${t}\n`)}const W=()=>"QingLong"===process.env.BARK_GROUP||"/ql"===process.env.QL_DIR;class X{static configFileName=function(){const e=W()?"cat_bili_config":"config",t=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(t)?n:`${n}.json`:e+t}();static isQingLongPanel=W()}const V=h.default?h.default:h;function Z(e){try{let t;if((n.existsSync(e)||n.existsSync(e+="5"))&&(t=n.readFileSync(e,"utf-8")),!t)return;return Q.verbose(`读取配置文件 ${e}`),V.parse(t)}catch(e){!function(e){if(!S(e))return;throw new TypeError("配置文件存在，但是无法解析！可能 JSON5 格式不正确！")}(e.message)}}const ee=e=>l.resolve(process.cwd(),e),te=e=>l.resolve(__dirname,"../",e);function ne(e){throw new Error(e||"获取配置失败！未找到配置文件！")}const re=Array.from(new Set([ee("./config/config.dev.json"),ee(`./config/${X.configFileName}`),ee(`./${X.configFileName}`),te(`./config/${X.configFileName}`),te(`./${X.configFileName}`)])),ie=["./config.json",ee("./config/config.json")];function oe(e){let t;const n=Array.isArray(e);if(t=n?e:e.account.filter((e=>e.cookie)),0===t.length)return;if(X.isQingLongPanel)return function(e){const t=process.argv.find((e=>e.includes("--item")||e.includes("-i")||e.includes("-I")));if(!t)return e[0];const n=Number(t.split("=")[1])-1;return!n||n>=e.length||n<0?(Q.warn("似乎想要指定一个不存在的用户，我们将指定第一个用户"),e[0]):e[n]}(t);Q.warn("在单用户场景下配置了多用户，我们将放弃多余的配置");const r=t[0];return n||(r.message=Object.assign(e.message||{},r.message)),r}function ae(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;X.isQingLongPanel&&re.splice(0,1,...ie);for(let e=0;e<re.length;e++){const t=Z(re[e]);if(t)return t}return(()=>{const{BILITOOLS_CONFIG:e,BILI_SCF_CONFIG:t,BILI_CONFIG:n}=process.env,r=e||t||n;if(r)try{return V.parse(b(r))}catch{ne("环境中的配置不是有效的 JSON 字符串！")}})()}function se(e){if(e||ne(),function(e){if(Array.isArray(e))return!0;return Boolean(e.account&&e.account.length)}(e)){const t=oe(e);if(t)return t}return e.cookie||ne("配置文件中没有 cookie！"),e}function ce(e){return e&&e.map((e=>Number(e))).filter((e=>e>0&&e%1==0))}class ue{constructor(e){var t;this.config=e,this.COOKIE=e.cookie,this.BILIJCT=Y(e.cookie),this.USERID=(t=e.cookie,Number(H(t,"DedeUserID"))||0),this.USER_AGENT=e.userAgent;const n=e.apiDelay??[2,6];this.BILI_API_DELAY=Array.isArray(n)?ce(n):[Number(n)];const r=D(e.message);this.MESSAGE_API=r.api,this.PUSHPLUS_TOKEN=r.pushplusToken||process.env.PUSHPLUS_TOKEN;const i=D(e.coin);this.BILI_CUSTOMIZE_UP=ce(i.customizeUp||e.customizeUp)||[],this.BILI_UPPER_ACC_MATCH=!1!==(i.upperAccMatch??e.upperAccMatch),this.BILI_COIN_RETRY_NUM=i.retryNum||e.coinRetryNum||4,this.BILI_TARGET_LEVEL=(i.targetLevel||e.targetLevel)??6,this.BILI_STAY_COINS=(i.stayCoins||e.stayCoins)??0,this.BILI_TARGET_COINS=(i.targetCoins||e.targetCoins)??5;const o=D(e.gift);this.BILI_GIFT_UP=ce(o.mids||e.giftUp)||this.BILI_CUSTOMIZE_UP||[];const a=D(e.charge);this.CHARGE_ID=a.mid||e.chargeUpId||this.USERID,this.CHARGE_PRESET_TIME=a.presetTime||e.chargePresetTime||31;const s=D(e.match);this.MATCH_COINS=(s.coins||e.matchCoins)??5,this.MATCH_SELECTION=(s.selection||e.matchSelection)??1,this.MATCH_DIFF=(s.diff||e.matchDiff)??0;const c=D(e.lottery);this.LOTTERY_EXCLUDE=c.excludeAward||y,this.LOTTERY_INCLUDE=c.includeAward||w,this.LOTTERY_UP_BLACKLIST=c.blackUid||v,this.LOTTERY_MOVE_TAG=c.moveTag,this.LOTTERY_PAGE_NUM=c.pageNum||2}}let fe;const le=new Proxy({},{get:(e,t)=>(fe||pe(),Reflect.get(fe,t)),set:(e,t,n)=>"config"===t&&n?(pe(n),!0):Reflect.set(fe,t,n)});let de=null;function pe(e){e||(e=se(ae())),fe=new ue(se(e)),de=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},de.coinsTask=fe.BILI_TARGET_COINS}function ge(e){const t=le.BILI_API_DELAY;let n;n=1===t.length?1e3*t[0]:1e3*R(t[0]||2,t[1]||6),n=e||n;const r=(new Date).getTime()+parseInt(n,10);for(;(new Date).getTime()<r;);return new Promise((e=>{e("done")}))}var me;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e["应用程序不存在或已被封禁"]=-1]="应用程序不存在或已被封禁",e[e["Access Key错误"]=-2]="Access Key错误",e[e["API校验密匙错误"]=-3]="API校验密匙错误",e[e["调用方对该Method没有权限"]=-4]="调用方对该Method没有权限",e[e["账号未登录"]=-101]="账号未登录",e[e["账号被封停"]=-102]="账号被封停",e[e["积分不足"]=-103]="积分不足",e[e["硬币不足"]=-104]="硬币不足",e[e["验证码错误"]=-105]="验证码错误",e[e["账号非正式会员或在适应期"]=-106]="账号非正式会员或在适应期",e[e["应用不存在或者被封禁"]=-107]="应用不存在或者被封禁",e[e["未绑定手机?"]=-108]="未绑定手机?",e[e["未绑定手机"]=-110]="未绑定手机",e[e["csrf 校验失败"]=-111]="csrf 校验失败",e[e["系统升级中"]=-112]="系统升级中",e[e["账号尚未实名认证"]=-113]="账号尚未实名认证",e[e["请先绑定手机"]=-114]="请先绑定手机",e[e["请先完成实名认证"]=-115]="请先完成实名认证"}(me||(me={}));const he="GET",_e=new Map,ye=e=>[e.method,e.url].join("&");class we{addPending(e){this.removePending(e);const t=ye(e);e.cancelToken||(e.cancelToken=new d.default.CancelToken((e=>{_e.has(t)||_e.set(t,e)})))}removeAllPending(){_e.forEach((e=>{e&&E(e)&&e()})),_e.clear()}removePending(e){const t=ye(e);if(_e.has(t)){const e=_e.get(t);e&&E(e)&&e(),_e.delete(t)}}reset(){_e.clear()}}class ve{constructor(e){const{requestOptions:t}=e;!1===t.withCredentials&&(e.withCredentials=!1),this.options=e,this.axiosInstance=d.default.create(e),this.setupInterceptors()}createAxiosInstance(e){this.axiosInstance=d.default.create(e)}getTransform(){return this.options.transform}getAxios(){return this.axiosInstance}configAxios(e){this.axiosInstance&&this.createAxiosInstance(e)}setHeaders(e){this.axiosInstance&&Object.assign(this.axiosInstance.defaults.headers,this.options.headers,e)}setupInterceptors(){const e=this.getTransform();if(!e)return;const{requsetInterceptors:t,requestInterceptorsCatch:n,responseInterceptors:r,responseInterceptorsCatch:i}=e,o=new we;this.axiosInstance.interceptors.request.use((e=>{var n;const{headers:{ignoreCancelToken:i}}=e;return!(i||(null===(n=this.options.requestOptions)||void 0===n?void 0:n.ignoreCancelToken))&&o.addPending(e),E(r)&&(e=t(e,this.options)),e}),void 0),E(n)&&this.axiosInstance.interceptors.request.use(void 0,n),this.axiosInstance.interceptors.response.use((e=>(e&&o.removePending(e.config),E(r)&&(e=r(e)),e)),void 0),E(i)&&this.axiosInstance.interceptors.response.use(void 0,i)}supportFormData(e){var t;const n={...this.options.headers,...e.headers};return((null==n?void 0:n["Content-Type"])||(null==n?void 0:n["content-type"])||"").includes("application/x-www-form-urlencoded")&&Reflect.has(e,"data")&&(null===(t=e.method)||void 0===t?void 0:t.toUpperCase())!==he&&!S(e.data)?{...e,data:G(e.data)}:e}get(e,t){return S(e)?this.request({...t,method:"GET",url:e}):this.request({...e,method:"GET"})}post(e,t,n){return S(e)?this.request({...n,method:"POST",url:e,data:t}):this.request({...e,method:"POST"})}put(e,t,n){return this.request({...n,method:"PUT",url:e,data:t})}delete(e,t,n){return this.request({...n,method:"DELETE",url:e,data:t})}patch(e,t,n){return this.request({...n,method:"PATCH",url:e,data:t})}request(e){let t=B(e,!0);const n=this.getTransform(),{requestOptions:r}=this.options,i=Object.assign({},r,e.requestOptions),{beforeRequestHook:o,requestCatchHook:a,transformRequestHook:s}=n||{};return E(o)&&(t=o(t,i)),t.requestOptions=i,t=this.supportFormData(t),new Promise(((e,n)=>{this.axiosInstance.request(t).then((t=>{if(E(s))try{const n=s(t,i);e(n)}catch(e){n(e||new Error("请求错误!"))}else e(t)})).catch((e=>{E(a)?n(a(e,i)):n(e)}))}))}}const Te="https://account.bilibili.com",be="https://live.bilibili.com",$e="https://space.bilibili.com",Ie="https://www.bilibili.com/",Oe="https://account.bilibili.com",Se="https://api.live.bilibili.com",Ee="https://api.bilibili.com",Ce="https://manga.bilibili.com",xe="https://api.vc.bilibili.com",Pe={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9"};var Ae=[["/twirp/activity.v1.Activity/ClockIn","ERR_BAD_REQUEST"]];const Re={transformRequestHook:(e,t)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=t;if(r)return e;if(!n)return e.data;const{data:i}=e;return t.isJsonp&&S(i)?function(e){const t=e.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(t)}(i):i},beforeRequestHook:(e,t)=>{var n;const{apiUrl:r}=t;r&&S(r)&&(e.url.startsWith("/")&&r.endsWith("/")?e.url=r+e.url.substring(1):e.url.startsWith("/")||r.endsWith("/")?e.url=`${r}${e.url}`:e.url=`${r}/${e.url}`);const i=e.params||{},o=e.data||!1;return(null===(n=e.method)||void 0===n?void 0:n.toUpperCase())!==he&&(S(i)?(e.url=e.url+i,e.params=void 0):Reflect.has(e,"data")&&e.data?(e.data=o,e.params=i):(e.data=i,e.params=void 0)),e},requsetInterceptors:e=>{const{requestOptions:t}=e;return!0===t.withBiliCookie&&(e.headers.Cookie=le.COOKIE),e},responseInterceptors:e=>{var t;e.config.requestOptions.withBiliCookie&&(le.COOKIE=K(le.COOKIE,(null===(t=e.headers)||void 0===t?void 0:t["set-cookie"])||[]));return e},responseInterceptorsCatch:async e=>{const{requestOptions:t,url:n}=e.config;return Ae.find((t=>t[0]===n&&t[1]===e.code))||0===t.retry?Promise.reject(e):(t.retry||(t.retry=2),t.__retryCount=t.__retryCount||0,t.__retryCount>=t.retry?Promise.reject(e):(t.__retryCount+=1,await ge(t.retryDelay||100),await Ue.request(e.config)))}};function Ne(e){return new ve(j({timeout:1e4,headers:{"Content-Type":Pe["content-type"],"User-Agent":Pe["user-agent"],"accept-language":Pe["accept-language"]},transform:Re,requestOptions:{isReturnNativeResponse:!1,isTransformResponse:!0,ignoreCancelToken:!0,retry:2,withBiliCookie:!0},withCredentials:!0},e||{}))}const Le=Ne({requestOptions:{withBiliCookie:!1}}),Ue=Ne();const ke={silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1};function De(){return{...ke}}function Be(e){const t=function(){const e=De();for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];switch((le.config.function||{})[t]){case!0:!1===n&&(e[t]=!0);break;case!1:!0===n&&(e[t]=!1)}}return e.addCoins||e.shareAndWatch||(e.taskReward=!1),e}();return e.map((e=>t[e.name]?e:null)).filter((e=>e))}function je(){var e;const t=(null===(e=le.config)||void 0===e?void 0:e.message)||{};["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((e=>{const n=t[(r=e,r.toLowerCase().replace(/_(\w)/g,((e,t)=>t.toUpperCase())))]||t[e]||process.env[e];var r;n&&(process.env[e]=n)})),le.PUSHPLUS_TOKEN&&(process.env.PUSH_PLUS_TOKEN=le.PUSHPLUS_TOKEN),function(){process.env.PUSH_KEY&&(Ge=process.env.PUSH_KEY);process.env.QQ_SKEY&&(rt=process.env.QQ_SKEY);process.env.QQ_MODE&&(it=process.env.QQ_MODE);process.env.BARK_PUSH?(qe=process.env.BARK_PUSH.indexOf("https")>-1||process.env.BARK_PUSH.indexOf("http")>-1?process.env.BARK_PUSH:`https://api.day.app/${process.env.BARK_PUSH}`,process.env.BARK_SOUND&&(Me=process.env.BARK_SOUND),process.env.BARK_GROUP&&(Ke=process.env.BARK_GROUP)):qe&&-1===qe.indexOf("https")&&-1===qe.indexOf("http")&&(qe=`https://api.day.app/${qe}`);process.env.TG_BOT_TOKEN&&(He=process.env.TG_BOT_TOKEN);process.env.TG_USER_ID&&(Ye=process.env.TG_USER_ID);process.env.TG_PROXY_AUTH&&(Qe=process.env.TG_PROXY_AUTH);process.env.TG_PROXY_HOST&&(Fe=process.env.TG_PROXY_HOST);process.env.TG_PROXY_PORT&&(Je=process.env.TG_PROXY_PORT);process.env.TG_API_HOST&&(ze=process.env.TG_API_HOST);process.env.DD_BOT_TOKEN&&(We=process.env.DD_BOT_TOKEN,process.env.DD_BOT_SECRET&&(Xe=process.env.DD_BOT_SECRET));process.env.QYWX_KEY&&(Ve=process.env.QYWX_KEY);process.env.QYWX_AM&&(Ze=process.env.QYWX_AM);process.env.IGOT_PUSH_KEY&&(et=process.env.IGOT_PUSH_KEY);process.env.PUSH_PLUS_TOKEN&&(tt=process.env.PUSH_PLUS_TOKEN);process.env.PUSH_PLUS_USER&&(nt=process.env.PUSH_PLUS_USER)}()}let Ge="",qe="",Me="",Ke="QingLong",He="",Ye="",Fe="",Je="",Qe="",ze="api.telegram.org",We="",Xe="",Ve="",Ze="",et="",tt="",nt="",rt="",it="";async function ot(e,t){var n;const r=null===(n=le.config.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const i=Number(r.port)||465,o=p.createTransport({host:r.host,port:i,secure:465===i,auth:{user:r.from,pass:r.pass}}),a=await o.sendMail({from:`${e} <${r.from}>`,to:r.to,subject:e,headers:{"Content-Type":"text/plain; charset=utf-8"},text:t.replace(/\n/g,"\r\n")});Q.info(`邮件消息已发送: ${a.messageId}`)}async function at(e,t){try{const n=le.MESSAGE_API;if(!n)return;const r=n.replace("{title}",e).replace("{text}",t);await Le.get(r)}catch(e){Q.info(`自定义接口消息发送失败: ${e}`),Q.error(e)}}function st(e,t,n=2100){return new Promise((r=>{if(Ge){t=t.replace(/[\n\r]/g,"\n\n");const i={url:Ge.includes("SCT")?`https://sctapi.ftqq.com/${Ge}.send`:`https://sc.ftqq.com/${Ge}.send`,params:`text=${e}&desp=${t}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{Le.post(i).then((e=>{0===e.errno||0===e.data.errno?Q.info("server酱发送通知消息成功🎉"):1024===e.errno?Q.info(`server酱发送通知消息异常: ${e.errmsg}`):Q.info(`server酱发送通知消息异常\n${JSON.stringify(e)}`)})).catch((e=>{Q.info("发送通知调用API失败！！"),Q.info(e)})).finally((()=>{r("")}))}),n)}else r("")}))}function ct(e,t){return new Promise((n=>{if(rt){const r={url:`https://push.xuthus.cc/${it}/${rt}`,headers:{"Content-Type":"application/json"},data:{},params:{}};e=e.replace(/京豆/g,"豆豆"),t=(t=(t=t.replace(/京豆/g,"")).replace(/🐶/g,"")).replace(/红包/g,"H包"),"email"===it?r.data={t:e,c:t}:r.params=`${e}\n\n${t}`;const i=function(e){switch(e){case"send":return"个人";case"group":return"QQ群";case"wx":return"微信";case"ww":return"企业微信";case"email":return"邮件";default:return"未知方式"}};Le.post(r).then((e=>{200===e.code?Q.info(`酷推发送${i(it)}通知消息成功🎉`):400===e.code?Q.info(`QQ酷推(Cool Push)发送${i(it)}推送失败：${e.msg}`):503===e.code?Q.info(`QQ酷推出错，${e.message}：${e.data}`):Q.info(`酷推推送异常: ${JSON.stringify(e)}`)})).catch((e=>{Q.info(`发送${i(it)}通知调用API失败！！`),Q.info(e)})).finally((()=>{n("")}))}else n("")}))}function ut(e,t,n={}){return new Promise((r=>{if(qe){const i={url:`${qe}/${encodeURIComponent(e)}/${encodeURIComponent(t)}?sound=${Me}&group=${Ke}&${G(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Le.get(i).then((e=>{200===e.code?Q.info("Bark APP发送通知消息成功🎉"):Q.info(`Bark APP发送通失败：${e.message}`)})).catch((e=>{Q.info("Bark APP发送通知调用API失败！！"),Q.error(e)})).finally((()=>{r("")}))}r("")}))}function ft(e,t){return new Promise((n=>{if(He&&Ye){const r={url:`https://${ze}/bot${He}/sendMessage`,params:`chat_id=${Ye}&text=${e}\n\n${t}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(Fe&&Je){const e=g.httpsOverHttp({proxy:{host:Fe,port:+Je,proxyAuth:Qe}});Object.assign(r,{httpsAgent:e})}Le.post(r).then((e=>{e.ok?Q.info("Telegram发送通知消息成功🎉。"):400===e.error_code?Q.info("请主动给bot发送一条消息并检查接收用户ID是否正确。"):401===e.error_code&&Q.info("Telegram bot token 填写错误。")})).catch((e=>{Q.info("telegram发送通知消息失败！！"),Q.info(e)})).finally((()=>{n("")}))}else n("")}))}function lt(e,t){return new Promise((n=>{const r={url:`https://oapi.dingtalk.com/robot/send?access_token=${We}`,data:{msgtype:"text",text:{content:` ${e}\n\n${t}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(We){if(Xe){const e=require("crypto"),t=Date.now(),n=e.createHmac("sha256",Xe);n.update(`${t}\n${Xe}`);const i=encodeURIComponent(n.digest("base64"));r.url=`${r.url}&timestamp=${t}&sign=${i}`}Le.post(r).then((e=>{0===e.errcode?Q.info("钉钉发送通知消息成功🎉。"):Q.info(`钉钉发送通知失败：${e.errmsg}`)})).catch((e=>{Q.info("钉钉发送通知消息失败！！"),Q.info(e)})),n("")}else n("")}))}function dt(e,t){return new Promise((n=>{const r={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${Ve}`,data:{msgtype:"text",text:{content:` ${e}\n\n${t}`}},headers:{"Content-Type":"application/json"},timeout:15e3};Ve&&Le.post(r).then((e=>{0===e.errcode?Q.info("企业微信发送通知消息成功🎉。"):Q.info(`企业微信发送通知失败：${e.errmsg}`)})).catch((e=>{Q.info("企业微信发送通知消息失败！！"),Q.info(e)})).finally((()=>{n("")})),n("")}))}function pt(e){const t=Ze.split(",");if(t[2]){const n=t[2].split("|");let r="";for(let t=0;t<n.length;t++){const i="签到号 "+(t+1);e.match(i)&&(r=n[t])}return r||(r=t[2]),r}return"@all"}function gt(e,t){return new Promise((n=>{if(Ze){const r=Ze.split(","),i={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${r[0]}`,corpsecret:`${r[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};Le.post(i).then((i=>{const o=t.replace(/\n/g,"<br/>"),a=JSON.parse(i).access_token;let s;switch(r[4]){case"0":s={msgtype:"textcard",textcard:{title:`${e}`,description:`${t}`,url:"https://github.com/whyour/qinglong",btntxt:"更多"}};break;case"1":s={msgtype:"text",text:{content:`${e}\n\n${t}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${e}`,thumb_media_id:`${r[4]}`,author:"智能助手",content_source_url:"",content:`${o}`,digest:`${t}`}]}}}r[4]||(s={msgtype:"text",text:{content:`${e}\n\n${t}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${pt(t)}`,agentid:`${r[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},Le.post(s).then((e=>{0===e.errcode?Q.info("成员ID:"+pt(t)+"企业微信应用消息发送通知消息成功🎉。"):Q.info(`企业微信应用：${e.errmsg}`)})).catch((e=>{Q.info("成员ID:"+pt(t)+"企业微信应用消息发送通知消息失败！！"),Q.info(e)})).finally((()=>{n("")}))})).catch((e=>{Q.error("企业微信应用消息发送通知消息失败！！")}))}else n("")}))}function mt(e,t,n={}){return new Promise((r=>{if(et){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(et))return Q.info("您所提供的IGOT_PUSH_KEY无效"),void r("");const i={url:`https://push.hellyw.com/${et.toLowerCase()}`,params:`title=${e}&content=${t}&${G(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Le.post(i).then((e=>{"string"==typeof e&&(e=JSON.parse(e)),0===e.ret?Q.info("iGot发送通知消息成功🎉"):Q.info(`iGot发送通知消息失败：${e.errMsg}`)})).catch((e=>{Q.info("发送通知调用API失败！！"),Q.info(e)})).finally((()=>{r("")}))}else r("")}))}function ht(e,t){return new Promise((n=>{if(tt){t=t.replace(/[\n\r]/g,"<br>");const r={url:"https://www.pushplus.plus/send",params:{token:`${tt}`,title:`${e}`,content:`${t}`,topic:`${nt}`},headers:{"Content-Type":" application/json"},timeout:15e3};Le.post(r).then((e=>{200===e.code?Q.info(`push+发送${nt?"一对多":"一对一"}通知消息完成。`):Q.info(`push+发送${nt?"一对多":"一对一"}通知消息失败：${e.msg}`)})).catch((e=>{Q.info(`push+发送${nt?"一对多":"一对一"}通知消息失败！！`),Q.info(e)})).finally((()=>{n("")}))}else n("")}))}async function _t(e,t){Q.info("----【消息推送】----"),e=`Bili-${de.nickname}-${e}`,await async function(e,t,n={},r="\n\n本通知 By：https://github.com/catlair/BiliTools"){je(),t+=r,await Promise.all([st(e,t),ht(e,t)]),await Promise.all([ut(e,t,n),ft(e,t),lt(e,t),dt(e,t),gt(e,t),mt(e,t,n),ot(e,t),at(e,t),ct(e,t)])}(e,t,void 0,"")}const yt=Ne({baseURL:Oe,headers:{"User-Agent":le.USER_AGENT}}),wt=Ne({baseURL:Se,headers:{Referer:Ie,"User-Agent":le.USER_AGENT}}),vt=Ne({baseURL:Ee,headers:{Referer:Ie,"User-Agent":le.USER_AGENT}}),Tt=Ne({baseURL:Ce,headers:{"User-Agent":le.USER_AGENT}}),bt=Ne({baseURL:xe,headers:{"User-Agent":le.USER_AGENT}});function $t(e=3394945){const t=(new Date).getTime();return wt.get(`/xlive/web-room/v1/gift/bag_list?t=${t}&room_id=${e}`)}function It(e=1,t=10){return e>10&&(e=10),wt.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${e}&page_size=${t}`)}function Ot({ruid:e,gift_num:t,bag_id:n,gift_id:r,roomid:i}){const o=le.BILIJCT,a=o,s={gift_id:r,ruid:e,gift_num:t,bag_id:n,biz_id:i,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:o,platform:"pc",biz_code:"Live",csrf_token:a,uid:le.USERID};return wt.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:be}})}function St(){return vt.get("/x/web-interface/nav",{headers:{Origin:Te}})}function Et(){return vt.get("/x/web-interface/coin/today/exp")}function Ct(e=1,t=50,n=-10){return vt.get("/x/relation/tag",{params:{tagid:n,pn:e,ps:t}})}function xt(e,t){return vt.post("/x/relation/tags/addUsers?cross_domain=true",{fids:e,tagids:t,csrf:le.BILIJCT},{headers:{Origin:$e}})}function Pt(e){const t=e.level_info,n=t.current_level;if(n>=le.BILI_TARGET_LEVEL&&(de.coinsTask=0),Q.info(`当前等级: ${t.current_level}`),n>=6){const e=le.config.function;e.shareAndWatch=!1,e.addCoins=!1,e.taskReward=!1,Q.info("已经满级，不需要再投币了，做个白嫖怪吧")}else{const e=t.next_exp-t.current_exp;Q.info(`距离升级还需要 ${e} 经验，预计 ${function(e){if(le.BILI_TARGET_COINS<=0)return e/15;const t=10*le.BILI_TARGET_COINS+15,n=e/t,r=de.money/(le.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(e-r*t)/25+r}(e).toFixed(2)} 天`)}}async function At(e){try{var t;const{data:n}=await yt.get("/site/getCoin");Q.info(`登录成功: ${e.uname}`),Q.info(`硬币余额: ${n.money||0}`),de.nickname=function(e){const t=e.length;return t<=3?e:`${e[0]}**${e[t-1]}`}(e.uname),de.money=n.money||0,de.userLevel=e.level_info.current_level,de.bCoinCouponBalance=(null===(t=e.wallet)||void 0===t?void 0:t.coupon_balance)||0,Pt(e),function(e){let t="";switch(de.vipType=e.vipType,e.vipType){case 0:t="无大会员";break;case 1:t="月度大会员";break;case 2:t="年度大会员"}0===e.vipStatus&&(t="无大会员"===t?t:t+"[已过期]"),Q.info(`大会员状态: ${t}`)}(e)}catch(e){Q.error(`获取硬币信息异常: ${e.message}`),Q.debug(e)}}function Rt(e,t,n=1){return vt.post("/x/web-interface/coin/add",{aid:e,multiply:t,selectLike:n,csrf:le.BILIJCT})}function Nt(e,t=1){return Ue.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:e,multiply:t,csrf:le.BILIJCT})}const Lt="video",Ut="audio",kt="article";async function Dt(e=!0){try{const t=le.USERID,{data:n,message:r,code:i}=await(e?function(e=1,t=50){return Ct(e,t,-10)}():function(e,t=1,n=50,r="desc",i="attention"){return vt.get("/x/relation/followings",{params:{vmid:e,pn:t,ps:n,order:r,order_type:i}})}(t)),o=e?n:n.list;if(!o||0===o.length)return{msg:"-1",data:{}};if(0===i){await ge();const{mid:e}=q(o)||{};return await Gt(e)}return{msg:e?`未获取到特别关注列表: ${i}-${r}`:`未获取到关注列表: ${i}-${r}`,data:{}}}catch(e){return{msg:e.message,data:{}}}}async function Bt(){const e=q([1,3,4,5,160,22,119]);try{const{data:t,message:n,code:r}=await function(e=1,t=3){return vt.get("/x/web-interface/ranking/region",{params:{rid:e,day:t}})}(e,3);if(0==r){const{aid:e,title:n,author:r}=q(t);return{msg:"0",data:{id:Number(e),title:n,author:r}}}return{msg:`未获取到排行信息: ${r}-${n}`,data:{}}}catch(e){return{msg:e.message,data:{}}}}async function jt(){const e=le.BILI_CUSTOMIZE_UP;return 0===e.length?{msg:"-1",data:{}}:await Gt(q(e))}async function Gt(e){try{const{code:t,data:n,message:r}=await function(e){return vt.get(`/x/space/navnum?mid=${e}`)}(e);if(t)return{msg:`通过uid获取视频失败: ${t}-${r}`,data:{}};await ge();const{video:i,audio:o,article:a}=n,{type:s,page:c,index:u}=function([e,t,n]){const r=e+t+n;if(!r)return;const i=R(0,r-1);let o=i;if(i<e)return{type:Lt,page:P(30,o+1),index:o%30};const a=e+t;return o=i-e,i<a?{type:Ut,page:P(30,o+1),index:o%30}:(o=i-a,{type:kt,page:P(12,o+1),index:o%12})}([i,o,a]),f={[Lt]:qt,[Ut]:Mt,[kt]:Kt},l=await f[s](e,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(e){return Q.debug(e),{msg:e.message,data:{}}}}async function qt(e,t,n){const{code:r,data:i,message:o}=await function(e,t=30,n=1,r=""){return vt.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:t,mid:e}})}(e,30,t);if(r)return{message:o};const{aid:a,title:s,author:c}=i.list.vlist[n];return{type:Lt,id:a,title:s,author:c}}async function Mt(e,t,n){const{code:r,data:i,msg:o}=await function(e,t=30,n=1){return vt.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:t,uid:e}})}(e,30,t);if(r)return{message:o};const{data:a}=i,{id:s,uname:c,title:u}=a[n];return{type:Ut,id:s,title:u,author:c}}async function Kt(e,t,n){const{code:r,data:i,message:o}=await function(e,t=12,n=1){return vt.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:t,mid:e},requestOptions:{isJsonp:!0}})}(e,12,t);if(r)return{message:o};const{articles:a}=i,{id:s,title:c,author:{name:u}}=a[n];return{type:kt,id:s,title:c,author:u,mid:e}}const Ht=function(){const e=[jt,Dt,()=>Dt(!1),Bt];return le.BILI_CUSTOMIZE_UP||e.shift(),e}();async function Yt(e=0){Ht.splice(0,de.currentStartFun+e);for(let e=0;e<Ht.length;e++){const t=Ht[e];let n=Number(le.BILI_COIN_RETRY_NUM??4);for(n=n<1?1:n>8?8:n;n--;){await ge();const e=await t();if("-1"===e.msg&&(n=0),"0"===e.msg)return e}n<=0&&(de.currentStartFun=e)}return{msg:"-1",data:{id:0}}}async function Ft({id:e,coin:t=1,type:n="video",mid:r}){const i={[Lt]:Rt,[Ut]:Nt,[kt]:(e,t=1)=>function(e,t,n=1){return vt.post("/x/web-interface/coin/add",{aid:t,upid:e,avtype:2,multiply:n,csrf:le.BILIJCT})}(r,e,t)},o=await i[n](Number(e),t);return{code:o.code,message:o.message||o.msg}}async function Jt(e){if(await async function(){try{const{data:e,code:t}=await Et();if(0==t){const t=le.BILI_TARGET_COINS-e/10;de.coinsTask=t>0?t:0}}catch(e){}}(),de.coinsTask<=0||de.money<=0)return!0;const{data:t,msg:n}=await Yt(e.priority);return null!=t&&t.id&&"0"==n?(await ge(),await async function(e,t){const{id:n,title:r,author:i,type:o,mid:a}=e;try{const e=await Ft({id:n,type:o,mid:a});if(0===e.code)de.money--,de.coinsTask--,t.num++,Q.info(`给[${r}--up【${i}】]投币成功`);else if(34005===e.code)t.fillCount++,Q.verbose(`当前稿件[${n}]不能再投币了`),t.fillCount>=3&&(Q.warn("自定义用户组投币似乎没有币可投了"),t.priority++);else{if(-111===e.code||-104===e.code)return Q.warn(`${n} ${e.message} 无法继续进行投币`),!0;if(t.eCount++,Q.warn(`给${n}投币失败 ${e.code} ${e.message}`),t.prevCode===e.code)return!0;t.prevCode=e.code}}catch(e){t.eCount++,Q.error(`投币异常 ${e.message}`)}finally{await ge(1500)}return!1}(t,e)):(e.eCount++,!1)}async function Qt(){try{const{data:e,code:t,message:n}=await bt.get("/link_group/v1/member/my_groups");return 0===t?(null==e?void 0:e.list)||[]:(Q.warn(`获取自己的应援团异常失败: ${n}`),[])}catch(e){Q.error(`获取自己的应援团异常: ${e}`)}}const zt=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","_(:3」∠)_","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)","(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","（#-_-)┯━┯","(╯°口°)╯(┴—┴","←◡←","( ♥д♥)","Σ>―(〃°ω°〃)♡→","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","(╬ﾟдﾟ)▄︻┻┳═一","･*･:≡(　ε:)","(汗)","(苦笑)"].concat("1","2","3","4","5","6","7","8","9","签到","哈哈");async function Wt(){try{const{code:e,message:t,data:n}=await function(e=1,t=256,n=1){return wt.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${e}&page_size=${t}&target_id=${n}`)}(1,256,le.USERID);return 0!==e?(Q.verbose(`获取勋章信息失败 ${e} ${t}`),null):n}catch(e){return Q.error(`获取勋章异常 ${e.message}`),null}}async function Xt(e,t){const n=zt[R(zt.length-1)];try{const{code:r,message:i}=await function(e,t){const n=le.BILIJCT,r=n;return t||(t=R(10).toString()),wt.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:t,rnd:Date.now(),roomid:e,bubble:0,csrf:n,csrf_token:r})}(e,n);return 0===r||(11e3===r?(Q.warn(`【${t}】${e}-可能未开启评论`),!1):(Q.warn(`【${t}】${e}-发送失败 ${i}`),Q.verbose(`code: ${r}`),!1))}catch(e){Q.verbose(`发送弹幕异常 ${e.message}`)}}async function Vt(){try{const{data:e,message:t,code:n}=await St();if(0!==n)return void Q.warn(`获取用户信息失败：${n} ${t}`);!function(e){var t;de.bCoinCouponBalance=(null===(t=e.wallet)||void 0===t?void 0:t.coupon_balance)||0}(e)}catch(e){Q.error(`获取用户信息异常：${e.message}`)}}var Zt;async function en(e){try{const t=function(e){switch(e){case 1:return"B 币券";case 2:return"大会员优惠券";default:return""}}(e),{code:n,message:r}=await function(e=1){return vt.post("/x/vip/privilege/receive",{csrf:le.BILIJCT,type:e})}(e);let i="成功";return 0===n&&(i=`失败 ${r}`),Q.info(`领取${t} ${i}`),!0}catch(e){Q.error(`领取权益出现异常：${e.message}`)}return!1}async function tn(e){let t=0,n=!1;for(;!(n||(n=await en(e),t>2));)t++;return n}!function(e){e[e["成功"]=4]="成功",e[e["低于20电池"]=-2]="低于20电池",e[e["B币不足"]=-4]="B币不足"}(Zt||(Zt={}));let nn=0;async function rn(){try{const{data:{list:e}}=await $t();return e.filter((e=>{if(e.expire_at<=0)return!1;const t=(1e3*e.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(e.gift_id);return n&&t&&Q.info(`${e.gift_name} 即将过期请尽快投喂`),!n&&t}))}catch(e){if(nn)return null;await rn(),nn++}}async function on(e){try{const{data:{live_room:t,name:n}}=await function(e){return vt.get(`/x/space/acc/info?mid=${e}&jsonp=jsonp`)}(e);if(await ge(),t.roomStatus)return{roomid:t.roomid,name:n}}catch{}}function an(e,t,n,r){const i=le.BILIJCT,o={is_fav:0,main_id:t,oid:e,detail_id:n,count:r,csrf:i,csrf_token:i};return vt.post("/x/esports/guess/add",o)}function sn(){return de.money-le.MATCH_COINS<le.BILI_TARGET_COINS&&(Q.info(`需要保留${le.BILI_TARGET_COINS}个硬币，任务结束`),!0)}function cn(e,t,n,r,i){const o=Y(le.COOKIE),a=o,s=[F(le.COOKIE),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))];return{ua:le.USER_AGENT,id:[n,t,i,e],csrf_token:o,csrf:a,device:s,uname:r}}async function un(){try{await Ue.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat")}catch{}}async function fn(e){const{data:{area_id:t,parent_area_id:n,room_id:r}}=await function(e){return wt.get(`/room/v1/Room/get_info?room_id=${e}&from=room`)}(e);return{room_id:r,area_id:t,parent_area_id:n}}async function ln(e,t){const n={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:e.ua,visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token};try{const{data:r,code:i}=await function(e){return Ue.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",e)}(n);if(0===i)return Q.info(`进入【${e.uname}】的直播间`),t.v++,r}catch(e){Q.verbose(e)}}async function dn(e,t,n){if(n.v>6)return;const r={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ets:e.timestamp,benchmark:e.secret_key,time:60,ts:(new Date).getTime(),ua:t.ua},i=function(e,t){const[n,r,i,o]=JSON.parse(e.id),[a,s]=JSON.parse(e.device),{ets:c,time:u,ts:f}=e,l={platform:"web",parent_id:n,area_id:r,seq_id:i,room_id:o,buvid:a,uuid:s,ets:c,time:u,ts:f},d=e.benchmark,p=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let g=JSON.stringify(l);for(const e of t)g=m.createHmac(p[e],d).update(g).digest("hex");return g}(r,e.secret_rule);try{const{data:e,code:o,message:a}=await function(e){return Ue.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",e)}(Object.assign({visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token,s:i},r));return 0===o?(Q.info(`向【${t.uname}】发送第${n.v}次心跳`),n.v++):Q.warn(`向【${t.uname}】发送第${n.v}次心跳失败 ${o} ${a}`),e}catch(e){Q.verbose(e)}}async function pn(e=1,t=10){try{const{code:n,message:r,data:i}=await It(e,t);return 0!==n?(Q.verbose(`获取直播间失败 ${n} ${r}`),null):i}catch(e){return Q.verbose(`获取直播间异常 ${e.message}`),null}}async function gn(e=!0){const t=await async function(){let e=0;try{var t,n;const{data:r,code:i}=await $t();return 0!==i||(null===(t=r.list)||void 0===t?void 0:t.length)<=0?24:(null===(n=r.list)||void 0===n||n.forEach((t=>{if(30607===t.gift_id){const n=(1e3*t.expire_at-(new Date).getTime())/864e5;n>6&&n<=7&&(e+=t.gift_num)}})),e>=24?0:24-e)}catch(e){}return 24}();let n;return e?n=await async function(){const{items:e,page_info:t}=await pn();let{total_page:n}=t;if(n&&n>1){n=n>3?3:n;for(let t=2;t<=n;t++){const n=await pn(t,10);e.push(...n.items)}}return e}():({items:n}=await pn()),{fansMedalList:n,heartNum:t}}async function mn(e,t,n,r){if(!r.v||t[n])return await un(),await ge(500),0===r.v?t[n]=await ln(e,r):t[n]=await dn(t[n],e,r),"done"}async function hn(e,t){const n=[];let r=0;for(let i=0;i<6;i++){let o=0;if(o>=t)break;const a=e.length;r=0;for(let s=0;s<a&&!(o>=t);s++){const t=(new Date).getTime(),a=e[s],{roomid:c,uname:u}=a,{room_id:f,area_id:l,parent_area_id:d}=await fn(c),p=cn(f,l,d,u,i);await mn(p,n,s,{v:i}),await ge(2e3),r+=(new Date).getTime()-t,o++}i<5&&await ge(6e4-r)}return"done"}async function _n(e){let t,n;if(e){const{d:r,hn:i}=JSON.parse(e);t="string"==typeof r?JSON.parse(b(r)):r||[{seq:{v:0}}],n=i||{v:0}}else t=[{seq:{v:0}}],n={v:0};let r=0;if(t[0]&&!t[0].seq.v){t.length=0;const{heartNum:e,fansMedalList:i}=await gn();n.v=e;for(const e of i){if(0===n.v)return Q.info("今日获取小星星已经达到 24"),0;if(r>=n.v)break;const{roomid:i,uname:o}=e,{room_id:a,area_id:s,parent_area_id:c}=await fn(i),u={v:0},f=cn(a,s,c,o,u.v);await un(),await ge(500);const l=await ln(f,u);t.push({data:l,baseData:f,seq:u}),r++}}else{!function(e){const t=F(le.COOKIE),n=Y(le.COOKIE),r=le.USER_AGENT;e.forEach((e=>{e.baseData.ua=r,e.baseData.csrf=e.baseData.csrf_token=n,e.baseData.device[0]=t,e.baseData.id[2]=e.seq.v}))}(t);for(const e of t)if(await un(),e.data&&(e.data=await dn(e.data,e.baseData,e.seq)),await ge(1e3),r++,e.seq.v>5&&(e.seq.v=0,r>=n.v))return Q.info("今日获取小心心完成"),0;if(t.find((e=>e.seq.v>5)))return 1}return function(e){e.forEach((e=>{delete e.baseData.csrf,delete e.baseData.csrf_token,delete e.baseData.ua,e.baseData.device[0]=0}))}(t),{d:T(JSON.stringify(t)),hn:n,l:t.length}}async function yn(e){const{data:t,code:n}=await vt.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return t.find((t=>t.name===e));Q.warn(`获取分组列表失败: ${n}`)}async function wn(e){const t=await yn(e);if(t)return t.tagid;await ge(300);const{data:n,code:r,message:i}=await(o=e,vt.post("/x/relation/tag/create",{tag:o,jsonp:"jsonp",csrf:le.BILIJCT}));var o;if(22106===r){await ge(300);const t=await yn(e);return t&&t.tagid}return 0!==r&&Q.warn(`创建分组失败: ${r}-${i}`),n.tagid}async function vn(e,t,n,r=1){if(e.length>t.length)return;const{data:i,code:o,message:a}=await Ct(r,20,0);if(0===o){for(const{mid:r,uname:o}of i){if(e.length>=t.length)return;if(r===n)return;(t.includes(r)||t.includes(o))&&e.push({mid:r,uname:o})}if(!(i.length<20))return await vn(e,t,n,r+1)}else Q.warn(`获取关注用户失败: ${o}-${a}`)}const Tn=0,bn=1,$n=5,In=1,On=504,Sn=1096;let En;async function Cn(){try{const{data:e,code:t,message:n}=await wt.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==t&&Q.info(`获取直播分区失败: ${t}-${n}`),e.data.map((e=>e.list)).map((e=>e.map((e=>({areaId:e.id,parentId:e.parent_id})))))}catch(e){throw Q.error(`获取直播分区异常: ${e.message}`),e}}async function xn(e,t,n=1){try{await ge(100);const{data:r,code:i,message:o}=await function(e,t,n=1){return wt.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${e}&area_id=${t}&page=${n}`)}(t,e,n);return 0!==i&&Q.info(`获取直播间列表失败: ${i}-${o}`),function(e){const t=[],n=[];return e.forEach((e=>{const r=e.pendant_info[2];r&&(r.pendent_id===On?t.push(e):r.pendent_id===Sn&&n.push(e))})),{lotteryTime:t,lotteryPacket:n}}(r.list).lotteryTime}catch(e){throw Q.error(`获取直播间列表异常: ${e.message}`),e}}async function Pn(e,t,n=1){const r=await xn(e,t,n),i=[];for(const e of r){const t=await An(e);t&&(i.push({...t,uid:e.uid,uname:e.uname}),await ge(100))}return i}async function An(e){if(le.LOTTERY_UP_BLACKLIST.includes(e.uid))return void Q.info(`跳过黑名单用户: ${e.uname}`);let t,n,r;try{({data:n,code:t,message:r}=await(i=e.roomid,wt.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${i}`)))}catch(t){return void Q.info(`直播间${e.roomid}检测异常: ${t.message}`)}var i;if(0!==t)return void Q.debug(`直播间${e.roomid}检测失败: ${t}-${r}`);if(null===n)return;const o=le.LOTTERY_EXCLUDE.some((e=>n.award_name.match(e)));if(!le.LOTTERY_INCLUDE.some((e=>n.award_name.match(e)))&&o)Q.info(`跳过屏蔽奖品: ${n.award_name}`);else if(n.status!==In);else if(n.gift_price>0);else{if(n.require_type===Tn||n.require_type===bn)return n;if(n.require_type===$n&&de.userLevel>=n.require_value)return n}}async function Rn(e){try{const{id:n,gift_id:r,gift_num:i,award_name:o,uid:a,uname:s,require_type:c,require_text:u}=e;Q.info(`天选主播：【${s}】`),Q.info(`奖品：${o}`);const{code:f,message:l}=await(t={id:n,gift_id:r,gift_num:i},wt.post("/xlive/lottery-interface/v1/Anchor/Join",{...t,csrf:le.BILIJCT,csrf_token:le.BILIJCT,visit_id:U(),platform:"pc"}));if(0!==f)return void Q.info(`天选失败: ${f}-${l}`);if(Q.info("天选成功 √"),c===bn){k(En,a);(function(e){const t=(e=e.replace("关注主播","")).split(/\s*\+\s*/);return t.shift(),t})(u).forEach((e=>k(En,e)))}}catch(e){Q.info(`天选异常: ${e.message}`)}var t}async function Nn(e,t,n=2){for(let r=1;r<=n;r++){const n=await Pn(e,t,r);for(const e of n)await Rn(e),await ge(300)}}var Ln={taskReward:async function(){Q.info("----【每日任务完成情况】----");try{const{data:e,message:t,code:n}=await vt.get("/x/member/web/exp/reward");await ge();const{data:r}=await Et();if(0!=n)return void Q.warn(`状态获取失败: ${n} ${t}`);const i=de.money-le.BILI_STAY_COINS;let o=0;0===de.coinsTask?Q.info(`今日投币获取经验: ${r}，还需投币0颗，经验够了，不想投了`):i<=0?Q.info(`今日投币获取经验: ${r}，还需投币0颗，硬币不够了，不投币了`):i<de.coinsTask?(o=de.coinsTask-i,Q.info(`投币获取经验: ${r}，还需投币数量: ${o}颗;(目标${de.coinsTask}颗，忽略部分投币)`)):(o=de.coinsTask-r/10,Q.info(`投币获取经验: ${r}，还需投币数量: ${o}颗;(目标${de.coinsTask}颗)`)),de.coinsTask=o,Q.info("每日分享: "+(e.share?"已完成":"[未完成]")),Q.info("每日播放: "+(e.watch?"已完成":"[未完成]")),de.share=e.share,de.watch=e.watch}catch(e){Q.error(`状态获取异常 ${e.message}`)}},liveSignTask:async function(){Q.info("----【直播签到】----");try{const{data:e}=await wt.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===e.status)return Q.info("已签到，跳过签到"),void Q.info(`已经签到${e.hadSignDays}天，${e.specialText}`)}catch(e){}try{const{code:e,data:t,message:n}=await wt.get("/xlive/web-ucenter/v1/sign/DoSign");0===e?Q.info(`直播签到成功: ${t.text}，特别信息: ${t.specialText}，本月签到天数: ${t.hadSignDays}天;`):Q.warn(`直播签到失败: ${e} ${n}`)}catch(e){Q.error(`直播签到异常: ${e.message}`)}},shareAndWatch:async function(){if(Q.info("----【分享/播放视频】----"),de.share&&de.watch)return void Q.info("已完成，跳过分享/播放");let e=0;try{let t=await Yt();if("-1"===t.msg&&(t=await Bt()),"0"!==t.msg)return Q.warn(`获取视频失败 ${t.msg}`),!1;{const{id:n,author:r,title:i}=t.data;e=n,Q.info(`获取视频: ${i} --up【${r}】`)}}catch(e){return Q.error(`获取视频出现异常: ${e.message}`),!1}if(!de.share){await ge();try{const{code:t,message:n}=await function(e){const t={csrf:le.BILIJCT,aid:e};return vt.post("/x/web-interface/share/add",t)}(e);0===t?Q.info("分享视频成功!"):Q.warn(`分享视频失败: ${t} ${n}`)}catch(e){Q.error(`分享视频异常: ${e.message}`)}}if(!de.watch){await ge();try{const{code:r,message:i}=await(t=e,n=R(4,60),vt.post("/x/click-interface/web/heartbeat",{aid:t,played_time:n}));0===r?Q.info("播放视频成功!"):Q.warn(`播放视频失败: ${r} ${i}`)}catch(e){Q.error(`播放视频异常: ${e.message}`)}}var t,n},silver2Coin:async function(){Q.info("----【银瓜子兑换硬币】----");try{const{data:e,code:t,message:n}=await wt.get("/xlive/revenue/v1/wallet/getStatus");if(0!=t&&Q.info(`获取瓜子详情失败 ${n}`),0===e.silver_2_coin_left)Q.info("今日已兑换一次");else if(e.silver<700)Q.info("兑换失败，你瓜子不够了");else{const{message:e}=await wt.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:le.BILIJCT,csrf:le.BILIJCT});Q.info(`兑换硬币： ${e}`),await wt.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(e){Q.error(`操作异常 ${e.message}`)}},addCoins:async function(){if(Q.info("----【视频投币】----"),!de.coinsTask)return void Q.info("跳过投币，今日已完成");const e={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let t=!1;for(;de.coinsTask&&!t&&e.eCount<5;)t=await Jt(e);e.eCount>=5&&Q.info("出现异常/错误5次，自动退出投币"),Q.info(`一共成功投币${e.num}颗`),Q.info(`硬币还剩${de.money}颗`)},mangaSign:async function(){Q.info("----【漫画签到】----");try{const{code:e}=await function(e="android"){return Tt.post("/twirp/activity.v1.Activity/ClockIn",{platform:e})}();0==e?Q.info("漫画签到成功"):Q.warn("漫画签到失败")}catch(t){var e;400===(null===(e=t.response)||void 0===e?void 0:e.status)?Q.info("已经签到过了，跳过任务"):Q.error(`漫画签到异常 ${t.message}`)}},supGroupSign:async function(){Q.info("----【应援团签到】----");const e=await Qt();await ge();let t=0;for(let i=0;i<e.length;){const o=e[i];try{const{data:e,code:i,message:a}=await(n=o.group_id,r=o.owner_uid,bt.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===i?0===e.status?t++:Q.info(a):Q.warn(`[${o.group_name}]签到失败 ${a}`)}catch(e){Q.error(`签到异常 ${e.message}`)}finally{await ge()}}var n,r;Q.info(`签到结束，成功${t}/${e.length}`)},liveSendMessage:async function(){Q.info("----【发送直播弹幕】----");const e=await async function(){const{list:e,special_list:t}=await Wt();return e.push(...t),e}(),t=e.length;let n=0,r=0;Q.info(`一共需要发送${t}个直播间`),Q.verbose("所需时间可能很长，请耐心等待");for(let i=0;i<t;i++){const{room_info:o,anchor_info:a,medal:s}=e[i];null!=o&&o.room_id?100===s.today_feed||s.guard_level>0?r++:(await Xt(o.room_id,a.nick_name)&&n++,i<t-1&&await ge(R(1e4,25e3))):(Q.info(`【${a.nick_name}】没有直播间哦`),r++)}Q.info(`成功发送${n}个弹幕，跳过${r}个`)},charging:async function(){if(Q.info("----【给目标充电】----"),await Vt(),await ge(),function(){const e=x(),t=e.getDate(),n=C(e),r=le.CHARGE_PRESET_TIME;return de.bCoinCouponBalance<2?(Q.info(`剩余券为${de.bCoinCouponBalance}，不足2跳过充电`),!1):n===t?(Q.info("今天是最后一天了"),!0):!(r>t&&(Q.info(`预设时间为${r}，不符合条件`),1))}())try{const e=de.bCoinCouponBalance||0,t=le.CHARGE_ID;let n=0;Q.info(`b 币券余额${e}`);const r=async()=>{const{code:n,message:r,data:i}=await function(e=50,t=!0,n=le.USERID,r="up",i=n){return vt.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:le.BILIJCT,bp_num:e,is_bp_remains_prior:t,up_mid:n,otype:r,oid:i})}(e,!0,t);0===n?(Q.info(`【充值结果】${Zt[i.status]}`),i.status===Zt["成功"]&&(de.chargeOrderNo=i.order_no,await ge(),await async function(){try{if(!de.chargeOrderNo)return!1;const e=_[R(0,_.length-1)],{code:t}=await function(e,t="支持大佬一波"){return vt.post("/x/ugcpay/trade/elec/message",{csrf:le.BILIJCT,message:t,order_id:e})}(de.chargeOrderNo,e);0===t&&Q.info("留言成功！")}catch{}}())):Q.warn(`充电失败：${n} ${r}`)};for(de.chargeOrderNo="";!(de.chargeOrderNo||(await r(),await ge(),n++>2)););}catch(e){Q.error(`充电出现异常：${e.message}`)}},getVipPrivilege:async function(){Q.info("----【领取大会员权益】----"),function(){if(2!==de.vipType)return Q.info("账号非年度大会员，不需要领取权益"),!1;const e=x(),t=e.getDate(),n=C(e);return 1===t||n===t||(Q.info("今天非预订领取时间，跳过领取"),!1)}()&&(await tn(1),await tn(2))},giveGift:async function(){Q.info("----【投喂过期食物】----");try{const e=await rn();if(await ge(),null==e||!e.length)return void Q.info("没有2天内过期的简单礼物");const t=await async function(){const e=Object.assign([],le.BILI_GIFT_UP),t=()=>e.splice(R(le.BILI_GIFT_UP.length-1),1)[0];for(;e.length;){const e=t(),n=await on(e);if(n)return{mid:e,...n}}return await async function(){const{data:{count:e,items:t}}=await It();if(await ge(),!e)return;const n=t[R(t.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!t)return void Q.info("没有找到投喂目标");await async function({roomid:e,mid:t,name:n},r){for(const i of r){await ge();try{const{code:r,message:o,data:a}=await Ot({roomid:e,ruid:t,bag_id:i.bag_id,gift_id:i.gift_id,gift_num:i.gift_num});if(0!==r){Q.warn(`向[${n}]投喂[${i.gift_name}]，${o}`);continue}a.gift_list.forEach((e=>{Q.info(`成功给 [${n}] 投喂${e.gift_name}`)}))}catch{}}}(t,e)}catch(e){Q.info(`投喂过期食物异常 ${e}`)}},matchGame:async function(){if(Q.info("----【赛事硬币竞猜】----"),le.MATCH_COINS<=0)return void Q.info("硬币数量不能小于 0");if(sn())return;const e=await async function(){try{const{code:e,message:t,data:{list:n,page:r}}=await function(e="",t=""){return vt.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${e}&etime=${t}`)}();return 0!==e?void Q.warn(`获取赛事错误 ${e} ${t}`):0===r.total?(Q.info("今日已经无法获取赛事"),null):n}catch(e){}}();if(await ge(),!e)return;const t=await async function(e){let t=0;try{for(const n of e){const{contest:e,questions:r}=n,i=e.id,[{id:o,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(sn())return t;if(c)continue;Q.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=le.MATCH_SELECTION>0?l?f:u:l?u:f,Q.info(`预测[ ${d.option} ] ${le.MATCH_COINS} 颗硬币`),await ge();const{code:p}=await an(i,o,d.detail_id,le.MATCH_COINS);0!==p?Q.info("预测失败"):(t++,de.money-=le.MATCH_COINS)}}catch(e){console.warn(e.message)}return t}(function(e,t){return e.filter((e=>{const{questions:n}=e,[{details:r,is_guess:i}]=n;if(i)return!1;const[o,a]=r;return Math.abs(o.odds-a.odds)>=t}))}(e,le.MATCH_DIFF));Q.info(`【竞猜结束】一共参与${t}次预测`)},liveHeart:async function(){Q.info("----【直播心跳】----");const{heartNum:e,fansMedalList:t}=await gn(),n=t&&t.length;if(!n)return void Q.info("没有勋章列表");const r=Math.ceil(e/n);for(let n=0;n<r;n++)await hn(t,e);Q.info("完成")},liveLottery:async function(){Q.info("----【天选时刻】----");try{const e=await async function(){const{data:e,code:t}=await Ct(1,1,0);if(0!==t)throw new Error(`获取最后一个关注失败: ${t}`);return e[0]}();Q.info(`最后一个关注的UP: ${e.uname}`);const t=await async function(){En=[];const e=await Cn();for(const t of e)for(const e of t)await Nn(e.areaId,e.parentId,le.LOTTERY_PAGE_NUM);return En}();Q.info("扫描完成");const n=[];await vn(n,t,null==e?void 0:e.mid),await async function(e,t="天选时刻"){if(0===e.length)return;const n=await wn(t);if(n)for(const t of e){const{code:e,message:r}=await xt(t.mid,n);0!==e&&Q.warn(`移动【${t.uname}】失败: ${e}-${r}`),await ge()}}(n),Q.info("移动关注UP到分组成功")}catch(e){Q.warn(`天选时刻异常: ${e.message}`),Q.debug(e)}Q.info("结束天选时刻")}};async function Un(e,...t){J.value="";try{await async function(){Q.info("----【登录】----");const{data:e,message:t,code:n}=await St();if(0!==n)throw Q.error(`登录错误 ${n} ${t}`),new Error(t);if(!e.isLogin)throw new Error("接口返回为未登录");await ge(),await At(e)}()}catch(e){return Q.error(`登录失败: ${e}`),await _t("登录失败",J.value),"未完成"}const n=Be([...Object.values(Ln)]);for(const e of n)await e(),await ge();return e&&await e(...t),await _t("每日完成",J.value),"完成"}function kn(e,t){return"scf"===e?t.Message:t.payload}async function Dn(e,t,n){const r="scf"===e?(await Promise.resolve().then((function(){return vc}))).default:(await Promise.resolve().then((function(){return Tc}))).default;return(...e)=>r(t,n,...e)}var Bn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jn=function(e){return e&&e.Math==Math&&e},Gn=jn("object"==typeof globalThis&&globalThis)||jn("object"==typeof window&&window)||jn("object"==typeof self&&self)||jn("object"==typeof Bn&&Bn)||function(){return this}()||Function("return this")(),qn={},Mn=function(e){try{return!!e()}catch(e){return!0}},Kn=!Mn((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Hn=!Mn((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Yn=Hn,Fn=Function.prototype.call,Jn=Yn?Fn.bind(Fn):function(){return Fn.apply(Fn,arguments)},Qn={},zn={}.propertyIsEnumerable,Wn=Object.getOwnPropertyDescriptor,Xn=Wn&&!zn.call({1:2},1);Qn.f=Xn?function(e){var t=Wn(this,e);return!!t&&t.enumerable}:zn;var Vn,Zn,er=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},tr=Hn,nr=Function.prototype,rr=nr.bind,ir=nr.call,or=tr&&rr.bind(ir,ir),ar=tr?function(e){return e&&or(e)}:function(e){return e&&function(){return ir.apply(e,arguments)}},sr=ar,cr=sr({}.toString),ur=sr("".slice),fr=function(e){return ur(cr(e),8,-1)},lr=ar,dr=Mn,pr=fr,gr=Gn.Object,mr=lr("".split),hr=dr((function(){return!gr("z").propertyIsEnumerable(0)}))?function(e){return"String"==pr(e)?mr(e,""):gr(e)}:gr,_r=Gn.TypeError,yr=function(e){if(null==e)throw _r("Can't call method on "+e);return e},wr=hr,vr=yr,Tr=function(e){return wr(vr(e))},br=function(e){return"function"==typeof e},$r=br,Ir=function(e){return"object"==typeof e?null!==e:$r(e)},Or=Gn,Sr=br,Er=function(e){return Sr(e)?e:void 0},Cr=function(e,t){return arguments.length<2?Er(Or[e]):Or[e]&&Or[e][t]},xr=ar({}.isPrototypeOf),Pr=Gn,Ar=Cr("navigator","userAgent")||"",Rr=Pr.process,Nr=Pr.Deno,Lr=Rr&&Rr.versions||Nr&&Nr.version,Ur=Lr&&Lr.v8;Ur&&(Zn=(Vn=Ur.split("."))[0]>0&&Vn[0]<4?1:+(Vn[0]+Vn[1])),!Zn&&Ar&&(!(Vn=Ar.match(/Edge\/(\d+)/))||Vn[1]>=74)&&(Vn=Ar.match(/Chrome\/(\d+)/))&&(Zn=+Vn[1]);var kr=Zn,Dr=Mn,Br=!!Object.getOwnPropertySymbols&&!Dr((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&kr&&kr<41})),jr=Br&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Gr=Cr,qr=br,Mr=xr,Kr=jr,Hr=Gn.Object,Yr=Kr?function(e){return"symbol"==typeof e}:function(e){var t=Gr("Symbol");return qr(t)&&Mr(t.prototype,Hr(e))},Fr=Gn.String,Jr=function(e){try{return Fr(e)}catch(e){return"Object"}},Qr=br,zr=Jr,Wr=Gn.TypeError,Xr=function(e){if(Qr(e))return e;throw Wr(zr(e)+" is not a function")},Vr=Xr,Zr=function(e,t){var n=e[t];return null==n?void 0:Vr(n)},ei=Jn,ti=br,ni=Ir,ri=Gn.TypeError,ii={exports:{}},oi=Gn,ai=Object.defineProperty,si=function(e,t){try{ai(oi,e,{value:t,configurable:!0,writable:!0})}catch(n){oi[e]=t}return t},ci=si,ui=Gn["__core-js_shared__"]||ci("__core-js_shared__",{}),fi=ui;(ii.exports=function(e,t){return fi[e]||(fi[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.22.6",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.6/LICENSE",source:"https://github.com/zloirock/core-js"});var li=yr,di=Gn.Object,pi=function(e){return di(li(e))},gi=ar({}.hasOwnProperty),mi=Object.hasOwn||function(e,t){return gi(pi(e),t)},hi=ar,_i=0,yi=Math.random(),wi=hi(1..toString),vi=function(e){return"Symbol("+(void 0===e?"":e)+")_"+wi(++_i+yi,36)},Ti=Gn,bi=ii.exports,$i=mi,Ii=vi,Oi=Br,Si=jr,Ei=bi("wks"),Ci=Ti.Symbol,xi=Ci&&Ci.for,Pi=Si?Ci:Ci&&Ci.withoutSetter||Ii,Ai=function(e){if(!$i(Ei,e)||!Oi&&"string"!=typeof Ei[e]){var t="Symbol."+e;Oi&&$i(Ci,e)?Ei[e]=Ci[e]:Ei[e]=Si&&xi?xi(t):Pi(t)}return Ei[e]},Ri=Jn,Ni=Ir,Li=Yr,Ui=Zr,ki=function(e,t){var n,r;if("string"===t&&ti(n=e.toString)&&!ni(r=ei(n,e)))return r;if(ti(n=e.valueOf)&&!ni(r=ei(n,e)))return r;if("string"!==t&&ti(n=e.toString)&&!ni(r=ei(n,e)))return r;throw ri("Can't convert object to primitive value")},Di=Ai,Bi=Gn.TypeError,ji=Di("toPrimitive"),Gi=function(e,t){if(!Ni(e)||Li(e))return e;var n,r=Ui(e,ji);if(r){if(void 0===t&&(t="default"),n=Ri(r,e,t),!Ni(n)||Li(n))return n;throw Bi("Can't convert object to primitive value")}return void 0===t&&(t="number"),ki(e,t)},qi=Yr,Mi=function(e){var t=Gi(e,"string");return qi(t)?t:t+""},Ki=Ir,Hi=Gn.document,Yi=Ki(Hi)&&Ki(Hi.createElement),Fi=function(e){return Yi?Hi.createElement(e):{}},Ji=!Kn&&!Mn((function(){return 7!=Object.defineProperty(Fi("div"),"a",{get:function(){return 7}}).a})),Qi=Kn,zi=Jn,Wi=Qn,Xi=er,Vi=Tr,Zi=Mi,eo=mi,to=Ji,no=Object.getOwnPropertyDescriptor;qn.f=Qi?no:function(e,t){if(e=Vi(e),t=Zi(t),to)try{return no(e,t)}catch(e){}if(eo(e,t))return Xi(!zi(Wi.f,e,t),e[t])};var ro={},io=Kn&&Mn((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),oo=Gn,ao=Ir,so=oo.String,co=oo.TypeError,uo=function(e){if(ao(e))return e;throw co(so(e)+" is not an object")},fo=Kn,lo=Ji,po=io,go=uo,mo=Mi,ho=Gn.TypeError,_o=Object.defineProperty,yo=Object.getOwnPropertyDescriptor;ro.f=fo?po?function(e,t,n){if(go(e),t=mo(t),go(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=yo(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return _o(e,t,n)}:_o:function(e,t,n){if(go(e),t=mo(t),go(n),lo)try{return _o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw ho("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var wo=ro,vo=er,To=Kn?function(e,t,n){return wo.f(e,t,vo(1,n))}:function(e,t,n){return e[t]=n,e},bo={exports:{}},$o=Kn,Io=mi,Oo=Function.prototype,So=$o&&Object.getOwnPropertyDescriptor,Eo=Io(Oo,"name"),Co={EXISTS:Eo,PROPER:Eo&&"something"===function(){}.name,CONFIGURABLE:Eo&&(!$o||$o&&So(Oo,"name").configurable)},xo=br,Po=ui,Ao=ar(Function.toString);xo(Po.inspectSource)||(Po.inspectSource=function(e){return Ao(e)});var Ro,No,Lo,Uo=Po.inspectSource,ko=br,Do=Uo,Bo=Gn.WeakMap,jo=ko(Bo)&&/native code/.test(Do(Bo)),Go=ii.exports,qo=vi,Mo=Go("keys"),Ko={},Ho=jo,Yo=Gn,Fo=ar,Jo=Ir,Qo=To,zo=mi,Wo=ui,Xo=function(e){return Mo[e]||(Mo[e]=qo(e))},Vo=Ko,Zo=Yo.TypeError,ea=Yo.WeakMap;if(Ho||Wo.state){var ta=Wo.state||(Wo.state=new ea),na=Fo(ta.get),ra=Fo(ta.has),ia=Fo(ta.set);Ro=function(e,t){if(ra(ta,e))throw new Zo("Object already initialized");return t.facade=e,ia(ta,e,t),t},No=function(e){return na(ta,e)||{}},Lo=function(e){return ra(ta,e)}}else{var oa=Xo("state");Vo[oa]=!0,Ro=function(e,t){if(zo(e,oa))throw new Zo("Object already initialized");return t.facade=e,Qo(e,oa,t),t},No=function(e){return zo(e,oa)?e[oa]:{}},Lo=function(e){return zo(e,oa)}}var aa={set:Ro,get:No,has:Lo,enforce:function(e){return Lo(e)?No(e):Ro(e,{})},getterFor:function(e){return function(t){var n;if(!Jo(t)||(n=No(t)).type!==e)throw Zo("Incompatible receiver, "+e+" required");return n}}},sa=Mn,ca=br,ua=mi,fa=Kn,la=Co.CONFIGURABLE,da=Uo,pa=aa.enforce,ga=aa.get,ma=Object.defineProperty,ha=fa&&!sa((function(){return 8!==ma((function(){}),"length",{value:8}).length})),_a=String(String).split("String"),ya=bo.exports=function(e,t,n){if("Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!ua(e,"name")||la&&e.name!==t)&&ma(e,"name",{value:t,configurable:!0}),ha&&n&&ua(n,"arity")&&e.length!==n.arity&&ma(e,"length",{value:n.arity}),n&&ua(n,"constructor")&&n.constructor){if(fa)try{ma(e,"prototype",{writable:!1})}catch(e){}}else e.prototype=void 0;var r=pa(e);return ua(r,"source")||(r.source=_a.join("string"==typeof t?t:"")),e};Function.prototype.toString=ya((function(){return ca(this)&&ga(this).source||da(this)}),"toString");var wa=br,va=To,Ta=bo.exports,ba=si,$a={},Ia=Math.ceil,Oa=Math.floor,Sa=Math.trunc||function(e){var t=+e;return(t>0?Oa:Ia)(t)},Ea=function(e){var t=+e;return t!=t||0===t?0:Sa(t)},Ca=Ea,xa=Math.max,Pa=Math.min,Aa=Ea,Ra=Math.min,Na=function(e){return e>0?Ra(Aa(e),9007199254740991):0},La=function(e){return Na(e.length)},Ua=Tr,ka=function(e,t){var n=Ca(e);return n<0?xa(n+t,0):Pa(n,t)},Da=La,Ba=function(e){return function(t,n,r){var i,o=Ua(t),a=Da(o),s=ka(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},ja={includes:Ba(!0),indexOf:Ba(!1)},Ga=mi,qa=Tr,Ma=ja.indexOf,Ka=Ko,Ha=ar([].push),Ya=function(e,t){var n,r=qa(e),i=0,o=[];for(n in r)!Ga(Ka,n)&&Ga(r,n)&&Ha(o,n);for(;t.length>i;)Ga(r,n=t[i++])&&(~Ma(o,n)||Ha(o,n));return o},Fa=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");$a.f=Object.getOwnPropertyNames||function(e){return Ya(e,Fa)};var Ja={};Ja.f=Object.getOwnPropertySymbols;var Qa=Cr,za=$a,Wa=Ja,Xa=uo,Va=ar([].concat),Za=Qa("Reflect","ownKeys")||function(e){var t=za.f(Xa(e)),n=Wa.f;return n?Va(t,n(e)):t},es=mi,ts=Za,ns=qn,rs=ro,is=Mn,os=br,as=/#|\.prototype\./,ss=function(e,t){var n=us[cs(e)];return n==ls||n!=fs&&(os(t)?is(t):!!t)},cs=ss.normalize=function(e){return String(e).replace(as,".").toLowerCase()},us=ss.data={},fs=ss.NATIVE="N",ls=ss.POLYFILL="P",ds=ss,ps=Gn,gs=qn.f,ms=To,hs=function(e,t,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:t;return wa(n)&&Ta(n,o,r),r.global?i?e[t]=n:ba(t,n):(r.unsafe?e[t]&&(i=!0):delete e[t],i?e[t]=n:va(e,t,n)),e},_s=si,ys=function(e,t,n){for(var r=ts(t),i=rs.f,o=ns.f,a=0;a<r.length;a++){var s=r[a];es(e,s)||n&&es(n,s)||i(e,s,o(t,s))}},ws=ds,vs={},Ts=Xr,bs=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Ts(t),this.reject=Ts(n)};vs.f=function(e){return new bs(e)};var $s=Xr,Is=Hn,Os=ar(ar.bind),Ss={},Es=Ss,Cs=Ai("iterator"),xs=Array.prototype,Ps={};Ps[Ai("toStringTag")]="z";var As=Gn,Rs="[object z]"===String(Ps),Ns=br,Ls=fr,Us=Ai("toStringTag"),ks=As.Object,Ds="Arguments"==Ls(function(){return arguments}()),Bs=Rs?Ls:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=ks(e),Us))?n:Ds?Ls(t):"Object"==(r=Ls(t))&&Ns(t.callee)?"Arguments":r},js=Zr,Gs=Ss,qs=Ai("iterator"),Ms=function(e){if(null!=e)return js(e,qs)||js(e,"@@iterator")||Gs[Bs(e)]},Ks=Jn,Hs=Xr,Ys=uo,Fs=Jr,Js=Ms,Qs=Gn.TypeError,zs=Jn,Ws=uo,Xs=Zr,Vs=function(e,t){return $s(e),void 0===t?e:Is?Os(e,t):function(){return e.apply(t,arguments)}},Zs=Jn,ec=uo,tc=Jr,nc=function(e){return void 0!==e&&(Es.Array===e||xs[Cs]===e)},rc=La,ic=xr,oc=function(e,t){var n=arguments.length<2?Js(e):t;if(Hs(n))return Ys(Ks(n,e));throw Qs(Fs(e)+" is not iterable")},ac=Ms,sc=function(e,t,n){var r,i;Ws(e);try{if(!(r=Xs(e,"return"))){if("throw"===t)throw n;return n}r=zs(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Ws(r),n},cc=Gn.TypeError,uc=function(e,t){this.stopped=e,this.result=t},fc=uc.prototype,lc=Jn,dc=Xr,pc=Cr,gc=vs,mc=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},hc=function(e,t,n){var r,i,o,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=Vs(t,f),m=function(e){return r&&sc(r,"normal",e),new uc(!0,e)},h=function(e){return l?(ec(e),p?g(e[0],e[1],m):g(e[0],e[1])):p?g(e,m):g(e)};if(d)r=e;else{if(!(i=ac(e)))throw cc(tc(e)+" is not iterable");if(nc(i)){for(o=0,a=rc(e);a>o;o++)if((s=h(e[o]))&&ic(fc,s))return s;return new uc(!1)}r=oc(e,i)}for(c=r.next;!(u=Zs(c,r)).done;){try{s=h(u.value)}catch(e){sc(r,"throw",e)}if("object"==typeof s&&s&&ic(fc,s))return s}return new uc(!1)};(function(e,t){var n,r,i,o,a,s=e.target,c=e.global,u=e.stat;if(n=c?ps:u?ps[s]||_s(s,{}):(ps[s]||{}).prototype)for(r in t){if(o=t[r],i=e.dontCallGetSet?(a=gs(n,r))&&a.value:n[r],!ws(c?r:s+(u?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;ys(o,i)}(e.sham||i&&i.sham)&&ms(o,"sham",!0),hs(n,r,o,e)}})({target:"Promise",stat:!0},{any:function(e){var t=this,n=pc("AggregateError"),r=gc.f(t),i=r.resolve,o=r.reject,a=mc((function(){var r=dc(t.resolve),a=[],s=0,c=1,u=!1;hc(e,(function(e){var f=s++,l=!1;c++,lc(r,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[f]=e,--c||o(new n(a,"No one promise resolved")))}))})),--c||o(new n(a,"No one promise resolved"))}));return a.error&&o(a.value),r.promise}});const _c=async e=>{Q.warn(e||"SCF从6.1号其将不再拥有免费额度，暂时可以购买1元额度，请自行购买，谢谢！")};async function yc(e,t){return _c(),await async function({event:e,context:t,slsType:n}){const r=kn(n,e),i=await Dn(n,e,t);let o;try{o=JSON.parse(r)}catch(e){}return o&&o.lastTime===x().getDate().toString()?"今日重复执行":await Un(i)}({event:e,context:t,slsType:"scf"})}async function wc(e,t){return _c(),await async function({event:e,context:t,slsType:n}){const r=kn(n,e),i=await Dn(n,e,t);let o;try{o=JSON.parse(r)}catch(e){}if(o&&!o.d&&o.lastTime===x().getDate().toString())return"今日重复执行";const a=await _n(r);return 0===a?(await i(),"今日完成"):1===a?(await i({hn:{v:0},d:[{seq:{v:0}}]},A(5e3,n)),"等待继续下一轮心跳"):(await i(a,A(62e3-1e3*a.l,n)),"等待继续下次心跳")}({event:e,context:t,slsType:"scf"})}Q.info("开始执行网络代码"),Q.info("当前版本【vWed May 25 10:20:07 UTC 2022-dev】"),(async()=>{"heart_bili_timer"!==event.TriggerName?(VMThis.message=await yc(event,context),VMThis.resolve(VMThis.message)):VMThis.message=await wc(event,context)})();var vc=Object.freeze({__proto__:null,default:async function(e,t,n,r,i=2){if(!e.TriggerName)return!1;if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return Q.info("环境变量不存在TENCENT_SECRET_ID和TENCENT_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return u(require("tencentcloud-sdk-nodejs"))}))}catch{Q.warn("tencentcloud-sdk-nodejs not found")}}();if(!o)return!1;const a=o.scf.v20180416.Client,s=t.function_name,c=e.TriggerName,f=new a({credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:t.tencentcloud_region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}});async function l(){const e=r||N(le.config.dailyRunTime,"scf"),t={FunctionName:s,TriggerName:c,Type:"timer",TriggerDesc:e.value,Qualifier:"$DEFAULT"},i=await async function(){try{const{Triggers:e}=await f.ListTriggers({FunctionName:s});return-1!==(null==e?void 0:e.findIndex((e=>e.TriggerName===c)))}catch({code:e,message:t}){return Q.error(`获取trigger失败 ${e} => ${t}`),!1}}();if(Q.info(`修改时间为：${e.string}`),i){const e=await async function(e){try{return await f.DeleteTrigger(e)}catch({code:e,message:t}){return Q.warn(`删除trigger失败 ${e} => ${t}`),!1}}(t);if(!e)return}return!!await async function(e){const t=x();e.CustomArgument=JSON.stringify({...n,lastTime:t.getDate().toString()});try{return await f.CreateTrigger(e)}catch({code:e,message:t}){return Q.error(`创建trigger失败 ${e} => ${t}`),!1}}(t)}let d=!1;for(;!d&&i;)d=await l(),i--;return d}});var Tc=Object.freeze({__proto__:null,default:async function(e,t,n,r,i=2){if(!e.triggerName)return!1;if(!process.env.ALI_SECRET_ID||!process.env.ALI_SECRET_KEY)return Q.info("环境变量不存在ALI_SECRET_ID和ALI_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return u(require("@alicloud/fc2"))}))}catch{Q.warn("@alicloud/fc2 not found")}}();if(!o)return!1;const a=o.default,s=t.function.name,c=e.triggerName,f=t.service.name,l=new a(t.accountId,{accessKeyID:process.env.ALI_SECRET_ID,accessKeySecret:process.env.ALI_SECRET_KEY,region:t.region});async function d(){const e=r||N(le.config.dailyRunTime,"fc");return Q.info(`修改时间为：${e.string}`),!!await async function(e){const t=x(),r=`CRON_TZ=Asia/Shanghai ${e}`;try{return await l.updateTrigger(f,s,c,{triggerConfig:{cronExpression:r,payload:JSON.stringify({...n,lastTime:t.getDate().toString()})}})}catch(e){return Q.error(`更新trigger失败 ${e.message}`),!1}}(e.value)}let p=!1;for(;!p&&i;)p=await d(),i--;return p}});
