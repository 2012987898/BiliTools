"use strict";var t=require("zlib"),e=require("crypto"),n=require("path"),r=require("fs");require("vm");var i=require("nodemailer"),o=require("got"),a=require("json5");function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function c(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var u=c(e),f=c(n),l=c(r),d=c(i),p=s(o),g=c(a);const m=["棒","棒唉","棒耶","加油~","UP加油!","支持~","支持支持！","催更啦","顶顶","留下脚印~","干杯","bilibili干杯","o(*￣▽￣*)o","(｡･∀･)ﾉﾞ嗨","(●ˇ∀ˇ●)","( •̀ ω •́ )y","(ง •_•)ง",">.<","^_~"];var h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y=function(t){return t&&t.Math==Math&&t},_=y("object"==typeof globalThis&&globalThis)||y("object"==typeof window&&window)||y("object"==typeof self&&self)||y("object"==typeof h&&h)||function(){return this}()||Function("return this")(),w={},v=function(t){try{return!!t()}catch(t){return!0}},b=!v((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),$=!v((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),T=$,S=Function.prototype.call,I=T?S.bind(S):function(){return S.apply(S,arguments)},O={},E={}.propertyIsEnumerable,C=Object.getOwnPropertyDescriptor,P=C&&!E.call({1:2},1);O.f=P?function(t){var e=C(this,t);return!!e&&e.enumerable}:E;var x,k,L=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},N=$,R=Function.prototype,A=R.bind,U=R.call,j=N&&A.bind(U,U),B=N?function(t){return t&&j(t)}:function(t){return t&&function(){return U.apply(t,arguments)}},D=B,G=D({}.toString),M=D("".slice),q=function(t){return M(G(t),8,-1)},F=v,H=q,K=Object,J=B("".split),Y=F((function(){return!K("z").propertyIsEnumerable(0)}))?function(t){return"String"==H(t)?J(t,""):K(t)}:K,z=TypeError,Q=function(t){if(null==t)throw z("Can't call method on "+t);return t},W=Y,V=Q,X=function(t){return W(V(t))},Z=function(t){return"function"==typeof t},tt=Z,et=function(t){return"object"==typeof t?null!==t:tt(t)},nt=_,rt=Z,it=function(t){return rt(t)?t:void 0},ot=function(t,e){return arguments.length<2?it(nt[t]):nt[t]&&nt[t][e]},at=B({}.isPrototypeOf),st=_,ct=ot("navigator","userAgent")||"",ut=st.process,ft=st.Deno,lt=ut&&ut.versions||ft&&ft.version,dt=lt&&lt.v8;dt&&(k=(x=dt.split("."))[0]>0&&x[0]<4?1:+(x[0]+x[1])),!k&&ct&&(!(x=ct.match(/Edge\/(\d+)/))||x[1]>=74)&&(x=ct.match(/Chrome\/(\d+)/))&&(k=+x[1]);var pt=k,gt=v,mt=!!Object.getOwnPropertySymbols&&!gt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&pt&&pt<41})),ht=mt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,yt=ot,_t=Z,wt=at,vt=Object,bt=ht?function(t){return"symbol"==typeof t}:function(t){var e=yt("Symbol");return _t(e)&&wt(e.prototype,vt(t))},$t=String,Tt=function(t){try{return $t(t)}catch(t){return"Object"}},St=Z,It=Tt,Ot=TypeError,Et=function(t){if(St(t))return t;throw Ot(It(t)+" is not a function")},Ct=Et,Pt=function(t,e){var n=t[e];return null==n?void 0:Ct(n)},xt=I,kt=Z,Lt=et,Nt=TypeError,Rt={exports:{}},At=_,Ut=Object.defineProperty,jt=function(t,e){try{Ut(At,t,{value:e,configurable:!0,writable:!0})}catch(n){At[t]=e}return e},Bt=jt,Dt=_["__core-js_shared__"]||Bt("__core-js_shared__",{}),Gt=Dt;(Rt.exports=function(t,e){return Gt[t]||(Gt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.8",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.8/LICENSE",source:"https://github.com/zloirock/core-js"});var Mt=Q,qt=Object,Ft=function(t){return qt(Mt(t))},Ht=Ft,Kt=B({}.hasOwnProperty),Jt=Object.hasOwn||function(t,e){return Kt(Ht(t),e)},Yt=B,zt=0,Qt=Math.random(),Wt=Yt(1..toString),Vt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Wt(++zt+Qt,36)},Xt=_,Zt=Rt.exports,te=Jt,ee=Vt,ne=mt,re=ht,ie=Zt("wks"),oe=Xt.Symbol,ae=oe&&oe.for,se=re?oe:oe&&oe.withoutSetter||ee,ce=function(t){if(!te(ie,t)||!ne&&"string"!=typeof ie[t]){var e="Symbol."+t;ne&&te(oe,t)?ie[t]=oe[t]:ie[t]=re&&ae?ae(e):se(e)}return ie[t]},ue=I,fe=et,le=bt,de=Pt,pe=function(t,e){var n,r;if("string"===e&&kt(n=t.toString)&&!Lt(r=xt(n,t)))return r;if(kt(n=t.valueOf)&&!Lt(r=xt(n,t)))return r;if("string"!==e&&kt(n=t.toString)&&!Lt(r=xt(n,t)))return r;throw Nt("Can't convert object to primitive value")},ge=TypeError,me=ce("toPrimitive"),he=function(t,e){if(!fe(t)||le(t))return t;var n,r=de(t,me);if(r){if(void 0===e&&(e="default"),n=ue(r,t,e),!fe(n)||le(n))return n;throw ge("Can't convert object to primitive value")}return void 0===e&&(e="number"),pe(t,e)},ye=bt,_e=function(t){var e=he(t,"string");return ye(e)?e:e+""},we=et,ve=_.document,be=we(ve)&&we(ve.createElement),$e=function(t){return be?ve.createElement(t):{}},Te=$e,Se=!b&&!v((function(){return 7!=Object.defineProperty(Te("div"),"a",{get:function(){return 7}}).a})),Ie=b,Oe=I,Ee=O,Ce=L,Pe=X,xe=_e,ke=Jt,Le=Se,Ne=Object.getOwnPropertyDescriptor;w.f=Ie?Ne:function(t,e){if(t=Pe(t),e=xe(e),Le)try{return Ne(t,e)}catch(t){}if(ke(t,e))return Ce(!Oe(Ee.f,t,e),t[e])};var Re={},Ae=b&&v((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ue=et,je=String,Be=TypeError,De=function(t){if(Ue(t))return t;throw Be(je(t)+" is not an object")},Ge=b,Me=Se,qe=Ae,Fe=De,He=_e,Ke=TypeError,Je=Object.defineProperty,Ye=Object.getOwnPropertyDescriptor;Re.f=Ge?qe?function(t,e,n){if(Fe(t),e=He(e),Fe(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=Ye(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return Je(t,e,n)}:Je:function(t,e,n){if(Fe(t),e=He(e),Fe(n),Me)try{return Je(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Ke("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var ze=Re,Qe=L,We=b?function(t,e,n){return ze.f(t,e,Qe(1,n))}:function(t,e,n){return t[e]=n,t},Ve={exports:{}},Xe=b,Ze=Jt,tn=Function.prototype,en=Xe&&Object.getOwnPropertyDescriptor,nn=Ze(tn,"name"),rn={EXISTS:nn,PROPER:nn&&"something"===function(){}.name,CONFIGURABLE:nn&&(!Xe||Xe&&en(tn,"name").configurable)},on=Z,an=Dt,sn=B(Function.toString);on(an.inspectSource)||(an.inspectSource=function(t){return sn(t)});var cn,un,fn,ln=an.inspectSource,dn=Z,pn=ln,gn=_.WeakMap,mn=dn(gn)&&/native code/.test(pn(gn)),hn=Rt.exports,yn=Vt,_n=hn("keys"),wn=function(t){return _n[t]||(_n[t]=yn(t))},vn={},bn=mn,$n=_,Tn=B,Sn=et,In=We,On=Jt,En=Dt,Cn=wn,Pn=vn,xn=$n.TypeError,kn=$n.WeakMap;if(bn||En.state){var Ln=En.state||(En.state=new kn),Nn=Tn(Ln.get),Rn=Tn(Ln.has),An=Tn(Ln.set);cn=function(t,e){if(Rn(Ln,t))throw new xn("Object already initialized");return e.facade=t,An(Ln,t,e),e},un=function(t){return Nn(Ln,t)||{}},fn=function(t){return Rn(Ln,t)}}else{var Un=Cn("state");Pn[Un]=!0,cn=function(t,e){if(On(t,Un))throw new xn("Object already initialized");return e.facade=t,In(t,Un,e),e},un=function(t){return On(t,Un)?t[Un]:{}},fn=function(t){return On(t,Un)}}var jn={set:cn,get:un,has:fn,enforce:function(t){return fn(t)?un(t):cn(t,{})},getterFor:function(t){return function(e){var n;if(!Sn(e)||(n=un(e)).type!==t)throw xn("Incompatible receiver, "+t+" required");return n}}},Bn=v,Dn=Z,Gn=Jt,Mn=b,qn=rn.CONFIGURABLE,Fn=ln,Hn=jn.enforce,Kn=jn.get,Jn=Object.defineProperty,Yn=Mn&&!Bn((function(){return 8!==Jn((function(){}),"length",{value:8}).length})),zn=String(String).split("String"),Qn=Ve.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Gn(t,"name")||qn&&t.name!==e)&&Jn(t,"name",{value:e,configurable:!0}),Yn&&n&&Gn(n,"arity")&&t.length!==n.arity&&Jn(t,"length",{value:n.arity});try{n&&Gn(n,"constructor")&&n.constructor?Mn&&Jn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Hn(t);return Gn(r,"source")||(r.source=zn.join("string"==typeof e?e:"")),t};Function.prototype.toString=Qn((function(){return Dn(this)&&Kn(this).source||Fn(this)}),"toString");var Wn=Z,Vn=We,Xn=Ve.exports,Zn=jt,tr={},er=Math.ceil,nr=Math.floor,rr=Math.trunc||function(t){var e=+t;return(e>0?nr:er)(e)},ir=function(t){var e=+t;return e!=e||0===e?0:rr(e)},or=ir,ar=Math.max,sr=Math.min,cr=ir,ur=Math.min,fr=function(t){return t>0?ur(cr(t),9007199254740991):0},lr=function(t){return fr(t.length)},dr=X,pr=function(t,e){var n=or(t);return n<0?ar(n+e,0):sr(n,e)},gr=lr,mr=function(t){return function(e,n,r){var i,o=dr(e),a=gr(o),s=pr(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},hr={includes:mr(!0),indexOf:mr(!1)},yr=Jt,_r=X,wr=hr.indexOf,vr=vn,br=B([].push),$r=function(t,e){var n,r=_r(t),i=0,o=[];for(n in r)!yr(vr,n)&&yr(r,n)&&br(o,n);for(;e.length>i;)yr(r,n=e[i++])&&(~wr(o,n)||br(o,n));return o},Tr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Sr=$r,Ir=Tr.concat("length","prototype");tr.f=Object.getOwnPropertyNames||function(t){return Sr(t,Ir)};var Or={};Or.f=Object.getOwnPropertySymbols;var Er=ot,Cr=tr,Pr=Or,xr=De,kr=B([].concat),Lr=Er("Reflect","ownKeys")||function(t){var e=Cr.f(xr(t)),n=Pr.f;return n?kr(e,n(t)):e},Nr=Jt,Rr=Lr,Ar=w,Ur=Re,jr=function(t,e,n){for(var r=Rr(e),i=Ur.f,o=Ar.f,a=0;a<r.length;a++){var s=r[a];Nr(t,s)||n&&Nr(n,s)||i(t,s,o(e,s))}},Br=v,Dr=Z,Gr=/#|\.prototype\./,Mr=function(t,e){var n=Fr[qr(t)];return n==Kr||n!=Hr&&(Dr(e)?Br(e):!!e)},qr=Mr.normalize=function(t){return String(t).replace(Gr,".").toLowerCase()},Fr=Mr.data={},Hr=Mr.NATIVE="N",Kr=Mr.POLYFILL="P",Jr=Mr,Yr=_,zr=w.f,Qr=We,Wr=function(t,e,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:e;return Wn(n)&&Xn(n,o,r),r.global?i?t[e]=n:Zn(e,n):(r.unsafe?t[e]&&(i=!0):delete t[e],i?t[e]=n:Vn(t,e,n)),t},Vr=jt,Xr=jr,Zr=Jr,ti=function(t,e){var n,r,i,o,a,s=t.target,c=t.global,u=t.stat;if(n=c?Yr:u?Yr[s]||Vr(s,{}):(Yr[s]||{}).prototype)for(r in e){if(o=e[r],i=t.dontCallGetSet?(a=zr(n,r))&&a.value:n[r],!Zr(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;Xr(o,i)}(t.sham||i&&i.sham)&&Qr(o,"sham",!0),Wr(n,r,o,t)}},ei=$,ni=Function.prototype,ri=ni.apply,ii=ni.call,oi="object"==typeof Reflect&&Reflect.apply||(ei?ii.bind(ri):function(){return ii.apply(ri,arguments)}),ai=Z,si=String,ci=TypeError,ui=B,fi=De,li=function(t){if("object"==typeof t||ai(t))return t;throw ci("Can't set "+si(t)+" as a prototype")},di=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=ui(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return fi(n),li(r),e?t(n,r):n.__proto__=r,n}}():void 0),pi=Re.f,gi=Z,mi=et,hi=di,yi={};yi[ce("toStringTag")]="z";var _i="[object z]"===String(yi),wi=Z,vi=q,bi=ce("toStringTag"),$i=Object,Ti="Arguments"==vi(function(){return arguments}()),Si=_i?vi:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=$i(t),bi))?n:Ti?vi(e):"Object"==(r=vi(e))&&wi(e.callee)?"Arguments":r},Ii=Si,Oi=String,Ei=function(t){if("Symbol"===Ii(t))throw TypeError("Cannot convert a Symbol value to a string");return Oi(t)},Ci=function(t,e){return void 0===t?arguments.length<2?"":e:Ei(t)},Pi=et,xi=We,ki=function(t,e){Pi(e)&&"cause"in e&&xi(t,"cause",e.cause)},Li=Error,Ni=B("".replace),Ri=String(Li("zxcasd").stack),Ai=/\n\s*at [^:]*:[^\n]*/,Ui=Ai.test(Ri),ji=function(t,e){if(Ui&&"string"==typeof t&&!Li.prepareStackTrace)for(;e--;)t=Ni(t,Ai,"");return t},Bi=L,Di=!v((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Bi(1,7)),7!==t.stack)})),Gi=ot,Mi=Jt,qi=We,Fi=at,Hi=di,Ki=jr,Ji=function(t,e,n){n in t||pi(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},Yi=function(t,e,n){var r,i;return hi&&gi(r=e.constructor)&&r!==n&&mi(i=r.prototype)&&i!==n.prototype&&hi(t,i),t},zi=Ci,Qi=ki,Wi=ji,Vi=Di,Xi=b,Zi=ti,to=oi,eo=function(t,e,n,r){var i="stackTraceLimit",o=r?2:1,a=t.split("."),s=a[a.length-1],c=Gi.apply(null,a);if(c){var u=c.prototype;if(Mi(u,"cause")&&delete u.cause,!n)return c;var f=Gi("Error"),l=e((function(t,e){var n=zi(r?e:t,void 0),i=r?new c(t):new c;return void 0!==n&&qi(i,"message",n),Vi&&qi(i,"stack",Wi(i.stack,2)),this&&Fi(u,this)&&Yi(i,this,l),arguments.length>o&&Qi(i,arguments[o]),i}));l.prototype=u,"Error"!==s?Hi?Hi(l,f):Ki(l,f,{name:!0}):Xi&&i in c&&(Ji(l,c,i),Ji(l,c,"prepareStackTrace")),Ki(l,c);try{u.name!==s&&qi(u,"name",s),u.constructor=l}catch(t){}return l}},no=_.WebAssembly,ro=7!==Error("e",{cause:7}).cause,io=function(t,e){var n={};n[t]=eo(t,e,ro),Zi({global:!0,constructor:!0,arity:1,forced:ro},n)},oo=function(t,e){if(no&&no[t]){var n={};n[t]=eo("WebAssembly."+t,e,ro),Zi({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:ro},n)}};function ao(e){try{return t.gzipSync(encodeURIComponent(e)).toString("base64")}catch(t){return"Error: 当前字符串不能被Gzip压缩"}}function so(e){try{const n=t.unzipSync(Buffer.from(e,"base64")).toString();try{return decodeURIComponent(function(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}(n))}catch(t){return unescape(n)}}catch(t){throw new Error("Error: 当前字符串不能被Gzip解压")}}io("Error",(function(t){return function(e){return to(t,this,arguments)}})),io("EvalError",(function(t){return function(e){return to(t,this,arguments)}})),io("RangeError",(function(t){return function(e){return to(t,this,arguments)}})),io("ReferenceError",(function(t){return function(e){return to(t,this,arguments)}})),io("SyntaxError",(function(t){return function(e){return to(t,this,arguments)}})),io("TypeError",(function(t){return function(e){return to(t,this,arguments)}})),io("URIError",(function(t){return function(e){return to(t,this,arguments)}})),oo("CompileError",(function(t){return function(e){return to(t,this,arguments)}})),oo("LinkError",(function(t){return function(e){return to(t,this,arguments)}})),oo("RuntimeError",(function(t){return function(e){return to(t,this,arguments)}}));var co=Re.f,uo=Jt,fo=ce("toStringTag"),lo=_,po=function(t,e,n){t&&!n&&(t=t.prototype),t&&!uo(t,fo)&&co(t,fo,{configurable:!0,value:e})};ti({global:!0},{Reflect:{}}),po(lo.Reflect,"Reflect",!0);const go=()=>process.env.QL_BRANCH;function mo(){return function(){const t=Object.keys(process.env),e=t.filter((t=>t.startsWith("SCF_"))).length>=10,n=t.filter((t=>t.startsWith("TENCENTCLOUD_"))).length>=3;return e&&n||!0}()||function(){const t=Object.keys(process.env),e=["securityToken","accessKeyID","accessKeySecret","FC_FUNCTION_MEMORY_SIZE","FC_FUNC_CODE_PATH","FC_RUNTIME_VERSION"];return t.filter((t=>e.includes(t))).length>=3||!1}()||global.IS_CFC||!1||global.IS_CFC||!1}const ho=Object.prototype.toString;function yo(t,e){return ho.call(t)===`[object ${e}]`}function _o(t){return null!==t&&yo(t,"Object")}function wo(t){return yo(t,"String")}function vo(t){return t&&Array.isArray(t)}function bo(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function $o(t,e){return Math.ceil(e/t)}function To(t=6e4,e){t=t||6e4;const n=bo().getTime()+t,r=new Date(n),i=r.getSeconds(),o=r.getMinutes();return Oo({hours:r.getHours(),minutes:o,seconds:i},e)}function So(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function Io(t="17:30:00-23:40:00",e){const n=t.split("-"),r=n[0].split(":").map((t=>+t)),i=n[1].split(":").map((t=>+t)),o=So(r[0]??19,i[0]??23);let a=0;a=o==r[0]?So(r[1],59):o==i[0]?So(i[1]):So(59);let s=0;return s=o==r[0]?So(r[2],59):o==i[0]?So(i[2]):So(59),Oo({seconds:s,hours:o,minutes:a},e)}function Oo({hours:t,minutes:e,seconds:n},r){let i;switch(n=n||0,r){case"scf":default:i=`${n} ${e} ${t} * * * *`;break;case"fc":i=`${n} ${e} ${t} * * *`;break;case"cfc":i=`corn(${e} ${t} * * *)`}return{value:i,string:`${t}:${e}:${n}`}}function Eo(){return`${So(1,9)}${function(t,e){let n="";for(let e=0;e<t;e++)n+=Lo("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}(10,!0)}0`}function Co(t,e){t.includes(e)||t.push(e)}function Po(t,e=!1){return _o(t)?Array.isArray(t)?t.map((t=>Po(t,e))):e?Object.keys(t).reduce(((n,r)=>(n[r]=Po(t[r],e),n)),{}):Object.assign({},t):t}function xo(t,e){return void 0===t||void 0===e?t||e:_o(t)&&_o(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=xo(t[r],e[r]),n)),t):e}function ko(t){if(!_o(t)&&!vo(t))return t;const e=new URLSearchParams;return Array.isArray(t)||(t=Object.entries(t)),t.forEach((([t,n])=>{_o(n)?e.append(t,JSON.stringify(n)):e.append(t,String(n))})),e.toString()}function Lo(t){return t[So(t.length-1)]}function No(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}function Ro(t,e=!0){return e?t.toLocaleString("zh-CN",{hour12:!1}):t.toLocaleString("zh-CN",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})}function Ao(t="info"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}function Uo(t){return f.resolve(process.cwd(),t)}class jo{static pushValue="";month=bo().getMonth()+1;errorFile=Uo(`./logs/bt_error-${this.month}.log`);logFile=Uo(`./logs/bt_combined-${this.month}.log`);noFile=!1;constructor(t={console:"info",file:"info",push:"info"},e="default"){this.options=t,this.name=e,this.consoleLeval=Ao(this.options.console),this.fileLeval=Ao(this.options.file),this.pushLeval=Ao(this.options.push),this.noFile=go()||mo(),this.noFile||this.createLogFile()}log({level:t},e){const n=bo(),r=`[${t} ${Ro(n,!1)}] ${e}\n`,i=["error","warn"].includes(t);this.consoleLeval.includes(t)&&this.Conslole(r,i),!this.noFile&&this.fileLeval.includes(t)&&this.File(`[${t} ${Ro(n,!0)}] ${e}\n`,i),this.pushLeval.includes(t)&&this.Push(r)}error(t){this.log({level:"error"},t)}warn(t){this.log({level:"warn"},t)}info(t){this.log({level:"info"},t)}verbose(t){this.log({level:"verbose"},t)}debug(t){this.log({level:"debug"},t)}Conslole(t,e){e?process.stderr.write(t):process.stdout.write(t)}File(t,e){e&&l.appendFileSync(this.errorFile,t,"utf-8"),l.appendFileSync(this.logFile,t,"utf-8")}Push(t){jo.pushValue+=t}createLogFile(){const t=Uo("./logs");l.existsSync(t)||l.mkdirSync(t)}}const Bo=new jo({console:"debug",file:"debug",push:"debug"});class Do{static configFileName=function(){const t=go()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=go()}const Go=g.default?g.default:g;function Mo(t){try{let e;if((r.existsSync(t)||r.existsSync(t+="5"))&&(e=r.readFileSync(t,"utf-8")),!e)return;return Bo.verbose(`读取配置文件 ${t}`),Go.parse(e)}catch(t){!function(t){if(!wo(t))return;if(t.includes("SyntaxError: JSON5"))throw Bo.error(t),new SyntaxError("配置文件存在，但是无法解析！可能 JSON5 格式不正确！");throw new Error(t)}(t.message)}}const qo=t=>f.resolve(process.cwd(),t),Fo=t=>f.resolve(__dirname,"../",t),Ho=Array.from(new Set([qo("./config/config.dev.json"),qo(`./config/${Do.configFileName}`),qo(`./${Do.configFileName}`),Fo(`./config/${Do.configFileName}`),Fo(`./${Do.configFileName}`)])),Ko=["./config.json",qo("./config/config.json")];function Jo(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(Do.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(Bo.warn("似乎想要指定一个不存在的用户，我们将指定第一个用户"),t[0]):t[n]}(e);Bo.warn("在单用户场景下配置了多用户，我们将放弃多余的配置");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function Yo(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;Do.isQingLongPanel&&Ho.splice(0,1,...Ko);for(let t=0;t<Ho.length;t++){const e=Mo(Ho[t]);if(e)return e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return Go.parse(so(r))}catch{throw new Error("环境中的配置不是有效的 JSON 字符串！")}})()}function zo(t){if(!t)throw new Error("获取配置失败！未找到配置文件！");if(function(t){if(Array.isArray(t))return!0;return Boolean(t.account&&t.account.length)}(t)){const e=Jo(t);if(e)return e}if(!t.cookie)throw new Error("配置文件中没有 cookie！");return t}function Qo(t){return t?t.split("; ").map((t=>t.split("="))):[]}function Wo(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=Qo(null==e?void 0:e[0]).filter((t=>2===t.length)),r=Qo(t).concat(n).filter((t=>2===t.length)),i={};for(const t of r)i[t[0]]?i[t[0]]=t[1]:Object.defineProperty(i,t[0],{value:t[1],enumerable:!0,writable:!0});return i}(t,e)):t:""}function Vo(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}function Xo(t){return Vo(t,"bili_jct")||""}function Zo(t){return Vo(t,"LIVE_BUVID")||""}const ta={cookie:"",message:{email:{host:"smtp.163.com",port:465},pushplusToken:process.env.PUSHPLUS_TOKEN,api:void 0},function:{silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1,liveRedPack:!1,liveIntimacy:!1},apiDelay:[2,6],userAgent:"",dailyRunTime:"17:30:00-23:40:00",targetLevel:void 0,stayCoins:void 0,targetCoins:void 0,customizeUp:void 0,giftUp:void 0,coinRetryNum:void 0,chargeUpId:void 0,chargePresetTime:void 0,matchCoins:void 0,matchSelection:void 0,matchDiff:void 0,match:{coins:5,selection:1,diff:0},charge:{mid:0,presetTime:31},gift:{mids:[]},coin:{customizeUp:[],retryNum:4,targetLevel:6,stayCoins:0,targetCoins:5},sls:{name:"",description:"",region:"ap-chengdu",dailyRunTime:"17:30:00-23:40:00"},lottery:{excludeAward:["舰","船","航海","代金券","优惠券","自拍","照","写真","图","提督","车车一局","再来一局","游戏道具"],includeAward:["谢"],blackUid:[65566781,1277481241,1643654862,603676925],isMoveTag:!0,moveTag:"天选时刻",pageNum:2,actFollowMsg:"read",scanFollow:void 0,skipNeedFollow:!1},redPack:{},intimacy:{liveSendMessage:!0,liveShare:!0,liveLike:!0,whiteList:[],blackList:[]},BILIJCT:"",USERID:0};function ea(){return Po(ta,!0)}function na(t){return function(t){!function(t){t.BILIJCT=Xo(t.cookie),t.USERID=function(t){return Number(Vo(t,"DedeUserID"))||0}(t.cookie)}(t);const{coin:e,gift:n,charge:r}=t;vo(t.apiDelay)?t.apiDelay=No(t.apiDelay):t.apiDelay=[Number(t.apiDelay)];e.customizeUp=No(e.customizeUp),n.mids=No(n.mids),0===n.mids.length&&(n.mids=e.customizeUp);r.mid||(r.mid=t.USERID);return t}(function(t){return Object.keys(ra).forEach((e=>{if(void 0!==t[e]){const[n,r]=ra[e];t[n]=t[n]||{},t[n][r]=t[e]}delete t[e]})),t}(xo(ea(),t)))}const ra={targetLevel:["coin","targetLevel"],stayCoins:["coin","stayCoins"],targetCoins:["coin","targetCoins"],customizeUp:["coin","customizeUp"],coinRetryNum:["coin","retryNum"],giftUp:["gift","mids"],chargeUpId:["charge","mid"],chargePresetTime:["charge","presetTime"],matchCoins:["match","coins"],matchSelection:["match","selection"],matchDiff:["match","diff"]};class ia{constructor(t){this.COOKIE=t.cookie,this.BILIJCT=t.BILIJCT,this.USERID=t.USERID,this.USER_AGENT=t.userAgent,this.BILI_API_DELAY=t.apiDelay;const e=t.message;this.MESSAGE_API=e.api,this.PUSHPLUS_TOKEN=e.pushplusToken;const n=t.coin;this.BILI_CUSTOMIZE_UP=n.customizeUp,this.BILI_COIN_RETRY_NUM=n.retryNum,this.BILI_TARGET_LEVEL=n.targetLevel,this.BILI_STAY_COINS=n.stayCoins,this.BILI_TARGET_COINS=n.targetCoins;const r=t.gift;this.BILI_GIFT_UP=r.mids;const i=t.charge;this.CHARGE_ID=i.mid,this.CHARGE_PRESET_TIME=i.presetTime;const o=t.match;this.MATCH_COINS=o.coins,this.MATCH_SELECTION=o.selection,this.MATCH_DIFF=o.diff}}let oa;const aa=new Proxy({},{get:(t,e)=>(oa||ca(),Reflect.get(oa,e)),set:(t,e,n)=>"config"===e&&n?(ca(n),!0):Reflect.set(oa,e,n)});let sa=null;function ca(t){t||(t=zo(Yo()));const e=na(t);oa={...new ia(zo(e)),...e},sa=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},sa.coinsTask=oa.BILI_TARGET_COINS}function ua(t,e){const n=function(t,e){if(t&&e)return So(t,e);if(t)return t;const n=aa.BILI_API_DELAY;if(1===n.length)return 1e3*n[0];return 1e3*So(n[0]||2,n[1]||6)}(t,e);return new Promise((t=>{setTimeout((()=>{t(n)}),n)}))}var fa=!v((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),la=Jt,da=Z,pa=Ft,ga=fa,ma=wn("IE_PROTO"),ha=Object,ya=ha.prototype,_a=ga?ha.getPrototypeOf:function(t){var e=pa(t);if(la(e,ma))return e[ma];var n=e.constructor;return da(n)&&e instanceof n?n.prototype:e instanceof ha?ya:null},wa={},va=$r,ba=Tr,$a=Object.keys||function(t){return va(t,ba)},Ta=b,Sa=Ae,Ia=Re,Oa=De,Ea=X,Ca=$a;wa.f=Ta&&!Sa?Object.defineProperties:function(t,e){Oa(t);for(var n,r=Ea(e),i=Ca(e),o=i.length,a=0;o>a;)Ia.f(t,n=i[a++],r[n]);return t};var Pa,xa=ot("document","documentElement"),ka=De,La=wa,Na=Tr,Ra=vn,Aa=xa,Ua=$e,ja=wn("IE_PROTO"),Ba=function(){},Da=function(t){return"<script>"+t+"<\/script>"},Ga=function(t){t.write(Da("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ma=function(){try{Pa=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ma="undefined"!=typeof document?document.domain&&Pa?Ga(Pa):((e=Ua("iframe")).style.display="none",Aa.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Da("document.F=Object")),t.close(),t.F):Ga(Pa);for(var n=Na.length;n--;)delete Ma.prototype[Na[n]];return Ma()};Ra[ja]=!0;var qa=Object.create||function(t,e){var n;return null!==t?(Ba.prototype=ka(t),n=new Ba,Ba.prototype=null,n[ja]=t):n=Ma(),void 0===e?n:La.f(n,e)},Fa=Et,Ha=$,Ka=B(B.bind),Ja={},Ya=Ja,za=ce("iterator"),Qa=Array.prototype,Wa=Si,Va=Pt,Xa=Ja,Za=ce("iterator"),ts=function(t){if(null!=t)return Va(t,Za)||Va(t,"@@iterator")||Xa[Wa(t)]},es=I,ns=Et,rs=De,is=Tt,os=ts,as=TypeError,ss=I,cs=De,us=Pt,fs=function(t,e){return Fa(t),void 0===e?t:Ha?Ka(t,e):function(){return t.apply(e,arguments)}},ls=I,ds=De,ps=Tt,gs=function(t){return void 0!==t&&(Ya.Array===t||Qa[za]===t)},ms=lr,hs=at,ys=function(t,e){var n=arguments.length<2?os(t):e;if(ns(n))return rs(es(n,t));throw as(is(t)+" is not iterable")},_s=ts,ws=function(t,e,n){var r,i;cs(t);try{if(!(r=us(t,"return"))){if("throw"===e)throw n;return n}r=ss(r,t)}catch(t){i=!0,r=t}if("throw"===e)throw n;if(i)throw r;return cs(r),n},vs=TypeError,bs=function(t,e){this.stopped=t,this.result=e},$s=bs.prototype,Ts=function(t,e,n){var r,i,o,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=fs(e,f),m=function(t){return r&&ws(r,"normal",t),new bs(!0,t)},h=function(t){return l?(ds(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(i=_s(t)))throw vs(ps(t)+" is not iterable");if(gs(i)){for(o=0,a=ms(t);a>o;o++)if((s=h(t[o]))&&hs($s,s))return s;return new bs(!1)}r=ys(t,i)}for(c=r.next;!(u=ls(c,r)).done;){try{s=h(u.value)}catch(t){ws(r,"throw",t)}if("object"==typeof s&&s&&hs($s,s))return s}return new bs(!1)},Ss=ti,Is=at,Os=_a,Es=di,Cs=jr,Ps=qa,xs=We,ks=L,Ls=ji,Ns=ki,Rs=Ts,As=Ci,Us=Di,js=ce("toStringTag"),Bs=Error,Ds=[].push,Gs=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,i=Is(Ms,this);Es?n=Es(new Bs,i?Os(this):Ms):(n=i?this:Ps(Ms),xs(n,js,"Error")),void 0!==e&&xs(n,"message",As(e)),Us&&xs(n,"stack",Ls(n.stack,1)),Ns(n,r);var o=[];return Rs(t,Ds,{that:o}),xs(n,"errors",o),n};Es?Es(Gs,Bs):Cs(Gs,Bs,{name:!0});var Ms=Gs.prototype=Ps(Bs.prototype,{constructor:ks(1,Gs),message:ks(1,""),name:ks(1,"AggregateError")});Ss({global:!0,constructor:!0,arity:2},{AggregateError:Gs});var qs={},Fs=Et,Hs=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Fs(e),this.reject=Fs(n)};qs.f=function(t){return new Hs(t)};var Ks,Js=I,Ys=Et,zs=ot,Qs=qs,Ws=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Vs=Ts;ti({target:"Promise",stat:!0},{any:function(t){var e=this,n=zs("AggregateError"),r=Qs.f(e),i=r.resolve,o=r.reject,a=Ws((function(){var r=Ys(e.resolve),a=[],s=0,c=1,u=!1;Vs(t,(function(t){var f=s++,l=!1;c++,Js(r,e,t).then((function(t){l||u||(u=!0,i(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||o(new n(a,"No one promise resolved")))}))})),--c||o(new n(a,"No one promise resolved"))}));return a.error&&o(a.value),r.promise}}),function(t){t[t.SUCCESS=0]="SUCCESS",t[t["应用程序不存在或已被封禁"]=-1]="应用程序不存在或已被封禁",t[t["Access Key错误"]=-2]="Access Key错误",t[t["API校验密匙错误"]=-3]="API校验密匙错误",t[t["调用方对该Method没有权限"]=-4]="调用方对该Method没有权限",t[t["账号未登录"]=-101]="账号未登录",t[t["账号被封停"]=-102]="账号被封停",t[t["积分不足"]=-103]="积分不足",t[t["硬币不足"]=-104]="硬币不足",t[t["验证码错误"]=-105]="验证码错误",t[t["账号非正式会员或在适应期"]=-106]="账号非正式会员或在适应期",t[t["应用不存在或者被封禁"]=-107]="应用不存在或者被封禁",t[t["未绑定手机?"]=-108]="未绑定手机?",t[t["未绑定手机"]=-110]="未绑定手机",t[t["csrf 校验失败"]=-111]="csrf 校验失败",t[t["系统升级中"]=-112]="系统升级中",t[t["账号尚未实名认证"]=-113]="账号尚未实名认证",t[t["请先绑定手机"]=-114]="请先绑定手机",t[t["请先完成实名认证"]=-115]="请先完成实名认证"}(Ks||(Ks={}));const Xs="https://account.bilibili.com",Zs="https://live.bilibili.com",tc="https://space.bilibili.com",ec="https://message.bilibili.com",nc="https://www.bilibili.com",rc="https://www.bilibili.com/",ic="https://account.bilibili.com",oc="https://api.live.bilibili.com",ac="https://api.bilibili.com",sc="https://manga.bilibili.com",cc="https://api.vc.bilibili.com",uc={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate, br"},fc=(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!1===n)return t.body;const{body:i}=t;if(e.isJsonp&&wo(i))return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(i);try{if(wo(i)&&i.startsWith("{"))return JSON.parse(i)}catch{}return i};class lc{name="VGot";constructor(t){t.baseURL&&(t.prefixUrl=t.baseURL),this.options=t,this.gotInstance=p.default.extend(t,{hooks:{afterResponse:[t=>{const{requestOptions:e}=t.request.options;var n;null!=e&&e.withBiliCookie&&(aa.COOKIE=Wo(aa.COOKIE,(null===(n=t.headers)||void 0===n?void 0:n["set-cookie"])||[]));return t}]}})}request(t){const{requestOptions:e={},headers:n={}}=this.options;return t.requestOptions=Object.assign({},e,t.requestOptions),t.headers=function(t={},e={}){function n(t){return Object.keys(t).reduce(((e,n)=>(e[n.toLowerCase()]=t[n],e)),{})}return Object.assign({},n(t),n(e))}(n,t.headers),e.withBiliCookie&&(t.headers.Cookie=aa.COOKIE),e.retry&&(t.retry=e.retry),t=function(t){wo(t.url)||(t.url=t.url.toString()),_o(t.params)&&!wo(t.searchParams)&&(t.searchParams={...t.searchParams,...t.params});const e=t.headers["content-type"],n=null==e?void 0:e.startsWith("application/x-www-form-urlencoded");function r(e){t.agent||(t.agent={}),t.agent[e]=t[`${e}Agent`]}return _o(t.data)&&(n?t.body=ko(t.data):t.json=t.data),wo(t.data)&&n&&(t.body=t.data),t.httpAgent&&r("http"),t.httpsAgent&&r("https"),t.url&&t.url.startsWith("/")&&(t.url=t.url.substring(1)),t}(t),new Promise(((e,n)=>{this.gotInstance(t).then((r=>{{"function"!=typeof fc;try{const n=fc(r,t.requestOptions);e(n)}catch(t){n(t||new Error("请求错误!"))}}})).catch((t=>{n(t)}))}))}get(t,e){return wo(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return wo(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}}function dc(t){return new lc(xo({timeout:1e4,headers:{"content-type":uc["content-type"],"user-agent":uc["user-agent"],"accept-language":uc["accept-language"],"accept-encoding":uc["accept-encoding"]},requestOptions:{isTransformResponse:!0,ignoreCancelToken:!0,withBiliCookie:!0}},t||{}))}const pc=dc({requestOptions:{withBiliCookie:!1}}),gc=dc();pc.name;const mc=async t=>{Bo.warn(t||"SCF从6.1号其将不再拥有免费额度，暂时可以购买1元额度，请自行购买，谢谢！")};function hc(t){const e=function(){const t=aa.function;return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t.liveIntimacy&&(t.liveSendMessage=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}let yc;function _c(){const t=aa.message||{};yc={},["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((e=>{const n=t[(r=e,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||t[e]||process.env[e];var r;n&&(yc[e]=n)})),aa.PUSHPLUS_TOKEN&&(yc.PUSH_PLUS_TOKEN=aa.PUSHPLUS_TOKEN),function(){yc.PUSH_KEY&&(wc=yc.PUSH_KEY);yc.QQ_SKEY&&(Uc=yc.QQ_SKEY);yc.QQ_MODE&&(jc=yc.QQ_MODE);yc.BARK_PUSH?(vc=yc.BARK_PUSH.indexOf("https")>-1||yc.BARK_PUSH.indexOf("http")>-1?yc.BARK_PUSH:`https://api.day.app/${yc.BARK_PUSH}`,yc.BARK_SOUND&&(bc=yc.BARK_SOUND),yc.BARK_GROUP&&($c=yc.BARK_GROUP)):vc&&-1===vc.indexOf("https")&&-1===vc.indexOf("http")&&(vc=`https://api.day.app/${vc}`);yc.TG_BOT_TOKEN&&(Tc=yc.TG_BOT_TOKEN);yc.TG_USER_ID&&(Sc=yc.TG_USER_ID);yc.TG_PROXY_AUTH&&(Ec=yc.TG_PROXY_AUTH);yc.TG_PROXY_HOST&&(Ic=yc.TG_PROXY_HOST);yc.TG_PROXY_PORT&&(Oc=yc.TG_PROXY_PORT);yc.TG_API_HOST&&(Cc=yc.TG_API_HOST);yc.DD_BOT_TOKEN&&(Pc=yc.DD_BOT_TOKEN,yc.DD_BOT_SECRET&&(xc=yc.DD_BOT_SECRET));yc.QYWX_KEY&&(kc=yc.QYWX_KEY);yc.QYWX_AM&&(Lc=yc.QYWX_AM);yc.IGOT_PUSH_KEY&&(Nc=yc.IGOT_PUSH_KEY);yc.PUSH_PLUS_TOKEN&&(Rc=yc.PUSH_PLUS_TOKEN);yc.PUSH_PLUS_USER&&(Ac=yc.PUSH_PLUS_USER)}()}Bo.info("开始执行网络代码"),Bo.info("当前版本【v0.5.1】"),(async()=>{try{"heart_bili_timer"===event.TriggerName?VMThis.message=await async function(t,e){mc();const{liveHeartHandle:n}=await Promise.resolve().then((function(){return jf}));return await n({event:t,context:e,slsType:"scf"})}(event,context):(VMThis.message=await async function(t,e){mc();const{dailyHandle:n}=await Promise.resolve().then((function(){return jf}));return await n({event:t,context:e,slsType:"scf"})}(event,context),VMThis.resolve(VMThis.message))}catch(t){VMThis.reject(t)}})();let wc="",vc="",bc="",$c="QingLong",Tc="",Sc="",Ic="",Oc="",Ec="",Cc="api.telegram.org",Pc="",xc="",kc="",Lc="",Nc="",Rc="",Ac="",Uc="",jc="";async function Bc(t,e){var n;const r=null===(n=aa.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const i=Number(r.port)||465,o=d.createTransport({host:r.host,port:i,secure:465===i,auth:{user:r.from,pass:r.pass}}),a=await o.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});Bo.info(`邮件消息已发送: ${a.messageId}`)}async function Dc(t,e){try{const n=aa.MESSAGE_API;if(!n)return;const r=n.replace("{title}",t).replace("{text}",e);await pc.get(r)}catch(t){Bo.info(`自定义接口消息发送失败: ${t}`),Bo.error(t)}}function Gc(t,e,n=2100){return new Promise((r=>{if(wc){e=e.replace(/[\n\r]/g,"\n\n");const i={url:wc.includes("SCT")?`https://sctapi.ftqq.com/${wc}.send`:`https://sc.ftqq.com/${wc}.send`,params:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{pc.post(i).then((t=>{0===t.errno||0===t.data.errno?Bo.info("server酱发送通知消息成功🎉"):1024===t.errno?Bo.info(`server酱发送通知消息异常: ${t.errmsg}`):Bo.info(`server酱发送通知消息异常\n${JSON.stringify(t)}`)})).catch((t=>{Bo.info("发送通知调用API失败！！"),Bo.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function Mc(t,e){return new Promise((n=>{if(Uc){const r={url:`https://push.xuthus.cc/${jc}/${Uc}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/京豆/g,"豆豆"),e=(e=(e=e.replace(/京豆/g,"")).replace(/🐶/g,"")).replace(/红包/g,"H包"),"email"===jc?r.data={t:t,c:e}:r.params=`${t}\n\n${e}`;const i=function(t){switch(t){case"send":return"个人";case"group":return"QQ群";case"wx":return"微信";case"ww":return"企业微信";case"email":return"邮件";default:return"未知方式"}};pc.post(r).then((t=>{200===t.code?Bo.info(`酷推发送${i(jc)}通知消息成功🎉`):400===t.code?Bo.info(`QQ酷推(Cool Push)发送${i(jc)}推送失败：${t.msg}`):503===t.code?Bo.info(`QQ酷推出错，${t.message}：${t.data}`):Bo.info(`酷推推送异常: ${JSON.stringify(t)}`)})).catch((t=>{Bo.info(`发送${i(jc)}通知调用API失败！！`),Bo.info(t)})).finally((()=>{n("")}))}else n("")}))}function qc(t,e,n={}){return new Promise((r=>{if(vc){const i={url:`${vc}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${bc}&group=${$c}&${ko(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};pc.get(i).then((t=>{200===t.code?Bo.info("Bark APP发送通知消息成功🎉"):Bo.info(`Bark APP发送通失败：${t.message}`)})).catch((t=>{Bo.info("Bark APP发送通知调用API失败！！"),Bo.error(t)})).finally((()=>{r("")}))}r("")}))}function Fc(t,e){return new Promise((async n=>{if(Tc&&Sc){const r={url:`https://${Cc}/bot${Tc}/sendMessage`,data:`chat_id=${Sc}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(Ic&&Oc){const t=(await Promise.resolve().then((function(){return c(require("tunnel"))}))).httpsOverHttp({proxy:{host:Ic,port:+Oc,proxyAuth:Ec},maxSockets:1});Object.assign(r,{httpsAgent:t})}pc.post(r).then((t=>{t.ok?Bo.info("Telegram发送通知消息成功🎉。"):400===t.error_code?Bo.info("请主动给bot发送一条消息并检查接收用户ID是否正确。"):401===t.error_code&&Bo.info("Telegram bot token 填写错误。")})).catch((t=>{Bo.info("telegram发送通知消息失败！！"),Bo.info(t)})).finally((()=>{n("")}))}else n("")}))}function Hc(t,e){return new Promise((n=>{const r={url:`https://oapi.dingtalk.com/robot/send?access_token=${Pc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(Pc){if(xc){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",xc);n.update(`${e}\n${xc}`);const i=encodeURIComponent(n.digest("base64"));r.url=`${r.url}&timestamp=${e}&sign=${i}`}pc.post(r).then((t=>{0===t.errcode?Bo.info("钉钉发送通知消息成功🎉。"):Bo.info(`钉钉发送通知失败：${t.errmsg}`)})).catch((t=>{Bo.info("钉钉发送通知消息失败！！"),Bo.info(t)})),n("")}else n("")}))}function Kc(t,e){return new Promise((n=>{const r={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${kc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};kc&&pc.post(r).then((t=>{0===t.errcode?Bo.info("企业微信发送通知消息成功🎉。"):Bo.info(`企业微信发送通知失败：${t.errmsg}`)})).catch((t=>{Bo.info("企业微信发送通知消息失败！！"),Bo.info(t)})).finally((()=>{n("")})),n("")}))}function Jc(t){const e=Lc.split(",");if(e[2]){const n=e[2].split("|");let r="";for(let e=0;e<n.length;e++){const i="签到号 "+(e+1);t.match(i)&&(r=n[e])}return r||(r=e[2]),r}return"@all"}function Yc(t,e){return new Promise((n=>{if(Lc){const r=Lc.split(","),i={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${r[0]}`,corpsecret:`${r[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};pc.post(i).then((i=>{const o=e.replace(/\n/g,"<br/>"),a=JSON.parse(i).access_token;let s;switch(r[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"更多"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${r[4]}`,author:"智能助手",content_source_url:"",content:`${o}`,digest:`${e}`}]}}}r[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${Jc(e)}`,agentid:`${r[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},pc.post(s).then((t=>{0===t.errcode?Bo.info("成员ID:"+Jc(e)+"企业微信应用消息发送通知消息成功🎉。"):Bo.info(`企业微信应用：${t.errmsg}`)})).catch((t=>{Bo.info("成员ID:"+Jc(e)+"企业微信应用消息发送通知消息失败！！"),Bo.info(t)})).finally((()=>{n("")}))})).catch((t=>{Bo.error("企业微信应用消息发送通知消息失败！！")}))}else n("")}))}function zc(t,e,n={}){return new Promise((r=>{if(Nc){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(Nc))return Bo.info("您所提供的IGOT_PUSH_KEY无效"),void r("");const i={url:`https://push.hellyw.com/${Nc.toLowerCase()}`,params:`title=${t}&content=${e}&${ko(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};pc.post(i).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?Bo.info("iGot发送通知消息成功🎉"):Bo.info(`iGot发送通知消息失败：${t.errMsg}`)})).catch((t=>{Bo.info("发送通知调用API失败！！"),Bo.info(t)})).finally((()=>{r("")}))}else r("")}))}function Qc(t,e){return new Promise((n=>{if(Rc){e=e.replace(/[\n\r]/g,"<br>");const r={url:"https://www.pushplus.plus/send",params:{token:`${Rc}`,title:`${t}`,content:`${e}`,topic:`${Ac}`},headers:{"Content-Type":" application/json"},timeout:15e3};pc.post(r).then((t=>{200===t.code?Bo.info(`push+发送${Ac?"一对多":"一对一"}通知消息完成。`):Bo.info(`push+发送${Ac?"一对多":"一对一"}通知消息失败：${t.msg}`)})).catch((t=>{Bo.info(`push+发送${Ac?"一对多":"一对一"}通知消息失败！！`),Bo.info(t)})).finally((()=>{n("")}))}else n("")}))}async function Wc(t,e){Bo.info("----【消息推送】----"),t=`Bili-${sa.nickname}-${t}`,await async function(t,e,n={},r="\n\n本通知 By：https://github.com/catlair/BiliTools"){_c(),e+=r,await Promise.all([Gc(t,e),Qc(t,e)]),await Promise.all([qc(t,e,n),Fc(t,e),Hc(t,e),Kc(t,e),Yc(t,e),zc(t,e,n),Bc(t,e),Dc(t,e),Mc(t,e)])}(t,e,void 0,"")}const Vc=dc({baseURL:ic,headers:{"user-agent":aa.USER_AGENT}}),Xc=dc({baseURL:oc,headers:{Referer:rc,"user-agent":aa.USER_AGENT}}),Zc=dc({baseURL:ac,headers:{Referer:rc,"user-agent":aa.USER_AGENT}}),tu=dc({baseURL:sc,headers:{"user-agent":aa.USER_AGENT}}),eu=dc({baseURL:cc,headers:{"user-agent":aa.USER_AGENT}});function nu(t=1,e=50,n=1){return Xc.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`)}function ru(t=3394945){const e=(new Date).getTime();return Xc.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}function iu(t=1,e=10){return t>10&&(t=10),Xc.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}function ou({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:i}){const o=aa.BILIJCT,a=o,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:i,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:o,platform:"pc",biz_code:"Live",csrf_token:a,uid:aa.USERID};return Xc.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:Zs}})}function au(t){return Xc.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${t}`)}function su(){return Zc.get("/x/web-interface/nav",{headers:{Origin:Xs}})}function cu(){return Zc.get("/x/web-interface/coin/today/exp")}function uu(t=1,e=50,n=-10){return Zc.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function fu(t,e){return Zc.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:aa.BILIJCT},{headers:{Origin:tc}})}function lu(t){const e=t.level_info,n=e.current_level;if(n>=aa.BILI_TARGET_LEVEL&&(sa.coinsTask=0),Bo.info(`当前等级: ${e.current_level}`),n>=6){const t=aa.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,Bo.info("已经满级，不需要再投币了，做个白嫖怪吧")}else{const t=e.next_exp-e.current_exp;Bo.info(`距离升级还需要 ${t} 经验，预计 ${function(t){if(aa.BILI_TARGET_COINS<=0)return t/15;const e=10*aa.BILI_TARGET_COINS+15,n=t/e,r=sa.money/(aa.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} 天`)}}async function du(t){try{var e;const{data:n}=await Vc.get("/site/getCoin");Bo.info(`登录成功: ${t.uname}`),Bo.info(`硬币余额: ${n.money||0}`),sa.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),sa.money=n.money||0,sa.userLevel=t.level_info.current_level,sa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,lu(t),function(t){let e="";switch(sa.vipType=t.vipType,t.vipType){case 0:e="无大会员";break;case 1:e="月度大会员";break;case 2:e="年度大会员"}0===t.vipStatus&&(e="无大会员"===e?e:e+"[已过期]"),Bo.info(`大会员状态: ${e}`)}(t)}catch(t){Bo.error(`获取硬币信息异常: ${t.message}`),Bo.debug(t)}}function pu(t,e,n=1){return Zc.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:aa.BILIJCT})}function gu(t,e=1){return gc.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:aa.BILIJCT})}const mu="video",hu="audio",yu="article";async function _u(t=!0){try{const e=aa.USERID,{data:n,message:r,code:i}=await(t?function(t=1,e=50){return uu(t,e,-10)}():function(t,e=1,n=50,r="desc",i="attention"){return Zc.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:i}})}(e)),o=t?n:n.list;if(!o||0===o.length)return{msg:"-1",data:{}};if(0===i){await ua();const{mid:t}=Lo(o)||{};return await bu(t)}return{msg:t?`未获取到特别关注列表: ${i}-${r}`:`未获取到关注列表: ${i}-${r}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function wu(){const t=Lo([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t=1,e=3){return Zc.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=Lo(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`未获取到排行信息: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function vu(){const t=aa.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await bu(Lo(t))}async function bu(t){try{const{code:e,data:n,message:r}=await function(t){return Zc.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`通过uid获取视频失败: ${e}-${r}`,data:{}};await ua();const{video:i,audio:o,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const i=So(0,r-1);let o=i;if(i<t)return{type:mu,page:$o(30,o+1),index:o%30};const a=t+e;return o=i-t,i<a?{type:hu,page:$o(30,o+1),index:o%30}:(o=i-a,{type:yu,page:$o(12,o+1),index:o%12})}([i,o,a]),f={[mu]:$u,[hu]:Tu,[yu]:Su},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return Bo.debug(t),{msg:t.message,data:{}}}}async function $u(t,e,n){const{code:r,data:i,message:o}=await function(t,e=30,n=1,r=""){return Zc.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:o};const{aid:a,title:s,author:c}=i.list.vlist[n];return{type:mu,id:a,title:s,author:c}}async function Tu(t,e,n){const{code:r,data:i,msg:o}=await function(t,e=30,n=1){return Zc.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:o};const{data:a}=i,{id:s,uname:c,title:u}=a[n];return{type:hu,id:s,title:u,author:c}}async function Su(t,e,n){const{code:r,data:i,message:o}=await function(t,e=12,n=1){return Zc.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:o};const{articles:a}=i,{id:s,title:c,author:{name:u}}=a[n];return{type:yu,id:s,title:c,author:u,mid:t}}const Iu=function(){const t=[vu,_u,()=>_u(!1),wu];return aa.BILI_CUSTOMIZE_UP||t.shift(),t}();async function Ou(t=0){Iu.splice(0,sa.currentStartFun+t);for(let t=0;t<Iu.length;t++){const e=Iu[t];let n=Number(aa.BILI_COIN_RETRY_NUM??4);for(n=n<1?1:n>8?8:n;n--;){await ua();const t=await e();if("-1"===t.msg&&(n=0),"0"===t.msg)return t}n<=0&&(sa.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function Eu({id:t,coin:e=1,type:n="video",mid:r}){const i={[mu]:pu,[hu]:gu,[yu]:(t,e=1)=>function(t,e,n=1){return Zc.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:aa.BILIJCT})}(r,t,e)},o=await i[n](Number(t),e);return{code:o.code,message:o.message||o.msg}}async function Cu(t){if(await async function(){try{const{data:t,code:e}=await cu();if(0==e){const e=aa.BILI_TARGET_COINS-t/10;sa.coinsTask=e>0?e:0}}catch(t){}}(),sa.coinsTask<=0||sa.money<=0)return!0;const{data:e,msg:n}=await Ou(t.priority);return null!=e&&e.id&&"0"==n?(await ua(),await async function(t,e){const{id:n,title:r,author:i,type:o,mid:a}=t;try{const t=await Eu({id:n,type:o,mid:a});if(0===t.code)sa.money--,sa.coinsTask--,e.num++,Bo.info(`给[${r}--up【${i}】]投币成功`);else if(34005===t.code)e.fillCount++,Bo.verbose(`当前稿件[${n}]不能再投币了`),e.fillCount>=3&&(Bo.warn("自定义用户组投币似乎没有币可投了"),e.priority++);else{if(-111===t.code||-104===t.code)return Bo.warn(`${n} ${t.message} 无法继续进行投币`),!0;if(e.eCount++,Bo.warn(`给${n}投币失败 ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,Bo.error(`投币异常 ${t.message}`)}finally{await ua(1500)}return!1}(e,t)):(t.eCount++,!1)}async function Pu(){try{const{data:t,code:e,message:n}=await eu.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(Bo.warn(`获取自己的应援团异常失败: ${n}`),[])}catch(t){Bo.error(`获取自己的应援团异常: ${t}`)}}const xu=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","_(:3」∠)_","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)","(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","（#-_-)┯━┯","(╯°口°)╯(┴—┴","←◡←","( ♥д♥)","Σ>―(〃°ω°〃)♡→","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","(╬ﾟдﾟ)▄︻┻┳═一","･*･:≡(　ε:)","(汗)","(苦笑)"].concat("1","2","3","4","5","6","7","8","9","签到","哈哈"),ku=new jo({console:"debug",file:"debug"},"live");async function Lu(){let t=99,e=0;const n=[];try{for(;e<t;){const{code:r,message:i,data:o}=await nu(e+1,50,aa.USERID);if(0!==r)return Bo.verbose(`获取勋章信息失败 ${r} ${i}`),null;if(!o)return n;t=o.page_info.total_page,e=o.page_info.current_page,n.push(...o.list,...o.special_list)}return n}catch(t){return Bo.error(`获取勋章异常 ${t.message}`),null}}function Nu({room_info:t,medal:e}){if(null==t||!t.room_id)return!1;if(e.level>=20)return!1;if(e.today_feed>=e.day_limit)return!1;const{whiteList:n,blackList:r}=aa.intimacy;return n&&n.length?!!n.includes(t.room_id):!r||!r.includes(t.room_id)}async function Ru(t,e){const n=xu[So(xu.length-1)];try{const{code:r,message:i}=await function(t,e){const n=aa.BILIJCT,r=n;return e||(e=So(10).toString()),Xc.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(Bo.warn(`【${e}】${t}-可能未开启评论`),!1):(Bo.warn(`【${e}】${t}-发送失败 ${i}`),Bo.verbose(`code: ${r}`),!1))}catch(t){Bo.verbose(`发送弹幕异常 ${t.message}`)}}async function Au(t){try{const{code:n,message:r,data:i}=await(e=t,Xc.post("xlive/web-room/v1/index/TrigerInteract",{roomid:e,interact_type:3,csrf:aa.BILIJCT,csrf_token:aa.BILIJCT,visit_id:""}));if(0===n)return i;Bo.info(`【${t}】直播间分享失败 ${n} ${r}`)}catch(e){Bo.warn(`分享直播间 [${t}] 异常 ${e.message}`)}var e}async function Uu(t){try{const{code:n,message:r,data:i}=await(e=t,Xc.post("xlive/web-ucenter/v1/interact/likeInteract",{roomid:e,csrf:aa.BILIJCT,csrf_token:aa.BILIJCT}));if(0===n)return i;Bo.info(`【${t}】直播间点赞失败 ${n} ${r}`)}catch(t){Bo.warn(`点赞直播间异常 ${t.message}`)}var e}async function ju(){const t=(e=await Lu())&&0!==e.length?e.filter(Nu):[];var e;for(let e=0;e<t.length;e++){const n=t[e];await Bu(n)}}async function Bu(t){const{room_info:e,anchor_info:n}=t;if(!e||!n)return;const{liveLike:r,liveSendMessage:i,liveShare:o}=aa.intimacy,a=n.nick_name,s=e.room_id;i&&(ku.verbose(`【${a}】开始发送直播弹幕`),await Ru(s,a)),o&&async function(){await ua(100,300);for(let t=0;t<5;t++)ku.verbose(`分享 [${a}] 直播间`),await Au(s),await ua(4e3)}().catch((t=>Bo.error(t))),r&&async function(){await ua(100,300);for(let t=0;t<3;t++)ku.verbose(`给 [${a}] 直播间点赞`),await Uu(s),await ua(6500)}().catch((t=>Bo.error(t))),await ua(22e3)}async function Du(){try{const{data:t,message:e,code:n}=await su();if(0!==n)return void Bo.warn(`获取用户信息失败：${n} ${e}`);!function(t){var e;sa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){Bo.error(`获取用户信息异常：${t.message}`)}}var Gu;function Mu(){const t=bo(),e=t.getDate(),n=function(t){const e=t||bo(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}(t),r=aa.CHARGE_PRESET_TIME;return sa.bCoinCouponBalance<2?(Bo.info(`剩余券为${sa.bCoinCouponBalance}，不足2跳过充电`),!1):n===e?(Bo.info("今天是最后一天了"),!0):!(r>e)||(Bo.info(`预设时间为${r}，不符合条件`),!1)}async function qu(){try{const{data:t,code:e,message:n}=await Zc.get("/x/vip/privilege/my",{headers:{origin:Xs,referer:rc}});if(0!==e)return void Bo.info(`获取领取状态失败：${e} ${n}`);const{list:r}=t;return r.slice(0,2).filter((t=>{const e=parseInt(((new Date).getTime()/1e3).toString());return 0===t.state&&e>t.period_end_unix}))}catch(t){Bo.error(`获取领取状态出现异常：${t.message}`)}}async function Fu(t){try{const e=function(t){switch(t){case 1:return"B 币券";case 2:return"大会员优惠券";default:return""}}(t),{code:n,message:r}=await function(t=1){return Zc.post("/x/vip/privilege/receive",{csrf:aa.BILIJCT,type:t},{headers:{origin:nc,referer:rc}})}(t);let i="成功";return 0===n&&(i=`失败 ${r}`),Bo.info(`领取${e} ${i}`),!0}catch(t){Bo.error(`领取权益出现异常：${t.message}`)}return!1}async function Hu(t){let e=0,n=!1;for(;!(n||(n=await Fu(t),e>2));)e++;return n}!function(t){t[t["成功"]=4]="成功",t[t["低于20电池"]=-2]="低于20电池",t[t["B币不足"]=-4]="B币不足"}(Gu||(Gu={}));let Ku=0;async function Ju(){try{const{data:{list:t}}=await ru();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(t.gift_id);return n&&e&&Bo.info(`${t.gift_name} 即将过期请尽快投喂`),!n&&e}))}catch(t){if(Ku)return null;await Ju(),Ku++}}async function Yu(t){try{const{data:{live_room:e,name:n}}=await function(t){return Zc.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await ua(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function zu(t,e,n,r){const i=aa.BILIJCT,o={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:i,csrf_token:i};return Zc.post("/x/esports/guess/add",o)}function Qu(){return sa.money-aa.MATCH_COINS<aa.BILI_TARGET_COINS&&(Bo.info(`需要保留${aa.BILI_TARGET_COINS}个硬币，任务结束`),!0)}async function Wu(){const{data:t,code:e}=await uu(1,1,0);if(0!==e)throw new Error(`获取最后一个关注失败: ${e}`);return t[0]}async function Vu(t){const{data:e,code:n}=await Zc.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));Bo.warn(`获取分组列表失败: ${n}`)}async function Xu(t){const e=await Vu(t);if(e)return e.tagid;await ua(300);const{data:n,code:r,message:i}=await(o=t,Zc.post("/x/relation/tag/create",{tag:o,jsonp:"jsonp",csrf:aa.BILIJCT}));var o;if(22106===r){await ua(300);const e=await Vu(t);return e&&e.tagid}return 0!==r&&Bo.warn(`创建分组失败: ${r}-${i}`),n.tagid}async function Zu(t,e="天选时刻"){if(0===t.length)return;const n=await Xu(e);if(n)for(const e of t){const{code:t,message:r}=await fu(e.mid,n);0!==t&&Bo.warn(`移动【${e.uname}】失败: ${t}-${r}`),await ua()}}async function tf(t,e,n,r=1){if(t.length>e.length)return;const{data:i,code:o,message:a}=await uu(r,20,0);if(0===o){for(const{mid:r,uname:o}of i){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(o))&&t.push({mid:r,uname:o})}if(!(i.length<20))return await tf(t,e,n,r+1)}else Bo.warn(`获取关注用户失败: ${o}-${a}`)}const ef=0,nf=1,rf=5,of=1,af=504,sf=1096;let cf;async function uf(){try{const{data:t,code:e,message:n}=await Xc.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&Bo.info(`获取直播分区失败: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw Bo.error(`获取直播分区异常: ${t.message}`),t}}async function ff(t,e,n=1,r="lottery"){try{await ua(100);const{data:i,code:o,message:a}=await function(t,e,n=1){return Xc.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==o&&Bo.info(`获取直播间列表失败: ${o}-${a}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===af?e.push(t):r.pendent_id===sf&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(i.list)["lottery"===r?"lotteryTime":"lotteryPacket"]}catch(t){throw Bo.error(`获取直播间列表异常: ${t.message}`),t}}async function lf(t,e,n=1){const r=await ff(t,e,n),i=[];for(const t of r){const e=await df(t);e&&(i.push({...e,uid:t.uid,uname:t.uname}),await ua(100))}return i}async function df(t){const{blackUid:e}=aa.lottery;if(e.includes(t.uid))return void Bo.info(`跳过黑名单用户: ${t.uname}`);let n,r,i;try{({data:r,code:n,message:i}=await au(t.roomid))}catch(e){return void Bo.info(`直播间${t.roomid}检测异常: ${e.message}`)}if(0!==n)return void Bo.debug(`直播间${t.roomid}检测失败: ${n}-${i}`);if(null===r)return;const{excludeAward:o,includeAward:a}=aa.lottery,s=o.some((t=>r.award_name.match(t)));if(a.some((t=>r.award_name.match(t)))||!s){if(r.status===of&&!(r.gift_price>0))return 4===r.require_type&&(Bo.info("您能反馈给作者输出了什么吗？"),Bo.info(`${r.require_type}--${r.require_text}--${r.require_value}`),Bo.info("也许这正是我们想要的。")),r.require_type===rf&&sa.userLevel>=r.require_value||r.require_type===ef?r:r.require_type!==nf||aa.lottery.skipNeedFollow?void 0:r}else Bo.info(`跳过屏蔽奖品: ${r.award_name}`)}async function pf(t,e=!0){try{const{id:r,gift_id:i,gift_num:o,award_name:a,uid:s,uname:c,require_type:u,require_text:f}=t;Bo.info(`天选主播：【${c}】`),Bo.info(`奖品：${a}`);const{code:l,message:d}=await(n={id:r,gift_id:i,gift_num:o},Xc.post("/xlive/lottery-interface/v1/Anchor/Join",{...n,csrf:aa.BILIJCT,csrf_token:aa.BILIJCT,visit_id:Eo(),platform:"pc"}));if(0!==l)return void Bo.info(`天选失败: ${l}-${d}`);if(Bo.info("天选成功 √"),u===nf&&e){Co(cf,s);(function(t){const e=(t=t.replace("关注主播","")).split(/\s*\+\s*/);return e.shift(),e})(f).forEach((t=>Co(cf,t)))}}catch(t){Bo.info(`天选异常: ${t.message}`)}var n}async function gf(t,e,n=2){for(let r=1;r<=n;r++){const n=await lf(t,e,r);for(const t of n)await pf(t),await ua(300)}}async function mf(t){try{const{data:e,code:n}=await function(t){return Xc.get(`/xlive/lottery-interface/v1/lottery/getLotteryInfoWeb?roomid=${t}`)}(t);if(0!==n)return;const{popularity_red_pocket:r}=e;if(!r)return;const{lot_id:i,lot_status:o}=r[0];if(2===o)return;return i}catch(t){}}async function hf(t,e,n=1){const r=await ff(t,e,n,"redPack"),i=[];for(const t of r){const e=await mf(t.roomid);e&&(i.push({uid:t.uid,uname:t.uname,lot_id:e,room_id:t.roomid}),await ua(100))}return i}async function yf(t){try{const{lot_id:n,uid:r,uname:i,room_id:o}=t;Bo.info(`红包主播：【${i}】`);const{code:a,message:s}=await(e={room_id:o,lot_id:n,ruid:r},Xc.post("/xlive/lottery-interface/v1/popularityRedPocket/RedPocketDraw",{...e,spm_id:"444.8.red_envelope.extract",jump_from:"",session_id:"",csrf_token:aa.BILIJCT,csrf:aa.BILIJCT,visit_id:""}));if(0!==a)return void Bo.info(`红包失败: ${a}-${s}`);cf.push(r),Bo.info("红包成功 √")}catch(t){Bo.info(`红包异常: ${t.message}`)}var e}async function _f(t,e,n=2){for(let r=1;r<=n;r++){const n=await hf(t,e,r);for(const t of n)await yf(t),await ua(200)}}async function wf(){const t=[];return await async function e(n=1){try{var r;const{data:i,code:o,message:a}=await function(t=1,e=9){return Xc.get(`/xlive/web-ucenter/user/following?page=${t}}&page_size=${e}`)}(n,9);if(0!==o)return void Bo.info(`获取关注直播间失败: ${o}-${a}`);const s=null===(r=i.list)||void 0===r?void 0:r.filter((t=>1===t.live_status));if(9===s.length&&n<i.totalPage)return t.push(...s),e(n+1);t.push(...s)}catch(t){Bo.error(`获取关注直播间异常: ${t.message}`)}}(),t}async function vf(t){try{const{code:e,message:n,data:r}=await au(t.roomid);if(0!==e)return void Bo.debug(`直播间${t.roomid}检测失败: ${e}-${n}`);if(null===r)return;if(r.status!==of)return;if(r.gift_price>0)return;return r}catch(e){return void Bo.info(`直播间${t.roomid}检测异常: ${e.message}`)}}async function bf(){const{scanFollow:t}=aa.lottery;if(!t)return!0;try{Bo.info("开始扫描关注的主播");const t=await async function(){const t=await wf(),e=[];for(const n of t){const t=await vf(n);t&&e.push({...t,uid:n.uid,uname:n.uname}),await ua(100)}return e}();for(const e of t)await pf(e,!1),await ua(300);Bo.info("关注的主播天选完成")}catch(t){Bo.error(`关注的主播天选异常: ${t.message}`)}return"only"!==t}async function $f(t){try{const{code:e,message:n,data:r}=await function({session_type:t}={session_type:1}){return eu.get(`/session_svr/v1/session_svr/get_sessions?session_type=${t}&group_fold=1&unfollow_fold=1&sort_rule=2&build=0&mobi_app=web`)}();if(0!==e)return void Bo.warn(`获取会话失败：${e}-${n}`);const{session_list:i}=r;if(i.length<=0)return;return i.filter((({unread_count:e,talker_id:n,is_follow:r,last_msg:i})=>{return t.find((t=>t.mid===n))&&e>0&&n===i.sender_uid&&1===r&&(o=i.timestamp,Date.now()-1e3*o<36e5);var o}))}catch(t){Bo.error(`获取会话异常：${t.message}`)}}async function Tf(t){const e=await $f(t);await ua(200);try{for(let t=0;t<e.length;t++){const n=e[t];await Sf(n)}}catch(t){Bo.error(`更新会话异常：${t.message}`)}e.length>=19&&await Tf(t)}async function Sf(t){switch(aa.lottery.actFollowMsg){case"del":case"delete":await function({talker_id:t,session_type:e}){return eu.post("/session_svr/v1/session_svr/remove_session",{talker_id:t,session_type:e,build:0,mobi_app:"web",csrf_token:aa.BILIJCT,csrf:aa.BILIJCT})}(t);break;case"read":await function({talker_id:t,session_type:e,ack_seqno:n}){return eu.post("/session_svr/v1/session_svr/update_ack",{talker_id:t,session_type:e,ack_seqno:n,build:0,mobi_app:"web",csrf_token:aa.BILIJCT,csrf:aa.BILIJCT},{headers:{origin:ec}})}(t)}await ua(50)}var If={taskReward:async function(){Bo.info("----【每日任务完成情况】----");try{const{data:t,message:e,code:n}=await Zc.get("/x/member/web/exp/reward");await ua();const{data:r}=await cu();if(0!=n)return void Bo.warn(`状态获取失败: ${n} ${e}`);const i=sa.money-aa.BILI_STAY_COINS;let o=0;0===sa.coinsTask?Bo.info(`今日投币获取经验: ${r}，还需投币0颗，经验够了，不想投了`):i<=0?Bo.info(`今日投币获取经验: ${r}，还需投币0颗，硬币不够了，不投币了`):i<sa.coinsTask?(o=sa.coinsTask-i,Bo.info(`投币获取经验: ${r}，还需投币数量: ${o}颗;(目标${sa.coinsTask}颗，忽略部分投币)`)):(o=sa.coinsTask-r/10,Bo.info(`投币获取经验: ${r}，还需投币数量: ${o}颗;(目标${sa.coinsTask}颗)`)),sa.coinsTask=o,Bo.info("每日分享: "+(t.share?"已完成":"[未完成]")),Bo.info("每日播放: "+(t.watch?"已完成":"[未完成]")),sa.share=t.share,sa.watch=t.watch}catch(t){Bo.error(`状态获取异常 ${t.message}`)}},liveSignTask:async function(){Bo.info("----【直播签到】----");try{const{data:t}=await Xc.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return Bo.info("已签到，跳过签到"),void Bo.info(`已经签到${t.hadSignDays}天，${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await Xc.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?Bo.info(`直播签到成功: ${e.text}，特别信息: ${e.specialText}，本月签到天数: ${e.hadSignDays}天;`):Bo.warn(`直播签到失败: ${t} ${n}`)}catch(t){Bo.error(`直播签到异常: ${t.message}`)}},shareAndWatch:async function(){if(Bo.info("----【分享/播放视频】----"),sa.share&&sa.watch)return void Bo.info("已完成，跳过分享/播放");let t=0;try{let e=await Ou();if("-1"===e.msg&&(e=await wu()),"0"!==e.msg)return Bo.warn(`获取视频失败 ${e.msg}`),!1;{const{id:n,author:r,title:i}=e.data;t=n,Bo.info(`获取视频: ${i} --up【${r}】`)}}catch(t){return Bo.error(`获取视频出现异常: ${t.message}`),!1}if(!sa.share){await ua();try{const{code:e,message:n}=await function(t){const e={csrf:aa.BILIJCT,aid:t};return Zc.post("/x/web-interface/share/add",e)}(t);0===e?Bo.info("分享视频成功!"):Bo.warn(`分享视频失败: ${e} ${n}`)}catch(t){Bo.error(`分享视频异常: ${t.message}`)}}if(!sa.watch){await ua();try{const{code:r,message:i}=await(e=t,n=So(4,60),Zc.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?Bo.info("播放视频成功!"):Bo.warn(`播放视频失败: ${r} ${i}`)}catch(t){Bo.error(`播放视频异常: ${t.message}`)}}var e,n},silver2Coin:async function(){Bo.info("----【银瓜子兑换硬币】----");try{const{data:t,code:e,message:n}=await Xc.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&Bo.info(`获取瓜子详情失败 ${n}`),0===t.silver_2_coin_left)Bo.info("今日已兑换一次");else if(t.silver<700)Bo.info("兑换失败，你瓜子不够了");else{const{message:t}=await Xc.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:aa.BILIJCT,csrf:aa.BILIJCT});Bo.info(`兑换硬币： ${t}`),await Xc.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){Bo.error(`操作异常 ${t.message}`)}},addCoins:async function(){if(Bo.info("----【视频投币】----"),!sa.coinsTask)return void Bo.info("跳过投币，今日已完成");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;sa.coinsTask&&!e&&t.eCount<5;)e=await Cu(t);t.eCount>=5&&Bo.info("出现异常/错误5次，自动退出投币"),Bo.info(`一共成功投币${t.num}颗`),Bo.info(`硬币还剩${sa.money}颗`)},mangaSign:async function(){Bo.info("----【漫画签到】----");try{const{code:t}=await function(t="android"){return tu.post("/twirp/activity.v1.Activity/ClockIn",{platform:t})}();0==t?Bo.info("漫画签到成功"):Bo.warn("漫画签到失败")}catch(e){var t;400===(null===(t=e.response)||void 0===t?void 0:t.status)?Bo.info("已经签到过了，跳过任务"):Bo.error(`漫画签到异常 ${e.message}`)}},supGroupSign:async function(){Bo.info("----【应援团签到】----");const t=await Pu();await ua();let e=0;for(let i=0;i<t.length;){const o=t[i];try{const{data:t,code:i,message:a}=await(n=o.group_id,r=o.owner_uid,eu.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===i?0===t.status?e++:Bo.info(a):Bo.warn(`[${o.group_name}]签到失败 ${a}`)}catch(t){Bo.error(`签到异常 ${t.message}`)}finally{await ua()}}var n,r;Bo.info(`签到结束，成功${e}/${t.length}`)},liveSendMessage:async function(){Bo.info("----【发送直播弹幕】----"),Bo.info("该函数即将废弃，请使用 liveIntimacy 替代");try{const t=await Lu(),e=t.length;let n=0,r=0;Bo.info(`一共需要发送${e}个直播间`),Bo.verbose("所需时间可能很长，请耐心等待");for(let i=0;i<e;i++){const{room_info:o,anchor_info:a,medal:s}=t[i];null!=o&&o.room_id?100===s.today_feed||s.level>=20?r++:(await Ru(o.room_id,a.nick_name)&&n++,i<e-1&&await ua(So(1e4,25e3))):(Bo.info(`【${a.nick_name}】没有直播间哦`),r++)}Bo.info(`成功发送${n}个弹幕，跳过${r}个`)}catch(t){Bo.error(`直播间发送弹幕异常: ${t.message}`)}},charging:async function(){if(Bo.info("----【给目标充电】----"),await Du(),await ua(),Mu())try{const t=sa.bCoinCouponBalance||0,e=aa.CHARGE_ID;let n=0;Bo.info(`b 币券余额${t}`);const r=async()=>{const{code:n,message:r,data:i}=await function(t=50,e=!0,n=aa.USERID,r="up",i=n){return Zc.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:aa.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:i})}(t,!0,e);0===n?(Bo.info(`【充值结果】${Gu[i.status]}`),i.status===Gu["成功"]&&(sa.chargeOrderNo=i.order_no,await ua(),await async function(){try{if(!sa.chargeOrderNo)return!1;const t=m[So(0,m.length-1)],{code:e}=await function(t,e="支持大佬一波"){return Zc.post("/x/ugcpay/trade/elec/message",{csrf:aa.BILIJCT,message:e,order_id:t})}(sa.chargeOrderNo,t);0===e&&Bo.info("留言成功！")}catch{}}())):Bo.warn(`充电失败：${n} ${r}`)};for(sa.chargeOrderNo="";!(sa.chargeOrderNo||(await r(),await ua(),n++>2)););}catch(t){Bo.error(`充电出现异常：${t.message}`)}},getVipPrivilege:async function(){try{if(Bo.info("----【领取大会员权益】----"),2!==sa.vipType)return Bo.info("账号非年度大会员，不需要领取权益"),!1;const t=await qu();if(0===t.length)return void Bo.info("已经领取过权益，不需要再领取");for(let e=0;e<t.length;e++){const n=t[e];await Hu(n.type)}}catch(t){Bo.error(`领取大会员权益出现异常：${t.message}`)}},giveGift:async function(){Bo.info("----【投喂过期食物】----");try{const t=await Ju();if(await ua(),null==t||!t.length)return void Bo.info("没有2天内过期的简单礼物");const e=await async function(){const t=Object.assign([],aa.BILI_GIFT_UP),e=()=>t.splice(So(aa.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await Yu(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await iu();if(await ua(),!t)return;const n=e[So(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void Bo.info("没有找到投喂目标");await async function({roomid:t,mid:e,name:n},r){for(const i of r){await ua();try{const{code:r,message:o,data:a}=await ou({roomid:t,ruid:e,bag_id:i.bag_id,gift_id:i.gift_id,gift_num:i.gift_num});if(0!==r){Bo.warn(`向[${n}]投喂[${i.gift_name}]，${o}`);continue}a.gift_list.forEach((t=>{Bo.info(`成功给 [${n}] 投喂${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){Bo.info(`投喂过期食物异常 ${t}`)}},matchGame:async function(){if(Bo.info("----【赛事硬币竞猜】----"),aa.MATCH_COINS<=0)return void Bo.info("硬币数量不能小于 0");if(Qu())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:r}}=await function(t="",e=""){return Zc.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`)}();return 0!==t?void Bo.warn(`获取赛事错误 ${t} ${e}`):0===r.total?(Bo.info("今日已经无法获取赛事"),null):n}catch(t){}}();if(await ua(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,i=t.id,[{id:o,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(Qu())return e;if(c)continue;Bo.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=aa.MATCH_SELECTION>0?l?f:u:l?u:f,Bo.info(`预测[ ${d.option} ] ${aa.MATCH_COINS} 颗硬币`),await ua();const{code:p}=await zu(i,o,d.detail_id,aa.MATCH_COINS);0!==p?Bo.info("预测失败"):(e++,sa.money-=aa.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:i}]=n;if(i)return!1;const[o,a]=r;return Math.abs(o.odds-a.odds)>=e}))}(t,aa.MATCH_DIFF));Bo.info(`【竞猜结束】一共参与${e}次预测`)},liveLottery:async function(){Bo.info("----【天选时刻】----");const t=await bf();if(!t)return t;try{const t=await Wu();Bo.info(`最后一个关注的UP: ${t.uname}`);const e=await async function(){cf=[];const{pageNum:t}=aa.lottery,e=await uf();for(const n of e)for(const e of n)await gf(e.areaId,e.parentId,t);return cf}();Bo.info("扫描完成");const n=[];await tf(n,e,null==t?void 0:t.mid),await Zu(n),Bo.info("移动关注UP到分组成功")}catch(t){Bo.warn(`天选时刻异常: ${t.message}`),Bo.debug(t)}Bo.info("结束天选时刻")},liveRedPack:async function(){Bo.info("----【天选红包】----");try{const t=await Wu();Bo.info(`最后一个关注的UP: ${t.uname}`);const e=await async function(){cf=[];const{pageNum:t}=aa.lottery,e=await uf();for(const n of e)for(const e of n)await _f(e.areaId,e.parentId,t);return cf}();Bo.info("扫描完成，获取新关注的UP");const n=[];await tf(n,e,null==t?void 0:t.mid),Bo.info("开始读取消息"),await Tf(n),Bo.info("移动关注UP到分组"),await Zu(n),Bo.info("移动关注UP到分组成功")}catch(t){Bo.warn(`天选时刻异常: ${t.message}`),Bo.debug(t)}Bo.info("结束天选红包")},liveIntimacy:async function(){Bo.info("----【直播亲密度】----");try{await ju(),Bo.info("直播亲密度完成")}catch(t){Bo.error(`直播亲密度: ${t.message}`)}}};async function Of(t,...e){jo.pushValue="";try{await async function(){Bo.info("----【登录】----");const{data:t,message:e,code:n}=await su();if(0!==n)throw Bo.error(`登录错误 ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("接口返回为未登录");await ua(),await du(t)}()}catch(t){return Bo.error(`登录失败: ${t}`),await Wc("登录失败",jo.pushValue),"未完成"}const n=hc([...Object.values(If)]);for(const t of n)try{await t()}catch(e){Bo.error(`${t.name}失败: ${e}`)}finally{await ua()}return t&&await t(...e),await Wc("每日完成",jo.pushValue),"完成"}function Ef(t,e,n,r,i){const o=Xo(aa.COOKIE),a=o,s=[Zo(aa.COOKIE),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))];return{ua:aa.USER_AGENT,id:[n,e,i,t],csrf_token:o,csrf:a,device:s,uname:r}}async function Cf(){try{await gc.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat")}catch{}}async function Pf(t){const{data:{area_id:e,parent_area_id:n,room_id:r}}=await function(t){return Xc.get(`/room/v1/Room/get_info?room_id=${t}&from=room`)}(t);return{room_id:r,area_id:e,parent_area_id:n}}async function xf(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:r,code:i}=await function(t){return gc.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",t)}(n);if(0===i)return Bo.info(`进入【${t.uname}】的直播间`),e.v++,r}catch(t){Bo.verbose(t)}}async function kf(t,e,n){if(n.v>6)return;const r={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},i=function(t,e){const[n,r,i,o]=JSON.parse(t.id),[a,s]=JSON.parse(t.device),{ets:c,time:f,ts:l}=t,d={platform:"web",parent_id:n,area_id:r,seq_id:i,room_id:o,buvid:a,uuid:s,ets:c,time:f,ts:l},p=t.benchmark,g=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let m=JSON.stringify(d);for(const t of e)m=u.createHmac(g[t],p).update(m).digest("hex");return m}(r,t.secret_rule);try{const{data:t,code:o,message:a}=await function(t){return gc.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",t)}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:i},r));return 0===o?(Bo.info(`向【${e.uname}】发送第${n.v}次心跳`),n.v++):Bo.warn(`向【${e.uname}】发送第${n.v}次心跳失败 ${o} ${a}`),t}catch(t){Bo.verbose(t)}}async function Lf(t=1,e=10){try{const{code:n,message:r,data:i}=await iu(t,e);return 0!==n?(Bo.verbose(`获取直播间失败 ${n} ${r}`),null):i}catch(t){return Bo.verbose(`获取直播间异常 ${t.message}`),null}}async function Nf(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:r,code:i}=await ru();return 0!==i||(null===(e=r.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=r.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/864e5;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await Lf();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await Lf(e,10);t.push(...n.items)}}return t}():({items:n}=await Lf()),{fansMedalList:n,heartNum:e}}async function Rf(t){let e,n;if(t){const{d:r,hn:i}=JSON.parse(t);e="string"==typeof r?JSON.parse(so(r)):r||[{seq:{v:0}}],n=i||{v:0}}else e=[{seq:{v:0}}],n={v:0};let r=0;if(e[0]&&!e[0].seq.v){e.length=0;const{heartNum:t,fansMedalList:i}=await Nf();n.v=t;for(const t of i){if(0===n.v)return Bo.info("今日获取小星星已经达到 24"),0;if(r>=n.v)break;const{roomid:i,uname:o}=t,{room_id:a,area_id:s,parent_area_id:c}=await Pf(i),u={v:0},f=Ef(a,s,c,o,u.v);await Cf(),await ua(500);const l=await xf(f,u);e.push({data:l,baseData:f,seq:u}),r++}}else{!function(t){const e=Zo(aa.COOKIE),n=Xo(aa.COOKIE),r=aa.USER_AGENT;t.forEach((t=>{t.baseData.ua=r,t.baseData.csrf=t.baseData.csrf_token=n,t.baseData.device[0]=e,t.baseData.id[2]=t.seq.v}))}(e);for(const t of e)if(await Cf(),t.data&&(t.data=await kf(t.data,t.baseData,t.seq)),await ua(1e3),r++,t.seq.v>5&&(t.seq.v=0,r>=n.v))return Bo.info("今日获取小心心完成"),0;if(e.find((t=>t.seq.v>5)))return 1}return function(t){t.forEach((t=>{delete t.baseData.csrf,delete t.baseData.csrf_token,delete t.baseData.ua,t.baseData.device[0]=0}))}(e),{d:ao(JSON.stringify(e)),hn:n,l:e.length}}function Af(t,e){return"scf"===t?e.Message:e.payload}async function Uf(t,e,n){const r="scf"===t?(await Promise.resolve().then((function(){return Bf}))).default:(await Promise.resolve().then((function(){return Df}))).default;return(...t)=>r(e,n,...t)}var jf=Object.freeze({__proto__:null,dailyHandle:async function({event:t,context:e,slsType:n}){const r=Af(n,t),i=await Uf(n,t,e);let o;try{o=JSON.parse(r)}catch(t){}return o&&o.lastTime===bo().getDate().toString()?"今日重复执行":await Of(i)},liveHeartHandle:async function({event:t,context:e,slsType:n}){const r=Af(n,t),i=await Uf(n,t,e);let o;try{o=JSON.parse(r)}catch(t){}if(o&&!o.d&&o.lastTime===bo().getDate().toString())return"今日重复执行";const a=await Rf(r);return 0===a?(await i(),"今日完成"):1===a?(await i({hn:{v:0},d:[{seq:{v:0}}]},To(5e3,n)),"等待继续下一轮心跳"):(await i(a,To(62e3-1e3*a.l,n)),"等待继续下次心跳")}});var Bf=Object.freeze({__proto__:null,default:async function(t,e,n,r,i=2){if(!t.TriggerName)return!1;if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return Bo.info("环境变量不存在TENCENT_SECRET_ID和TENCENT_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return c(require("tencentcloud-sdk-nodejs"))}))}catch{Bo.warn("tencentcloud-sdk-nodejs not found，运行 cd src && yarn add tencentcloud-sdk-nodejs")}}();if(!o)return!1;const a=o.scf.v20180416.Client,s=e.function_name,u=t.TriggerName,f=new a({credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:e.tencentcloud_region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}});async function l(){const t=r||Io(aa.dailyRunTime,"scf"),e={FunctionName:s,TriggerName:u,Type:"timer",TriggerDesc:t.value,Qualifier:"$DEFAULT"},i=await async function(){try{const{Triggers:t}=await f.ListTriggers({FunctionName:s});return-1!==(null==t?void 0:t.findIndex((t=>t.TriggerName===u)))}catch({code:t,message:e}){return Bo.error(`获取trigger失败 ${t} => ${e}`),!1}}();if(Bo.info(`修改时间为：${t.string}`),i){const t=await async function(t){try{return await f.DeleteTrigger(t)}catch({code:t,message:e}){return Bo.warn(`删除trigger失败 ${t} => ${e}`),!1}}(e);if(!t)return}return!!await async function(t){const e=bo();t.CustomArgument=JSON.stringify({...n,lastTime:e.getDate().toString()});try{return await f.CreateTrigger(t)}catch({code:t,message:e}){return Bo.error(`创建trigger失败 ${t} => ${e}`),!1}}(e)}let d=!1;for(;!d&&i;)d=await l(),i--;return d}});var Df=Object.freeze({__proto__:null,default:async function(t,e,n,r,i=2){if(!t.triggerName)return!1;if(!process.env.ALI_SECRET_ID||!process.env.ALI_SECRET_KEY)return Bo.info("环境变量不存在ALI_SECRET_ID和ALI_SECRET_KEY"),!1;const o=await async function(){try{return await Promise.resolve().then((function(){return c(require("@alicloud/fc2"))}))}catch{Bo.warn("@alicloud/fc2 not found，运行 yarn add @alicloud/fc2")}}();if(!o)return!1;const a=o.default,s=e.function.name,u=t.triggerName,f=e.service.name,l=new a(e.accountId,{accessKeyID:process.env.ALI_SECRET_ID,accessKeySecret:process.env.ALI_SECRET_KEY,region:e.region});async function d(){const t=r||Io(aa.dailyRunTime,"fc");return Bo.info(`修改时间为：${t.string}`),!!await async function(t){const e=bo(),r=`CRON_TZ=Asia/Shanghai ${t}`;try{return await l.updateTrigger(f,s,u,{triggerConfig:{cronExpression:r,payload:JSON.stringify({...n,lastTime:e.getDate().toString()})}})}catch(t){return Bo.error(`更新trigger失败 ${t.message}`),!1}}(t.value)}let p=!1;for(;!p&&i;)p=await d(),i--;return p}});
