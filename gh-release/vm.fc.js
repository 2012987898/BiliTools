"use strict";var t=require("zlib"),e=require("crypto"),n=require("path"),r=require("fs");require("vm");var o=require("nodemailer"),i=require("tunnel"),a=require("got"),s=require("json5");function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function u(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var f=u(e),l=u(n),d=u(o),p=u(i),g=c(a),m=u(s);const h=["棒","棒唉","棒耶","加油~","UP加油!","支持~","支持支持！","催更啦","顶顶","留下脚印~","干杯","bilibili干杯","o(*￣▽￣*)o","(｡･∀･)ﾉﾞ嗨","(●ˇ∀ˇ●)","( •̀ ω •́ )y","(ง •_•)ง",">.<","^_~"],y=["舰","船","航海","代金券","优惠券","自拍","照","写真","图","提督","车车一局","再来一局","游戏道具"],_=["谢"],v=[65566781,1277481241,1643654862,603676925];var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},b=function(t){return t&&t.Math==Math&&t},T=b("object"==typeof globalThis&&globalThis)||b("object"==typeof window&&window)||b("object"==typeof self&&self)||b("object"==typeof w&&w)||function(){return this}()||Function("return this")(),$={},O=function(t){try{return!!t()}catch(t){return!0}},E=!O((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),S=!O((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),I=S,C=Function.prototype.call,P=I?C.bind(C):function(){return C.apply(C,arguments)},x={},A={}.propertyIsEnumerable,R=Object.getOwnPropertyDescriptor,L=R&&!A.call({1:2},1);x.f=L?function(t){var e=R(this,t);return!!e&&e.enumerable}:A;var N,k,U=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},j=S,B=Function.prototype,D=B.bind,G=B.call,M=j&&D.bind(G,G),q=j?function(t){return t&&M(t)}:function(t){return t&&function(){return G.apply(t,arguments)}},H=q,K=H({}.toString),Y=H("".slice),J=function(t){return Y(K(t),8,-1)},F=q,z=O,Q=J,W=T.Object,X=F("".split),V=z((function(){return!W("z").propertyIsEnumerable(0)}))?function(t){return"String"==Q(t)?X(t,""):W(t)}:W,Z=T.TypeError,tt=function(t){if(null==t)throw Z("Can't call method on "+t);return t},et=V,nt=tt,rt=function(t){return et(nt(t))},ot=function(t){return"function"==typeof t},it=ot,at=function(t){return"object"==typeof t?null!==t:it(t)},st=T,ct=ot,ut=function(t){return ct(t)?t:void 0},ft=function(t,e){return arguments.length<2?ut(st[t]):st[t]&&st[t][e]},lt=q({}.isPrototypeOf),dt=T,pt=ft("navigator","userAgent")||"",gt=dt.process,mt=dt.Deno,ht=gt&&gt.versions||mt&&mt.version,yt=ht&&ht.v8;yt&&(k=(N=yt.split("."))[0]>0&&N[0]<4?1:+(N[0]+N[1])),!k&&pt&&(!(N=pt.match(/Edge\/(\d+)/))||N[1]>=74)&&(N=pt.match(/Chrome\/(\d+)/))&&(k=+N[1]);var _t=k,vt=O,wt=!!Object.getOwnPropertySymbols&&!vt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&_t&&_t<41})),bt=wt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Tt=ft,$t=ot,Ot=lt,Et=bt,St=T.Object,It=Et?function(t){return"symbol"==typeof t}:function(t){var e=Tt("Symbol");return $t(e)&&Ot(e.prototype,St(t))},Ct=T.String,Pt=function(t){try{return Ct(t)}catch(t){return"Object"}},xt=ot,At=Pt,Rt=T.TypeError,Lt=function(t){if(xt(t))return t;throw Rt(At(t)+" is not a function")},Nt=Lt,kt=function(t,e){var n=t[e];return null==n?void 0:Nt(n)},Ut=P,jt=ot,Bt=at,Dt=T.TypeError,Gt={exports:{}},Mt=T,qt=Object.defineProperty,Ht=function(t,e){try{qt(Mt,t,{value:e,configurable:!0,writable:!0})}catch(n){Mt[t]=e}return e},Kt=Ht,Yt=T["__core-js_shared__"]||Kt("__core-js_shared__",{}),Jt=Yt;(Gt.exports=function(t,e){return Jt[t]||(Jt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.7",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.7/LICENSE",source:"https://github.com/zloirock/core-js"});var Ft=tt,zt=T.Object,Qt=function(t){return zt(Ft(t))},Wt=Qt,Xt=q({}.hasOwnProperty),Vt=Object.hasOwn||function(t,e){return Xt(Wt(t),e)},Zt=q,te=0,ee=Math.random(),ne=Zt(1..toString),re=function(t){return"Symbol("+(void 0===t?"":t)+")_"+ne(++te+ee,36)},oe=T,ie=Gt.exports,ae=Vt,se=re,ce=wt,ue=bt,fe=ie("wks"),le=oe.Symbol,de=le&&le.for,pe=ue?le:le&&le.withoutSetter||se,ge=function(t){if(!ae(fe,t)||!ce&&"string"!=typeof fe[t]){var e="Symbol."+t;ce&&ae(le,t)?fe[t]=le[t]:fe[t]=ue&&de?de(e):pe(e)}return fe[t]},me=P,he=at,ye=It,_e=kt,ve=function(t,e){var n,r;if("string"===e&&jt(n=t.toString)&&!Bt(r=Ut(n,t)))return r;if(jt(n=t.valueOf)&&!Bt(r=Ut(n,t)))return r;if("string"!==e&&jt(n=t.toString)&&!Bt(r=Ut(n,t)))return r;throw Dt("Can't convert object to primitive value")},we=ge,be=T.TypeError,Te=we("toPrimitive"),$e=function(t,e){if(!he(t)||ye(t))return t;var n,r=_e(t,Te);if(r){if(void 0===e&&(e="default"),n=me(r,t,e),!he(n)||ye(n))return n;throw be("Can't convert object to primitive value")}return void 0===e&&(e="number"),ve(t,e)},Oe=It,Ee=function(t){var e=$e(t,"string");return Oe(e)?e:e+""},Se=at,Ie=T.document,Ce=Se(Ie)&&Se(Ie.createElement),Pe=function(t){return Ce?Ie.createElement(t):{}},xe=Pe,Ae=!E&&!O((function(){return 7!=Object.defineProperty(xe("div"),"a",{get:function(){return 7}}).a})),Re=E,Le=P,Ne=x,ke=U,Ue=rt,je=Ee,Be=Vt,De=Ae,Ge=Object.getOwnPropertyDescriptor;$.f=Re?Ge:function(t,e){if(t=Ue(t),e=je(e),De)try{return Ge(t,e)}catch(t){}if(Be(t,e))return ke(!Le(Ne.f,t,e),t[e])};var Me={},qe=E&&O((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),He=T,Ke=at,Ye=He.String,Je=He.TypeError,Fe=function(t){if(Ke(t))return t;throw Je(Ye(t)+" is not an object")},ze=E,Qe=Ae,We=qe,Xe=Fe,Ve=Ee,Ze=T.TypeError,tn=Object.defineProperty,en=Object.getOwnPropertyDescriptor;Me.f=ze?We?function(t,e,n){if(Xe(t),e=Ve(e),Xe(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=en(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return tn(t,e,n)}:tn:function(t,e,n){if(Xe(t),e=Ve(e),Xe(n),Qe)try{return tn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Ze("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var nn=Me,rn=U,on=E?function(t,e,n){return nn.f(t,e,rn(1,n))}:function(t,e,n){return t[e]=n,t},an={exports:{}},sn=E,cn=Vt,un=Function.prototype,fn=sn&&Object.getOwnPropertyDescriptor,ln=cn(un,"name"),dn={EXISTS:ln,PROPER:ln&&"something"===function(){}.name,CONFIGURABLE:ln&&(!sn||sn&&fn(un,"name").configurable)},pn=ot,gn=Yt,mn=q(Function.toString);pn(gn.inspectSource)||(gn.inspectSource=function(t){return mn(t)});var hn,yn,_n,vn=gn.inspectSource,wn=ot,bn=vn,Tn=T.WeakMap,$n=wn(Tn)&&/native code/.test(bn(Tn)),On=Gt.exports,En=re,Sn=On("keys"),In=function(t){return Sn[t]||(Sn[t]=En(t))},Cn={},Pn=$n,xn=T,An=q,Rn=at,Ln=on,Nn=Vt,kn=Yt,Un=In,jn=Cn,Bn=xn.TypeError,Dn=xn.WeakMap;if(Pn||kn.state){var Gn=kn.state||(kn.state=new Dn),Mn=An(Gn.get),qn=An(Gn.has),Hn=An(Gn.set);hn=function(t,e){if(qn(Gn,t))throw new Bn("Object already initialized");return e.facade=t,Hn(Gn,t,e),e},yn=function(t){return Mn(Gn,t)||{}},_n=function(t){return qn(Gn,t)}}else{var Kn=Un("state");jn[Kn]=!0,hn=function(t,e){if(Nn(t,Kn))throw new Bn("Object already initialized");return e.facade=t,Ln(t,Kn,e),e},yn=function(t){return Nn(t,Kn)?t[Kn]:{}},_n=function(t){return Nn(t,Kn)}}var Yn={set:hn,get:yn,has:_n,enforce:function(t){return _n(t)?yn(t):hn(t,{})},getterFor:function(t){return function(e){var n;if(!Rn(e)||(n=yn(e)).type!==t)throw Bn("Incompatible receiver, "+t+" required");return n}}},Jn=O,Fn=ot,zn=Vt,Qn=E,Wn=dn.CONFIGURABLE,Xn=vn,Vn=Yn.enforce,Zn=Yn.get,tr=Object.defineProperty,er=Qn&&!Jn((function(){return 8!==tr((function(){}),"length",{value:8}).length})),nr=String(String).split("String"),rr=an.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!zn(t,"name")||Wn&&t.name!==e)&&tr(t,"name",{value:e,configurable:!0}),er&&n&&zn(n,"arity")&&t.length!==n.arity&&tr(t,"length",{value:n.arity});try{n&&zn(n,"constructor")&&n.constructor?Qn&&tr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Vn(t);return zn(r,"source")||(r.source=nr.join("string"==typeof e?e:"")),t};Function.prototype.toString=rr((function(){return Fn(this)&&Zn(this).source||Xn(this)}),"toString");var or=ot,ir=on,ar=an.exports,sr=Ht,cr={},ur=Math.ceil,fr=Math.floor,lr=Math.trunc||function(t){var e=+t;return(e>0?fr:ur)(e)},dr=function(t){var e=+t;return e!=e||0===e?0:lr(e)},pr=dr,gr=Math.max,mr=Math.min,hr=dr,yr=Math.min,_r=function(t){return t>0?yr(hr(t),9007199254740991):0},vr=function(t){return _r(t.length)},wr=rt,br=function(t,e){var n=pr(t);return n<0?gr(n+e,0):mr(n,e)},Tr=vr,$r=function(t){return function(e,n,r){var o,i=wr(e),a=Tr(i),s=br(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},Or={includes:$r(!0),indexOf:$r(!1)},Er=Vt,Sr=rt,Ir=Or.indexOf,Cr=Cn,Pr=q([].push),xr=function(t,e){var n,r=Sr(t),o=0,i=[];for(n in r)!Er(Cr,n)&&Er(r,n)&&Pr(i,n);for(;e.length>o;)Er(r,n=e[o++])&&(~Ir(i,n)||Pr(i,n));return i},Ar=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Rr=xr,Lr=Ar.concat("length","prototype");cr.f=Object.getOwnPropertyNames||function(t){return Rr(t,Lr)};var Nr={};Nr.f=Object.getOwnPropertySymbols;var kr=ft,Ur=cr,jr=Nr,Br=Fe,Dr=q([].concat),Gr=kr("Reflect","ownKeys")||function(t){var e=Ur.f(Br(t)),n=jr.f;return n?Dr(e,n(t)):e},Mr=Vt,qr=Gr,Hr=$,Kr=Me,Yr=function(t,e,n){for(var r=qr(e),o=Kr.f,i=Hr.f,a=0;a<r.length;a++){var s=r[a];Mr(t,s)||n&&Mr(n,s)||o(t,s,i(e,s))}},Jr=O,Fr=ot,zr=/#|\.prototype\./,Qr=function(t,e){var n=Xr[Wr(t)];return n==Zr||n!=Vr&&(Fr(e)?Jr(e):!!e)},Wr=Qr.normalize=function(t){return String(t).replace(zr,".").toLowerCase()},Xr=Qr.data={},Vr=Qr.NATIVE="N",Zr=Qr.POLYFILL="P",to=Qr,eo=T,no=$.f,ro=on,oo=function(t,e,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:e;return or(n)&&ar(n,i,r),r.global?o?t[e]=n:sr(e,n):(r.unsafe?t[e]&&(o=!0):delete t[e],o?t[e]=n:ir(t,e,n)),t},io=Ht,ao=Yr,so=to,co=function(t,e){var n,r,o,i,a,s=t.target,c=t.global,u=t.stat;if(n=c?eo:u?eo[s]||io(s,{}):(eo[s]||{}).prototype)for(r in e){if(i=e[r],o=t.dontCallGetSet?(a=no(n,r))&&a.value:n[r],!so(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;ao(i,o)}(t.sham||o&&o.sham)&&ro(i,"sham",!0),oo(n,r,i,t)}},uo=S,fo=Function.prototype,lo=fo.apply,po=fo.call,go="object"==typeof Reflect&&Reflect.apply||(uo?po.bind(lo):function(){return po.apply(lo,arguments)}),mo=T,ho=ot,yo=mo.String,_o=mo.TypeError,vo=q,wo=Fe,bo=function(t){if("object"==typeof t||ho(t))return t;throw _o("Can't set "+yo(t)+" as a prototype")},To=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=vo(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return wo(n),bo(r),e?t(n,r):n.__proto__=r,n}}():void 0),$o=Me.f,Oo=ot,Eo=at,So=To,Io={};Io[ge("toStringTag")]="z";var Co=T,Po="[object z]"===String(Io),xo=ot,Ao=J,Ro=ge("toStringTag"),Lo=Co.Object,No="Arguments"==Ao(function(){return arguments}()),ko=Po?Ao:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Lo(t),Ro))?n:No?Ao(e):"Object"==(r=Ao(e))&&xo(e.callee)?"Arguments":r},Uo=ko,jo=T.String,Bo=function(t){if("Symbol"===Uo(t))throw TypeError("Cannot convert a Symbol value to a string");return jo(t)},Do=function(t,e){return void 0===t?arguments.length<2?"":e:Bo(t)},Go=at,Mo=on,qo=function(t,e){Go(e)&&"cause"in e&&Mo(t,"cause",e.cause)},Ho=Error,Ko=q("".replace),Yo=String(Ho("zxcasd").stack),Jo=/\n\s*at [^:]*:[^\n]*/,Fo=Jo.test(Yo),zo=function(t,e){if(Fo&&"string"==typeof t&&!Ho.prepareStackTrace)for(;e--;)t=Ko(t,Jo,"");return t},Qo=U,Wo=!O((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Qo(1,7)),7!==t.stack)})),Xo=ft,Vo=Vt,Zo=on,ti=lt,ei=To,ni=Yr,ri=function(t,e,n){n in t||$o(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},oi=function(t,e,n){var r,o;return So&&Oo(r=e.constructor)&&r!==n&&Eo(o=r.prototype)&&o!==n.prototype&&So(t,o),t},ii=Do,ai=qo,si=zo,ci=Wo,ui=E,fi=co,li=go,di=function(t,e,n,r){var o="stackTraceLimit",i=r?2:1,a=t.split("."),s=a[a.length-1],c=Xo.apply(null,a);if(c){var u=c.prototype;if(Vo(u,"cause")&&delete u.cause,!n)return c;var f=Xo("Error"),l=e((function(t,e){var n=ii(r?e:t,void 0),o=r?new c(t):new c;return void 0!==n&&Zo(o,"message",n),ci&&Zo(o,"stack",si(o.stack,2)),this&&ti(u,this)&&oi(o,this,l),arguments.length>i&&ai(o,arguments[i]),o}));l.prototype=u,"Error"!==s?ei?ei(l,f):ni(l,f,{name:!0}):ui&&o in c&&(ri(l,c,o),ri(l,c,"prepareStackTrace")),ni(l,c);try{u.name!==s&&Zo(u,"name",s),u.constructor=l}catch(t){}return l}},pi=T.WebAssembly,gi=7!==Error("e",{cause:7}).cause,mi=function(t,e){var n={};n[t]=di(t,e,gi),fi({global:!0,constructor:!0,arity:1,forced:gi},n)},hi=function(t,e){if(pi&&pi[t]){var n={};n[t]=di("WebAssembly."+t,e,gi),fi({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:gi},n)}};function yi(e){try{return t.gzipSync(encodeURIComponent(e)).toString("base64")}catch(t){return"Error: 当前字符串不能被Gzip压缩"}}function _i(e){try{const n=t.unzipSync(Buffer.from(e,"base64")).toString();try{return decodeURIComponent(function(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}(n))}catch(t){return unescape(n)}}catch(t){throw new Error("Error: 当前字符串不能被Gzip解压")}}mi("Error",(function(t){return function(e){return li(t,this,arguments)}})),mi("EvalError",(function(t){return function(e){return li(t,this,arguments)}})),mi("RangeError",(function(t){return function(e){return li(t,this,arguments)}})),mi("ReferenceError",(function(t){return function(e){return li(t,this,arguments)}})),mi("SyntaxError",(function(t){return function(e){return li(t,this,arguments)}})),mi("TypeError",(function(t){return function(e){return li(t,this,arguments)}})),mi("URIError",(function(t){return function(e){return li(t,this,arguments)}})),hi("CompileError",(function(t){return function(e){return li(t,this,arguments)}})),hi("LinkError",(function(t){return function(e){return li(t,this,arguments)}})),hi("RuntimeError",(function(t){return function(e){return li(t,this,arguments)}}));var vi=Me.f,wi=Vt,bi=ge("toStringTag"),Ti=T,$i=function(t,e,n){t&&!n&&(t=t.prototype),t&&!wi(t,bi)&&vi(t,bi,{configurable:!0,value:e})};co({global:!0},{Reflect:{}}),$i(Ti.Reflect,"Reflect",!0);const Oi=Object.prototype.toString;function Ei(t,e){return Oi.call(t)===`[object ${e}]`}function Si(t){return null!==t&&Ei(t,"Object")}function Ii(t){return Ei(t,"String")}function Ci(t){const e=t||Pi(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}function Pi(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function xi(t,e){return Math.ceil(e/t)}function Ai(t=6e4,e){t=t||6e4;const n=Pi().getTime()+t,r=new Date(n),o=r.getSeconds(),i=r.getMinutes();return Ni({hours:r.getHours(),minutes:i,seconds:o},e)}function Ri(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function Li(t="17:30:00-23:40:00",e){const n=t.split("-"),r=n[0].split(":").map((t=>+t)),o=n[1].split(":").map((t=>+t)),i=Ri(r[0]??19,o[0]??23);let a=0;a=i==r[0]?Ri(r[1],59):i==o[0]?Ri(o[1]):Ri(59);let s=0;return s=i==r[0]?Ri(r[2],59):i==o[0]?Ri(o[2]):Ri(59),Ni({seconds:s,hours:i,minutes:a},e)}function Ni({hours:t,minutes:e,seconds:n},r){let o;switch(n=n||0,r){case"scf":default:o=`${n} ${e} ${t} * * * *`;break;case"fc":o=`${n} ${e} ${t} * * *`;break;case"cfc":o=`corn(${e} ${t} * * *)`}return{value:o,string:`${t}:${e}:${n}`}}function ki(){return`${Ri(1,9)}${function(t,e){let n="";for(let e=0;e<t;e++)n+=Gi("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}(10,!0)}0`}function Ui(t,e){t.includes(e)||t.push(e)}function ji(t){return t||{}}function Bi(t,e){return void 0===t||void 0===e?t||e:Si(t)&&Si(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=Bi(t[r],e[r]),n)),t):e}function Di(t){if(!Si(t)&&(!(e=t)||!Array.isArray(e)))return t;var e;const n=new URLSearchParams;return Array.isArray(t)||(t=Object.entries(t)),t.forEach((([t,e])=>{Si(e)?n.append(t,JSON.stringify(e)):n.append(t,String(e))})),n.toString()}function Gi(t){return t[Ri(t.length-1)]}function Mi(t){return t?t.split("; ").map((t=>t.split("="))):[]}function qi(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=Mi(null==e?void 0:e[0]).filter((t=>2===t.length)),r=Mi(t).concat(n).filter((t=>2===t.length)),o={};for(const t of r)o[t[0]]?o[t[0]]=t[1]:Object.defineProperty(o,t[0],{value:t[1],enumerable:!0,writable:!0});return o}(t,e)):t:""}function Hi(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}function Ki(t){return Hi(t,"bili_jct")||""}function Yi(t){return Hi(t,"LIVE_BUVID")||""}const Ji={value:""},Fi={log:zi,error:function(t){zi("error",t)},warn:function(t){zi("warn",t)},info:function(t){zi("info",t)},verbose:function(t){zi("verbose",t)},debug:function(t){zi("debug",t)}};function zi(t,e){const n=Pi().toString().match(/\w{2}:\w{2}:\w{2}/)[0];if(function(t="debug"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}().includes(t)){const t=`[${n}] ${e}`;Ji.value+=t+"\n"}process.stdout.write(`[${t} ${n}] ${e}\n`)}const Qi=()=>process.env.QL_BRANCH;class Wi{static configFileName=function(){const t=Qi()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=Qi()}const Xi=m.default?m.default:m;function Vi(t){try{let e;if((r.existsSync(t)||r.existsSync(t+="5"))&&(e=r.readFileSync(t,"utf-8")),!e)return;return Fi.verbose(`读取配置文件 ${t}`),Xi.parse(e)}catch(t){!function(t){if(!Ii(t))return;throw new TypeError("配置文件存在，但是无法解析！可能 JSON5 格式不正确！")}(t.message)}}const Zi=t=>l.resolve(process.cwd(),t),ta=t=>l.resolve(__dirname,"../",t);function ea(t){throw new Error(t||"获取配置失败！未找到配置文件！")}const na=Array.from(new Set([Zi("./config/config.dev.json"),Zi(`./config/${Wi.configFileName}`),Zi(`./${Wi.configFileName}`),ta(`./config/${Wi.configFileName}`),ta(`./${Wi.configFileName}`)])),ra=["./config.json",Zi("./config/config.json")];function oa(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(Wi.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(Fi.warn("似乎想要指定一个不存在的用户，我们将指定第一个用户"),t[0]):t[n]}(e);Fi.warn("在单用户场景下配置了多用户，我们将放弃多余的配置");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function ia(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;Wi.isQingLongPanel&&na.splice(0,1,...ra);for(let t=0;t<na.length;t++){const e=Vi(na[t]);if(e)return e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return Xi.parse(_i(r))}catch{ea("环境中的配置不是有效的 JSON 字符串！")}})()}function aa(t){if(t||ea(),function(t){if(Array.isArray(t))return!0;return Boolean(t.account&&t.account.length)}(t)){const e=oa(t);if(e)return e}return t.cookie||ea("配置文件中没有 cookie！"),t}function sa(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}class ca{constructor(t){var e;this.config=t,this.COOKIE=t.cookie,this.BILIJCT=Ki(t.cookie),this.USERID=(e=t.cookie,Number(Hi(e,"DedeUserID"))||0),this.USER_AGENT=t.userAgent;const n=t.apiDelay??[2,6];this.BILI_API_DELAY=Array.isArray(n)?sa(n):[Number(n)];const r=ji(t.message);this.MESSAGE_API=r.api,this.PUSHPLUS_TOKEN=r.pushplusToken||process.env.PUSHPLUS_TOKEN;const o=ji(t.coin);this.BILI_CUSTOMIZE_UP=sa(o.customizeUp||t.customizeUp)||[],this.BILI_UPPER_ACC_MATCH=!1!==(o.upperAccMatch??t.upperAccMatch),this.BILI_COIN_RETRY_NUM=o.retryNum||t.coinRetryNum||4,this.BILI_TARGET_LEVEL=(o.targetLevel||t.targetLevel)??6,this.BILI_STAY_COINS=(o.stayCoins||t.stayCoins)??0,this.BILI_TARGET_COINS=(o.targetCoins||t.targetCoins)??5;const i=ji(t.gift);this.BILI_GIFT_UP=sa(i.mids||t.giftUp)||this.BILI_CUSTOMIZE_UP||[];const a=ji(t.charge);this.CHARGE_ID=a.mid||t.chargeUpId||this.USERID,this.CHARGE_PRESET_TIME=a.presetTime||t.chargePresetTime||31;const s=ji(t.match);this.MATCH_COINS=(s.coins||t.matchCoins)??5,this.MATCH_SELECTION=(s.selection||t.matchSelection)??1,this.MATCH_DIFF=(s.diff||t.matchDiff)??0;const c=ji(t.lottery);this.LOTTERY_EXCLUDE=c.excludeAward||y,this.LOTTERY_INCLUDE=c.includeAward||_,this.LOTTERY_UP_BLACKLIST=c.blackUid||v,this.LOTTERY_MOVE_TAG=c.moveTag,this.LOTTERY_PAGE_NUM=c.pageNum||2}}let ua;const fa=new Proxy({},{get:(t,e)=>(ua||da(),Reflect.get(ua,e)),set:(t,e,n)=>"config"===e&&n?(da(n),!0):Reflect.set(ua,e,n)});let la=null;function da(t){t||(t=aa(ia())),ua=new ca(aa(t)),la=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},la.coinsTask=ua.BILI_TARGET_COINS}function pa(t){const e=fa.BILI_API_DELAY;let n;n=t||(1===e.length?1e3*e[0]:1e3*Ri(e[0]||2,e[1]||6));const r=(new Date).getTime()+Number(n||0);for(;(new Date).getTime()<r;);return new Promise((t=>{t("done")}))}var ga=!O((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ma=T,ha=Vt,ya=ot,_a=Qt,va=ga,wa=In("IE_PROTO"),ba=ma.Object,Ta=ba.prototype,$a=va?ba.getPrototypeOf:function(t){var e=_a(t);if(ha(e,wa))return e[wa];var n=e.constructor;return ya(n)&&e instanceof n?n.prototype:e instanceof ba?Ta:null},Oa={},Ea=xr,Sa=Ar,Ia=Object.keys||function(t){return Ea(t,Sa)},Ca=E,Pa=qe,xa=Me,Aa=Fe,Ra=rt,La=Ia;Oa.f=Ca&&!Pa?Object.defineProperties:function(t,e){Aa(t);for(var n,r=Ra(e),o=La(e),i=o.length,a=0;i>a;)xa.f(t,n=o[a++],r[n]);return t};var Na,ka=ft("document","documentElement"),Ua=Fe,ja=Oa,Ba=Ar,Da=Cn,Ga=ka,Ma=Pe,qa=In("IE_PROTO"),Ha=function(){},Ka=function(t){return"<script>"+t+"<\/script>"},Ya=function(t){t.write(Ka("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ja=function(){try{Na=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ja="undefined"!=typeof document?document.domain&&Na?Ya(Na):((e=Ma("iframe")).style.display="none",Ga.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Ka("document.F=Object")),t.close(),t.F):Ya(Na);for(var n=Ba.length;n--;)delete Ja.prototype[Ba[n]];return Ja()};Da[qa]=!0;var Fa=Object.create||function(t,e){var n;return null!==t?(Ha.prototype=Ua(t),n=new Ha,Ha.prototype=null,n[qa]=t):n=Ja(),void 0===e?n:ja.f(n,e)},za=Lt,Qa=S,Wa=q(q.bind),Xa={},Va=Xa,Za=ge("iterator"),ts=Array.prototype,es=ko,ns=kt,rs=Xa,os=ge("iterator"),is=function(t){if(null!=t)return ns(t,os)||ns(t,"@@iterator")||rs[es(t)]},as=P,ss=Lt,cs=Fe,us=Pt,fs=is,ls=T.TypeError,ds=P,ps=Fe,gs=kt,ms=function(t,e){return za(t),void 0===e?t:Qa?Wa(t,e):function(){return t.apply(e,arguments)}},hs=P,ys=Fe,_s=Pt,vs=function(t){return void 0!==t&&(Va.Array===t||ts[Za]===t)},ws=vr,bs=lt,Ts=function(t,e){var n=arguments.length<2?fs(t):e;if(ss(n))return cs(as(n,t));throw ls(us(t)+" is not iterable")},$s=is,Os=function(t,e,n){var r,o;ps(t);try{if(!(r=gs(t,"return"))){if("throw"===e)throw n;return n}r=ds(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return ps(r),n},Es=T.TypeError,Ss=function(t,e){this.stopped=t,this.result=e},Is=Ss.prototype,Cs=function(t,e,n){var r,o,i,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=ms(e,f),m=function(t){return r&&Os(r,"normal",t),new Ss(!0,t)},h=function(t){return l?(ys(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(o=$s(t)))throw Es(_s(t)+" is not iterable");if(vs(o)){for(i=0,a=ws(t);a>i;i++)if((s=h(t[i]))&&bs(Is,s))return s;return new Ss(!1)}r=Ts(t,o)}for(c=r.next;!(u=hs(c,r)).done;){try{s=h(u.value)}catch(t){Os(r,"throw",t)}if("object"==typeof s&&s&&bs(Is,s))return s}return new Ss(!1)},Ps=co,xs=T,As=lt,Rs=$a,Ls=To,Ns=Yr,ks=Fa,Us=on,js=U,Bs=zo,Ds=qo,Gs=Cs,Ms=Do,qs=Wo,Hs=ge("toStringTag"),Ks=xs.Error,Ys=[].push,Js=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,o=As(Fs,this);Ls?n=Ls(new Ks,o?Rs(this):Fs):(n=o?this:ks(Fs),Us(n,Hs,"Error")),void 0!==e&&Us(n,"message",Ms(e)),qs&&Us(n,"stack",Bs(n.stack,1)),Ds(n,r);var i=[];return Gs(t,Ys,{that:i}),Us(n,"errors",i),n};Ls?Ls(Js,Ks):Ns(Js,Ks,{name:!0});var Fs=Js.prototype=ks(Ks.prototype,{constructor:js(1,Js),message:js(1,""),name:js(1,"AggregateError")});Ps({global:!0,constructor:!0,arity:2},{AggregateError:Js});var zs={},Qs=Lt,Ws=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Qs(e),this.reject=Qs(n)};zs.f=function(t){return new Ws(t)};var Xs,Vs=P,Zs=Lt,tc=ft,ec=zs,nc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},rc=Cs;co({target:"Promise",stat:!0},{any:function(t){var e=this,n=tc("AggregateError"),r=ec.f(e),o=r.resolve,i=r.reject,a=nc((function(){var r=Zs(e.resolve),a=[],s=0,c=1,u=!1;rc(t,(function(t){var f=s++,l=!1;c++,Vs(r,e,t).then((function(t){l||u||(u=!0,o(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||i(new n(a,"No one promise resolved")))}))})),--c||i(new n(a,"No one promise resolved"))}));return a.error&&i(a.value),r.promise}}),function(t){t[t.SUCCESS=0]="SUCCESS",t[t["应用程序不存在或已被封禁"]=-1]="应用程序不存在或已被封禁",t[t["Access Key错误"]=-2]="Access Key错误",t[t["API校验密匙错误"]=-3]="API校验密匙错误",t[t["调用方对该Method没有权限"]=-4]="调用方对该Method没有权限",t[t["账号未登录"]=-101]="账号未登录",t[t["账号被封停"]=-102]="账号被封停",t[t["积分不足"]=-103]="积分不足",t[t["硬币不足"]=-104]="硬币不足",t[t["验证码错误"]=-105]="验证码错误",t[t["账号非正式会员或在适应期"]=-106]="账号非正式会员或在适应期",t[t["应用不存在或者被封禁"]=-107]="应用不存在或者被封禁",t[t["未绑定手机?"]=-108]="未绑定手机?",t[t["未绑定手机"]=-110]="未绑定手机",t[t["csrf 校验失败"]=-111]="csrf 校验失败",t[t["系统升级中"]=-112]="系统升级中",t[t["账号尚未实名认证"]=-113]="账号尚未实名认证",t[t["请先绑定手机"]=-114]="请先绑定手机",t[t["请先完成实名认证"]=-115]="请先完成实名认证"}(Xs||(Xs={}));const oc="https://account.bilibili.com",ic="https://live.bilibili.com",ac="https://space.bilibili.com",sc="https://www.bilibili.com/",cc="https://account.bilibili.com",uc="https://api.live.bilibili.com",fc="https://api.bilibili.com",lc="https://manga.bilibili.com",dc="https://api.vc.bilibili.com",pc={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate, br"},gc=(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!1===n)return t.body;const{body:o}=t;if(e.isJsonp&&Ii(o))return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(o);try{if(Ii(o)&&o.startsWith("{"))return JSON.parse(o)}catch{}return o};class mc{name="VGot";constructor(t){t.baseURL&&(t.prefixUrl=t.baseURL),this.options=t,this.gotInstance=g.default.extend(t,{hooks:{afterResponse:[t=>{const{requestOptions:e}=t.request.options;var n;null!=e&&e.withBiliCookie&&(fa.COOKIE=qi(fa.COOKIE,(null===(n=t.headers)||void 0===n?void 0:n["set-cookie"])||[]));return t}]}})}request(t){const{requestOptions:e={},headers:n={}}=this.options;return t.requestOptions=Object.assign({},e,t.requestOptions),t.headers=Object.assign({},n,t.headers),e.withBiliCookie&&(t.headers.Cookie=fa.COOKIE),e.retry&&(t.retry=e.retry),t=function(t){var e;function n(e){t.agent||(t.agent={}),t.agent[e]=t[`${e}Agent`]}return Ii(t.url)||(t.url=t.url.toString()),Si(t.params)&&!Ii(t.searchParams)&&(t.searchParams={...t.searchParams,...t.params}),Si(t.data)&&(null!==(e=t.headers["content-type"])&&void 0!==e&&e.startsWith("application/x-www-form-urlencoded")?t.body=Di(t.data):t.json=t.data),t.httpAgent&&n("http"),t.httpsAgent&&n("https"),t.url&&t.url.startsWith("/")&&(t.url=t.url.substring(1)),t}(t),new Promise(((e,n)=>{this.gotInstance(t).then((r=>{{"function"!=typeof gc;try{const n=gc(r,t.requestOptions);e(n)}catch(t){n(t||new Error("请求错误!"))}}})).catch((t=>{n(t)}))}))}get(t,e){return Ii(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return Ii(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}}function hc(t){return new mc(Bi({timeout:1e4,headers:{"content-type":pc["content-type"],"user-agent":pc["user-agent"],"accept-language":pc["accept-language"],"accept-encoding":pc["accept-encoding"]},requestOptions:{isTransformResponse:!0,ignoreCancelToken:!0,withBiliCookie:!0}},t||{}))}const yc=hc({requestOptions:{withBiliCookie:!1}}),_c=hc();yc.name;const vc=async t=>{Fi.info(t||"阿里云 FC 测试ing")};async function wc(t,e){vc();const{dailyHandle:n}=await Promise.resolve().then((function(){return Lf}));return await n({event:t,context:e,slsType:"fc"})}async function bc(t,e){vc("功能开发中，敬请期待");const{liveHeartHandle:n}=await Promise.resolve().then((function(){return Lf}));return await n({event:t,context:e,slsType:"fc"})}Fi.info("开始执行网络代码"),Fi.info("当前版本【v0.5.0-rc0】"),(async()=>{const t=JSON.parse(event.toString());let e=wc;"heart_bili_timer"===t.triggerName&&(e=bc),e(t,context).then((t=>{VMThis.message=t,VMThis.resolve(VMThis.message)})).catch((t=>{VMThis.error=t,VMThis.reject(VMThis.error)}))})();const Tc={silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1,liveRedPack:!1};function $c(){return{...Tc}}function Oc(t){const e=function(){const t=$c();for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];switch((fa.config.function||{})[e]){case!0:!1===n&&(t[e]=!0);break;case!1:!0===n&&(t[e]=!1)}}return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}function Ec(){var t;const e=(null===(t=fa.config)||void 0===t?void 0:t.message)||{};["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((t=>{const n=e[(r=t,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||e[t]||process.env[t];var r;n&&(process.env[t]=n)})),fa.PUSHPLUS_TOKEN&&(process.env.PUSH_PLUS_TOKEN=fa.PUSHPLUS_TOKEN),function(){process.env.PUSH_KEY&&(Sc=process.env.PUSH_KEY);process.env.QQ_SKEY&&(Hc=process.env.QQ_SKEY);process.env.QQ_MODE&&(Kc=process.env.QQ_MODE);process.env.BARK_PUSH?(Ic=process.env.BARK_PUSH.indexOf("https")>-1||process.env.BARK_PUSH.indexOf("http")>-1?process.env.BARK_PUSH:`https://api.day.app/${process.env.BARK_PUSH}`,process.env.BARK_SOUND&&(Cc=process.env.BARK_SOUND),process.env.BARK_GROUP&&(Pc=process.env.BARK_GROUP)):Ic&&-1===Ic.indexOf("https")&&-1===Ic.indexOf("http")&&(Ic=`https://api.day.app/${Ic}`);process.env.TG_BOT_TOKEN&&(xc=process.env.TG_BOT_TOKEN);process.env.TG_USER_ID&&(Ac=process.env.TG_USER_ID);process.env.TG_PROXY_AUTH&&(Nc=process.env.TG_PROXY_AUTH);process.env.TG_PROXY_HOST&&(Rc=process.env.TG_PROXY_HOST);process.env.TG_PROXY_PORT&&(Lc=process.env.TG_PROXY_PORT);process.env.TG_API_HOST&&(kc=process.env.TG_API_HOST);process.env.DD_BOT_TOKEN&&(Uc=process.env.DD_BOT_TOKEN,process.env.DD_BOT_SECRET&&(jc=process.env.DD_BOT_SECRET));process.env.QYWX_KEY&&(Bc=process.env.QYWX_KEY);process.env.QYWX_AM&&(Dc=process.env.QYWX_AM);process.env.IGOT_PUSH_KEY&&(Gc=process.env.IGOT_PUSH_KEY);process.env.PUSH_PLUS_TOKEN&&(Mc=process.env.PUSH_PLUS_TOKEN);process.env.PUSH_PLUS_USER&&(qc=process.env.PUSH_PLUS_USER)}()}let Sc="",Ic="",Cc="",Pc="QingLong",xc="",Ac="",Rc="",Lc="",Nc="",kc="api.telegram.org",Uc="",jc="",Bc="",Dc="",Gc="",Mc="",qc="",Hc="",Kc="";async function Yc(t,e){var n;const r=null===(n=fa.config.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const o=Number(r.port)||465,i=d.createTransport({host:r.host,port:o,secure:465===o,auth:{user:r.from,pass:r.pass}}),a=await i.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});Fi.info(`邮件消息已发送: ${a.messageId}`)}async function Jc(t,e){try{const n=fa.MESSAGE_API;if(!n)return;const r=n.replace("{title}",t).replace("{text}",e);await yc.get(r)}catch(t){Fi.info(`自定义接口消息发送失败: ${t}`),Fi.error(t)}}function Fc(t,e,n=2100){return new Promise((r=>{if(Sc){e=e.replace(/[\n\r]/g,"\n\n");const o={url:Sc.includes("SCT")?`https://sctapi.ftqq.com/${Sc}.send`:`https://sc.ftqq.com/${Sc}.send`,params:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{yc.post(o).then((t=>{0===t.errno||0===t.data.errno?Fi.info("server酱发送通知消息成功🎉"):1024===t.errno?Fi.info(`server酱发送通知消息异常: ${t.errmsg}`):Fi.info(`server酱发送通知消息异常\n${JSON.stringify(t)}`)})).catch((t=>{Fi.info("发送通知调用API失败！！"),Fi.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function zc(t,e){return new Promise((n=>{if(Hc){const r={url:`https://push.xuthus.cc/${Kc}/${Hc}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/京豆/g,"豆豆"),e=(e=(e=e.replace(/京豆/g,"")).replace(/🐶/g,"")).replace(/红包/g,"H包"),"email"===Kc?r.data={t:t,c:e}:r.params=`${t}\n\n${e}`;const o=function(t){switch(t){case"send":return"个人";case"group":return"QQ群";case"wx":return"微信";case"ww":return"企业微信";case"email":return"邮件";default:return"未知方式"}};yc.post(r).then((t=>{200===t.code?Fi.info(`酷推发送${o(Kc)}通知消息成功🎉`):400===t.code?Fi.info(`QQ酷推(Cool Push)发送${o(Kc)}推送失败：${t.msg}`):503===t.code?Fi.info(`QQ酷推出错，${t.message}：${t.data}`):Fi.info(`酷推推送异常: ${JSON.stringify(t)}`)})).catch((t=>{Fi.info(`发送${o(Kc)}通知调用API失败！！`),Fi.info(t)})).finally((()=>{n("")}))}else n("")}))}function Qc(t,e,n={}){return new Promise((r=>{if(Ic){const o={url:`${Ic}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${Cc}&group=${Pc}&${Di(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};yc.get(o).then((t=>{200===t.code?Fi.info("Bark APP发送通知消息成功🎉"):Fi.info(`Bark APP发送通失败：${t.message}`)})).catch((t=>{Fi.info("Bark APP发送通知调用API失败！！"),Fi.error(t)})).finally((()=>{r("")}))}r("")}))}function Wc(t,e){return new Promise((n=>{if(xc&&Ac){const r={url:`https://${kc}/bot${xc}/sendMessage`,params:`chat_id=${Ac}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(Rc&&Lc){const t=p.httpsOverHttp({proxy:{host:Rc,port:+Lc,proxyAuth:Nc},maxSockets:1});Object.assign(r,{httpsAgent:t})}yc.post(r).then((t=>{t.ok?Fi.info("Telegram发送通知消息成功🎉。"):400===t.error_code?Fi.info("请主动给bot发送一条消息并检查接收用户ID是否正确。"):401===t.error_code&&Fi.info("Telegram bot token 填写错误。")})).catch((t=>{Fi.info("telegram发送通知消息失败！！"),Fi.info(t)})).finally((()=>{n("")}))}else n("")}))}function Xc(t,e){return new Promise((n=>{const r={url:`https://oapi.dingtalk.com/robot/send?access_token=${Uc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(Uc){if(jc){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",jc);n.update(`${e}\n${jc}`);const o=encodeURIComponent(n.digest("base64"));r.url=`${r.url}&timestamp=${e}&sign=${o}`}yc.post(r).then((t=>{0===t.errcode?Fi.info("钉钉发送通知消息成功🎉。"):Fi.info(`钉钉发送通知失败：${t.errmsg}`)})).catch((t=>{Fi.info("钉钉发送通知消息失败！！"),Fi.info(t)})),n("")}else n("")}))}function Vc(t,e){return new Promise((n=>{const r={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${Bc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};Bc&&yc.post(r).then((t=>{0===t.errcode?Fi.info("企业微信发送通知消息成功🎉。"):Fi.info(`企业微信发送通知失败：${t.errmsg}`)})).catch((t=>{Fi.info("企业微信发送通知消息失败！！"),Fi.info(t)})).finally((()=>{n("")})),n("")}))}function Zc(t){const e=Dc.split(",");if(e[2]){const n=e[2].split("|");let r="";for(let e=0;e<n.length;e++){const o="签到号 "+(e+1);t.match(o)&&(r=n[e])}return r||(r=e[2]),r}return"@all"}function tu(t,e){return new Promise((n=>{if(Dc){const r=Dc.split(","),o={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${r[0]}`,corpsecret:`${r[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};yc.post(o).then((o=>{const i=e.replace(/\n/g,"<br/>"),a=JSON.parse(o).access_token;let s;switch(r[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"更多"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${r[4]}`,author:"智能助手",content_source_url:"",content:`${i}`,digest:`${e}`}]}}}r[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${Zc(e)}`,agentid:`${r[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},yc.post(s).then((t=>{0===t.errcode?Fi.info("成员ID:"+Zc(e)+"企业微信应用消息发送通知消息成功🎉。"):Fi.info(`企业微信应用：${t.errmsg}`)})).catch((t=>{Fi.info("成员ID:"+Zc(e)+"企业微信应用消息发送通知消息失败！！"),Fi.info(t)})).finally((()=>{n("")}))})).catch((t=>{Fi.error("企业微信应用消息发送通知消息失败！！")}))}else n("")}))}function eu(t,e,n={}){return new Promise((r=>{if(Gc){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(Gc))return Fi.info("您所提供的IGOT_PUSH_KEY无效"),void r("");const o={url:`https://push.hellyw.com/${Gc.toLowerCase()}`,params:`title=${t}&content=${e}&${Di(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};yc.post(o).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?Fi.info("iGot发送通知消息成功🎉"):Fi.info(`iGot发送通知消息失败：${t.errMsg}`)})).catch((t=>{Fi.info("发送通知调用API失败！！"),Fi.info(t)})).finally((()=>{r("")}))}else r("")}))}function nu(t,e){return new Promise((n=>{if(Mc){e=e.replace(/[\n\r]/g,"<br>");const r={url:"https://www.pushplus.plus/send",params:{token:`${Mc}`,title:`${t}`,content:`${e}`,topic:`${qc}`},headers:{"Content-Type":" application/json"},timeout:15e3};yc.post(r).then((t=>{200===t.code?Fi.info(`push+发送${qc?"一对多":"一对一"}通知消息完成。`):Fi.info(`push+发送${qc?"一对多":"一对一"}通知消息失败：${t.msg}`)})).catch((t=>{Fi.info(`push+发送${qc?"一对多":"一对一"}通知消息失败！！`),Fi.info(t)})).finally((()=>{n("")}))}else n("")}))}async function ru(t,e){Fi.info("----【消息推送】----"),t=`Bili-${la.nickname}-${t}`,await async function(t,e,n={},r){Ec(),e+=r,await Promise.all([Fc(t,e),nu(t,e)]),await Promise.all([Qc(t,e,n),Wc(t,e),Xc(t,e),Vc(t,e),tu(t,e),eu(t,e,n),Yc(t,e),Jc(t,e),zc(t,e)])}(t,e,void 0,"")}const ou=hc({baseURL:cc,headers:{"user-agent":fa.USER_AGENT}}),iu=hc({baseURL:uc,headers:{Referer:sc,"user-agent":fa.USER_AGENT}}),au=hc({baseURL:fc,headers:{Referer:sc,"user-agent":fa.USER_AGENT}}),su=hc({baseURL:lc,headers:{"user-agent":fa.USER_AGENT}}),cu=hc({baseURL:dc,headers:{"user-agent":fa.USER_AGENT}});function uu(t=3394945){const e=(new Date).getTime();return iu.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}function fu(t=1,e=10){return t>10&&(t=10),iu.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}function lu({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:o}){const i=fa.BILIJCT,a=i,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:o,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:i,platform:"pc",biz_code:"Live",csrf_token:a,uid:fa.USERID};return iu.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:ic}})}function du(){return au.get("/x/web-interface/nav",{headers:{Origin:oc}})}function pu(){return au.get("/x/web-interface/coin/today/exp")}function gu(t=1,e=50,n){return au.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function mu(t,e){return au.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:fa.BILIJCT},{headers:{Origin:ac}})}function hu(t){const e=t.level_info,n=e.current_level;if(n>=fa.BILI_TARGET_LEVEL&&(la.coinsTask=0),Fi.info(`当前等级: ${e.current_level}`),n>=6){const t=fa.config.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,Fi.info("已经满级，不需要再投币了，做个白嫖怪吧")}else{const t=e.next_exp-e.current_exp;Fi.info(`距离升级还需要 ${t} 经验，预计 ${function(t){if(fa.BILI_TARGET_COINS<=0)return t/15;const e=10*fa.BILI_TARGET_COINS+15,n=t/e,r=la.money/(fa.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} 天`)}}async function yu(t){try{var e;const{data:n}=await ou.get("/site/getCoin");Fi.info(`登录成功: ${t.uname}`),Fi.info(`硬币余额: ${n.money||0}`),la.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),la.money=n.money||0,la.userLevel=t.level_info.current_level,la.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,hu(t),function(t){let e="";switch(la.vipType=t.vipType,t.vipType){case 0:e="无大会员";break;case 1:e="月度大会员";break;case 2:e="年度大会员"}0===t.vipStatus&&(e="无大会员"===e?e:e+"[已过期]"),Fi.info(`大会员状态: ${e}`)}(t)}catch(t){Fi.error(`获取硬币信息异常: ${t.message}`),Fi.debug(t)}}function _u(t,e,n=1){return au.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:fa.BILIJCT})}function vu(t,e=1){return _c.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:fa.BILIJCT})}const wu="video",bu="audio",Tu="article";async function $u(t=!0){try{const r=fa.USERID,{data:o,message:i,code:a}=await(t?gu(e,n,-10):function(t,e,n,r,o){return au.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:o}})}(r)),s=t?o:o.list;if(!s||0===s.length)return{msg:"-1",data:{}};if(0===a){await pa();const{mid:t}=Gi(s)||{};return await Su(t)}return{msg:t?`未获取到特别关注列表: ${a}-${i}`:`未获取到关注列表: ${a}-${i}`,data:{}}}catch(t){return{msg:t.message,data:{}}}var e,n}async function Ou(){const t=Gi([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t,e){return au.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=Gi(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`未获取到排行信息: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Eu(){const t=fa.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await Su(Gi(t))}async function Su(t){try{const{code:e,data:n,message:r}=await function(t){return au.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`通过uid获取视频失败: ${e}-${r}`,data:{}};await pa();const{video:o,audio:i,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const o=Ri(0,r-1);let i=o;if(o<t)return{type:wu,page:xi(30,i+1),index:i%30};const a=t+e;return i=o-t,o<a?{type:bu,page:xi(30,i+1),index:i%30}:(i=o-a,{type:Tu,page:xi(12,i+1),index:i%12})}([o,i,a]),f={[wu]:Iu,[bu]:Cu,[Tu]:Pu},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return Fi.debug(t),{msg:t.message,data:{}}}}async function Iu(t,e,n){const{code:r,data:o,message:i}=await function(t,e,n=1,r=""){return au.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:i};const{aid:a,title:s,author:c}=o.list.vlist[n];return{type:wu,id:a,title:s,author:c}}async function Cu(t,e,n){const{code:r,data:o,msg:i}=await function(t,e,n=1){return au.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:i};const{data:a}=o,{id:s,uname:c,title:u}=a[n];return{type:bu,id:s,title:u,author:c}}async function Pu(t,e,n){const{code:r,data:o,message:i}=await function(t,e,n=1){return au.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:i};const{articles:a}=o,{id:s,title:c,author:{name:u}}=a[n];return{type:Tu,id:s,title:c,author:u,mid:t}}const xu=function(){const t=[Eu,$u,()=>$u(!1),Ou];return fa.BILI_CUSTOMIZE_UP||t.shift(),t}();async function Au(t=0){xu.splice(0,la.currentStartFun+t);for(let t=0;t<xu.length;t++){const e=xu[t];let n=Number(fa.BILI_COIN_RETRY_NUM??4);for(n=n<1?1:n>8?8:n;n--;){await pa();const t=await e();if("-1"===t.msg&&(n=0),"0"===t.msg)return t}n<=0&&(la.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function Ru({id:t,coin:e,type:n,mid:r}){const o={[wu]:_u,[bu]:vu,[Tu]:(t,e=1)=>function(t,e,n=1){return au.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:fa.BILIJCT})}(r,t,e)},i=await o[n](Number(t),e);return{code:i.code,message:i.message||i.msg}}async function Lu(t){if(await async function(){try{const{data:t,code:e}=await pu();if(0==e){const e=fa.BILI_TARGET_COINS-t/10;la.coinsTask=e>0?e:0}}catch(t){}}(),la.coinsTask<=0||la.money<=0)return!0;const{data:e,msg:n}=await Au(t.priority);return null!=e&&e.id&&"0"==n?(await pa(),await async function(t,e){const{id:n,title:r,author:o,type:i,mid:a}=t;try{const t=await Ru({id:n,type:i,mid:a});if(0===t.code)la.money--,la.coinsTask--,e.num++,Fi.info(`给[${r}--up【${o}】]投币成功`);else if(34005===t.code)e.fillCount++,Fi.verbose(`当前稿件[${n}]不能再投币了`),e.fillCount>=3&&(Fi.warn("自定义用户组投币似乎没有币可投了"),e.priority++);else{if(-111===t.code||-104===t.code)return Fi.warn(`${n} ${t.message} 无法继续进行投币`),!0;if(e.eCount++,Fi.warn(`给${n}投币失败 ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,Fi.error(`投币异常 ${t.message}`)}finally{await pa(1500)}return!1}(e,t)):(t.eCount++,!1)}async function Nu(){try{const{data:t,code:e,message:n}=await cu.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(Fi.warn(`获取自己的应援团异常失败: ${n}`),[])}catch(t){Fi.error(`获取自己的应援团异常: ${t}`)}}const ku=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","_(:3」∠)_","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)","(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","（#-_-)┯━┯","(╯°口°)╯(┴—┴","←◡←","( ♥д♥)","Σ>―(〃°ω°〃)♡→","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","(╬ﾟдﾟ)▄︻┻┳═一","･*･:≡(　ε:)","(汗)","(苦笑)"].concat("1","2","3","4","5","6","7","8","9","签到","哈哈");async function Uu(){try{const{code:r,message:o,data:i}=await(t=1,e=256,n=fa.USERID,iu.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`));return 0!==r?(Fi.verbose(`获取勋章信息失败 ${r} ${o}`),null):i}catch(t){return Fi.error(`获取勋章异常 ${t.message}`),null}var t,e,n}async function ju(t,e){const n=ku[Ri(ku.length-1)];try{const{code:r,message:o}=await function(t,e){const n=fa.BILIJCT,r=n;return e||(e=Ri(10).toString()),iu.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(Fi.warn(`【${e}】${t}-可能未开启评论`),!1):(Fi.warn(`【${e}】${t}-发送失败 ${o}`),Fi.verbose(`code: ${r}`),!1))}catch(t){Fi.verbose(`发送弹幕异常 ${t.message}`)}}async function Bu(){try{const{data:t,message:e,code:n}=await du();if(0!==n)return void Fi.warn(`获取用户信息失败：${n} ${e}`);!function(t){var e;la.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){Fi.error(`获取用户信息异常：${t.message}`)}}var Du;async function Gu(t){try{const e=function(t){switch(t){case 1:return"B 币券";case 2:return"大会员优惠券";default:return""}}(t),{code:n,message:r}=await function(t){return au.post("/x/vip/privilege/receive",{csrf:fa.BILIJCT,type:t})}(t);let o="成功";return 0===n&&(o=`失败 ${r}`),Fi.info(`领取${e} ${o}`),!0}catch(t){Fi.error(`领取权益出现异常：${t.message}`)}return!1}async function Mu(t){let e=0,n=!1;for(;!(n||(n=await Gu(t),e>2));)e++;return n}!function(t){t[t["成功"]=4]="成功",t[t["低于20电池"]=-2]="低于20电池",t[t["B币不足"]=-4]="B币不足"}(Du||(Du={}));let qu=0;async function Hu(){try{const{data:{list:t}}=await uu();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(t.gift_id);return n&&e&&Fi.info(`${t.gift_name} 即将过期请尽快投喂`),!n&&e}))}catch(t){if(qu)return null;await Hu(),qu++}}async function Ku(t){try{const{data:{live_room:e,name:n}}=await function(t){return au.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await pa(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function Yu(t,e,n,r){const o=fa.BILIJCT,i={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:o,csrf_token:o};return au.post("/x/esports/guess/add",i)}function Ju(){return la.money-fa.MATCH_COINS<fa.BILI_TARGET_COINS&&(Fi.info(`需要保留${fa.BILI_TARGET_COINS}个硬币，任务结束`),!0)}function Fu(t,e,n,r,o){const i=Ki(fa.COOKIE),a=i,s=[Yi(fa.COOKIE),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))];return{ua:fa.USER_AGENT,id:[n,e,o,t],csrf_token:i,csrf:a,device:s,uname:r}}async function zu(){try{await _c.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat")}catch{}}async function Qu(t){const{data:{area_id:e,parent_area_id:n,room_id:r}}=await function(t){return iu.get(`/room/v1/Room/get_info?room_id=${t}&from=room`)}(t);return{room_id:r,area_id:e,parent_area_id:n}}async function Wu(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:r,code:o}=await function(t){return _c.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",t)}(n);if(0===o)return Fi.info(`进入【${t.uname}】的直播间`),e.v++,r}catch(t){Fi.verbose(t)}}async function Xu(t,e,n){if(n.v>6)return;const r={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},o=function(t,e){const[n,r,o,i]=JSON.parse(t.id),[a,s]=JSON.parse(t.device),{ets:c,time:u,ts:l}=t,d={platform:"web",parent_id:n,area_id:r,seq_id:o,room_id:i,buvid:a,uuid:s,ets:c,time:u,ts:l},p=t.benchmark,g=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let m=JSON.stringify(d);for(const t of e)m=f.createHmac(g[t],p).update(m).digest("hex");return m}(r,t.secret_rule);try{const{data:t,code:i,message:a}=await function(t){return _c.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",t)}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:o},r));return 0===i?(Fi.info(`向【${e.uname}】发送第${n.v}次心跳`),n.v++):Fi.warn(`向【${e.uname}】发送第${n.v}次心跳失败 ${i} ${a}`),t}catch(t){Fi.verbose(t)}}async function Vu(t=1,e=10){try{const{code:n,message:r,data:o}=await fu(t,e);return 0!==n?(Fi.verbose(`获取直播间失败 ${n} ${r}`),null):o}catch(t){return Fi.verbose(`获取直播间异常 ${t.message}`),null}}async function Zu(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:r,code:o}=await uu();return 0!==o||(null===(e=r.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=r.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/864e5;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await Vu();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await Vu(e,10);t.push(...n.items)}}return t}():({items:n}=await Vu()),{fansMedalList:n,heartNum:e}}async function tf(t,e,n,r){if(!r.v||e[n])return await zu(),await pa(500),0===r.v?e[n]=await Wu(t,r):e[n]=await Xu(e[n],t,r),"done"}async function ef(t,e){const n=[];let r=0;for(let o=0;o<6;o++){let i=0;if(i>=e)break;const a=t.length;r=0;for(let s=0;s<a&&!(i>=e);s++){const e=(new Date).getTime(),a=t[s],{roomid:c,uname:u}=a,{room_id:f,area_id:l,parent_area_id:d}=await Qu(c),p=Fu(f,l,d,u,o);await tf(p,n,s,{v:o}),await pa(2e3),r+=(new Date).getTime()-e,i++}o<5&&await pa(6e4-r)}return"done"}async function nf(t){let e,n;if(t){const{d:r,hn:o}=JSON.parse(t);e="string"==typeof r?JSON.parse(_i(r)):r||[{seq:{v:0}}],n=o||{v:0}}else e=[{seq:{v:0}}],n={v:0};let r=0;if(e[0]&&!e[0].seq.v){e.length=0;const{heartNum:t,fansMedalList:o}=await Zu();n.v=t;for(const t of o){if(0===n.v)return Fi.info("今日获取小星星已经达到 24"),0;if(r>=n.v)break;const{roomid:o,uname:i}=t,{room_id:a,area_id:s,parent_area_id:c}=await Qu(o),u={v:0},f=Fu(a,s,c,i,u.v);await zu(),await pa(500);const l=await Wu(f,u);e.push({data:l,baseData:f,seq:u}),r++}}else{!function(t){const e=Yi(fa.COOKIE),n=Ki(fa.COOKIE),r=fa.USER_AGENT;t.forEach((t=>{t.baseData.ua=r,t.baseData.csrf=t.baseData.csrf_token=n,t.baseData.device[0]=e,t.baseData.id[2]=t.seq.v}))}(e);for(const t of e)if(await zu(),t.data&&(t.data=await Xu(t.data,t.baseData,t.seq)),await pa(1e3),r++,t.seq.v>5&&(t.seq.v=0,r>=n.v))return Fi.info("今日获取小心心完成"),0;if(e.find((t=>t.seq.v>5)))return 1}return function(t){t.forEach((t=>{delete t.baseData.csrf,delete t.baseData.csrf_token,delete t.baseData.ua,t.baseData.device[0]=0}))}(e),{d:yi(JSON.stringify(e)),hn:n,l:e.length}}async function rf(){const{data:t,code:e}=await gu(1,1,0);if(0!==e)throw new Error(`获取最后一个关注失败: ${e}`);return t[0]}async function of(t){const{data:e,code:n}=await au.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));Fi.warn(`获取分组列表失败: ${n}`)}async function af(t){const e=await of(t);if(e)return e.tagid;await pa(300);const{data:n,code:r,message:o}=await(i=t,au.post("/x/relation/tag/create",{tag:i,jsonp:"jsonp",csrf:fa.BILIJCT}));var i;if(22106===r){await pa(300);const e=await of(t);return e&&e.tagid}return 0!==r&&Fi.warn(`创建分组失败: ${r}-${o}`),n.tagid}async function sf(t,e){if(0===t.length)return;const n=await af(e);if(n)for(const e of t){const{code:t,message:r}=await mu(e.mid,n);0!==t&&Fi.warn(`移动【${e.uname}】失败: ${t}-${r}`),await pa()}}async function cf(t,e,n,r=1){if(t.length>e.length)return;const{data:o,code:i,message:a}=await gu(r,20,0);if(0===i){for(const{mid:r,uname:i}of o){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(i))&&t.push({mid:r,uname:i})}if(!(o.length<20))return await cf(t,e,n,r+1)}else Fi.warn(`获取关注用户失败: ${i}-${a}`)}const uf=0,ff=1,lf=5,df=1,pf=504,gf=1096;let mf;async function hf(){try{const{data:t,code:e,message:n}=await iu.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&Fi.info(`获取直播分区失败: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw Fi.error(`获取直播分区异常: ${t.message}`),t}}async function yf(t,e,n=1,r="lottery"){try{await pa(100);const{data:o,code:i,message:a}=await function(t,e,n){return iu.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==i&&Fi.info(`获取直播间列表失败: ${i}-${a}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===pf?e.push(t):r.pendent_id===gf&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(o.list)["lottery"===r?"lotteryTime":"lotteryPacket"]}catch(t){throw Fi.error(`获取直播间列表异常: ${t.message}`),t}}async function _f(t,e,n=1){const r=await yf(t,e,n),o=[];for(const t of r){const e=await vf(t);e&&(o.push({...e,uid:t.uid,uname:t.uname}),await pa(100))}return o}async function vf(t){if(fa.LOTTERY_UP_BLACKLIST.includes(t.uid))return void Fi.info(`跳过黑名单用户: ${t.uname}`);let e,n,r;try{({data:n,code:e,message:r}=await(o=t.roomid,iu.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${o}`)))}catch(e){return void Fi.info(`直播间${t.roomid}检测异常: ${e.message}`)}var o;if(0!==e)return void Fi.debug(`直播间${t.roomid}检测失败: ${e}-${r}`);if(null===n)return;const i=fa.LOTTERY_EXCLUDE.some((t=>n.award_name.match(t)));if(!fa.LOTTERY_INCLUDE.some((t=>n.award_name.match(t)))&&i)Fi.info(`跳过屏蔽奖品: ${n.award_name}`);else if(n.status!==df);else if(n.gift_price>0);else{if(n.require_type===uf||n.require_type===ff)return n;if(n.require_type===lf&&la.userLevel>=n.require_value)return n}}async function wf(t){try{const{id:n,gift_id:r,gift_num:o,award_name:i,uid:a,uname:s,require_type:c,require_text:u}=t;Fi.info(`天选主播：【${s}】`),Fi.info(`奖品：${i}`);const{code:f,message:l}=await(e={id:n,gift_id:r,gift_num:o},iu.post("/xlive/lottery-interface/v1/Anchor/Join",{...e,csrf:fa.BILIJCT,csrf_token:fa.BILIJCT,visit_id:ki(),platform:"pc"}));if(0!==f)return void Fi.info(`天选失败: ${f}-${l}`);if(Fi.info("天选成功 √"),c===ff){Ui(mf,a);(function(t){const e=(t=t.replace("关注主播","")).split(/\s*\+\s*/);return e.shift(),e})(u).forEach((t=>Ui(mf,t)))}}catch(t){Fi.info(`天选异常: ${t.message}`)}var e}async function bf(t,e,n=2){for(let r=1;r<=n;r++){const n=await _f(t,e,r);for(const t of n)await wf(t),await pa(300)}}async function Tf(t){try{const{data:e,code:n}=await function(t){return iu.get(`/xlive/lottery-interface/v1/lottery/getLotteryInfoWeb?roomid=${t}`)}(t);if(0!==n)return;const{popularity_red_pocket:r}=e;if(!r)return;const{lot_id:o,lot_status:i}=r[0];if(2===i)return;return o}catch(t){}}async function $f(t,e,n=1){const r=await yf(t,e,n,"redPack"),o=[];for(const t of r){const e=await Tf(t.roomid);e&&(o.push({uid:t.uid,uname:t.uname,lot_id:e,room_id:t.roomid}),await pa(100))}return o}async function Of(t){try{const{lot_id:n,uid:r,uname:o,room_id:i}=t;Fi.info(`红包主播：【${o}】`);const{code:a,message:s}=await(e={room_id:i,lot_id:n,ruid:r},iu.post("/xlive/lottery-interface/v1/popularityRedPocket/RedPocketDraw",{...e,spm_id:"444.8.red_envelope.extract",jump_from:"",session_id:"",csrf_token:fa.BILIJCT,csrf:fa.BILIJCT,visit_id:""}));if(0!==a)return void Fi.info(`红包失败: ${a}-${s}`);mf.push(r),Fi.info("红包成功 √")}catch(t){Fi.info(`红包异常: ${t.message}`)}var e}async function Ef(t,e,n=2){for(let r=1;r<=n;r++){const n=await $f(t,e,r);for(const t of n)await Of(t),await pa(200)}}function Sf({talker_id:t,session_type:e}){return cu.post("/session_svr/v1/session_svr/remove_session",{talker_id:t,session_type:e,build:0,mobi_app:"web",csrf_token:fa.BILIJCT,csrf:fa.BILIJCT})}async function If(t){try{const{code:e,message:n,data:r}=await function({session_type:t}){return cu.get(`/session_svr/v1/session_svr/get_sessions?session_type=${t}&group_fold=1&unfollow_fold=1&sort_rule=2&build=0&mobi_app=web`)}();if(0!==e)return void Fi.warn(`获取会话失败：${e}-${n}`);const{session_list:o}=r;if(o.length<=0)return;return o.filter((({unread_count:e,talker_id:n,is_follow:r,last_msg:o})=>{return t.find((t=>t.mid===n))&&e>0&&n===o.sender_uid&&1===r&&(i=o.timestamp,Date.now()-1e3*i<36e5);var i}))}catch(t){Fi.error(`获取会话异常：${t.message}`)}}async function Cf(t){const e=await If(t);await pa(200);try{for(let t=0;t<e.length;t++){const n=e[t];await Sf(n),await pa(50)}}catch(t){Fi.error(`更新会话异常：${t.message}`)}e.length>=19&&await Cf(t)}var Pf={taskReward:async function(){Fi.info("----【每日任务完成情况】----");try{const{data:t,message:e,code:n}=await au.get("/x/member/web/exp/reward");await pa();const{data:r}=await pu();if(0!=n)return void Fi.warn(`状态获取失败: ${n} ${e}`);const o=la.money-fa.BILI_STAY_COINS;let i=0;0===la.coinsTask?Fi.info(`今日投币获取经验: ${r}，还需投币0颗，经验够了，不想投了`):o<=0?Fi.info(`今日投币获取经验: ${r}，还需投币0颗，硬币不够了，不投币了`):o<la.coinsTask?(i=la.coinsTask-o,Fi.info(`投币获取经验: ${r}，还需投币数量: ${i}颗;(目标${la.coinsTask}颗，忽略部分投币)`)):(i=la.coinsTask-r/10,Fi.info(`投币获取经验: ${r}，还需投币数量: ${i}颗;(目标${la.coinsTask}颗)`)),la.coinsTask=i,Fi.info("每日分享: "+(t.share?"已完成":"[未完成]")),Fi.info("每日播放: "+(t.watch?"已完成":"[未完成]")),la.share=t.share,la.watch=t.watch}catch(t){Fi.error(`状态获取异常 ${t.message}`)}},liveSignTask:async function(){Fi.info("----【直播签到】----");try{const{data:t}=await iu.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return Fi.info("已签到，跳过签到"),void Fi.info(`已经签到${t.hadSignDays}天，${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await iu.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?Fi.info(`直播签到成功: ${e.text}，特别信息: ${e.specialText}，本月签到天数: ${e.hadSignDays}天;`):Fi.warn(`直播签到失败: ${t} ${n}`)}catch(t){Fi.error(`直播签到异常: ${t.message}`)}},shareAndWatch:async function(){if(Fi.info("----【分享/播放视频】----"),la.share&&la.watch)return void Fi.info("已完成，跳过分享/播放");let t=0;try{let e=await Au();if("-1"===e.msg&&(e=await Ou()),"0"!==e.msg)return Fi.warn(`获取视频失败 ${e.msg}`),!1;{const{id:n,author:r,title:o}=e.data;t=n,Fi.info(`获取视频: ${o} --up【${r}】`)}}catch(t){return Fi.error(`获取视频出现异常: ${t.message}`),!1}if(!la.share){await pa();try{const{code:e,message:n}=await function(t){const e={csrf:fa.BILIJCT,aid:t};return au.post("/x/web-interface/share/add",e)}(t);0===e?Fi.info("分享视频成功!"):Fi.warn(`分享视频失败: ${e} ${n}`)}catch(t){Fi.error(`分享视频异常: ${t.message}`)}}if(!la.watch){await pa();try{const{code:r,message:o}=await(e=t,n=Ri(4,60),au.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?Fi.info("播放视频成功!"):Fi.warn(`播放视频失败: ${r} ${o}`)}catch(t){Fi.error(`播放视频异常: ${t.message}`)}}var e,n},silver2Coin:async function(){Fi.info("----【银瓜子兑换硬币】----");try{const{data:t,code:e,message:n}=await iu.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&Fi.info(`获取瓜子详情失败 ${n}`),0===t.silver_2_coin_left)Fi.info("今日已兑换一次");else if(t.silver<700)Fi.info("兑换失败，你瓜子不够了");else{const{message:t}=await iu.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:fa.BILIJCT,csrf:fa.BILIJCT});Fi.info(`兑换硬币： ${t}`),await iu.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){Fi.error(`操作异常 ${t.message}`)}},addCoins:async function(){if(Fi.info("----【视频投币】----"),!la.coinsTask)return void Fi.info("跳过投币，今日已完成");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;la.coinsTask&&!e&&t.eCount<5;)e=await Lu(t);t.eCount>=5&&Fi.info("出现异常/错误5次，自动退出投币"),Fi.info(`一共成功投币${t.num}颗`),Fi.info(`硬币还剩${la.money}颗`)},mangaSign:async function(){Fi.info("----【漫画签到】----");try{const{code:t}=await su.post("/twirp/activity.v1.Activity/ClockIn",{platform:e});0==t?Fi.info("漫画签到成功"):Fi.warn("漫画签到失败")}catch(e){var t;400===(null===(t=e.response)||void 0===t?void 0:t.status)?Fi.info("已经签到过了，跳过任务"):Fi.error(`漫画签到异常 ${e.message}`)}var e},supGroupSign:async function(){Fi.info("----【应援团签到】----");const t=await Nu();await pa();let e=0;for(let o=0;o<t.length;){const i=t[o];try{const{data:t,code:o,message:a}=await(n=i.group_id,r=i.owner_uid,cu.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===o?0===t.status?e++:Fi.info(a):Fi.warn(`[${i.group_name}]签到失败 ${a}`)}catch(t){Fi.error(`签到异常 ${t.message}`)}finally{await pa()}}var n,r;Fi.info(`签到结束，成功${e}/${t.length}`)},liveSendMessage:async function(){Fi.info("----【发送直播弹幕】----");const t=await async function(){const{list:t,special_list:e}=await Uu();return t.push(...e),t}(),e=t.length;let n=0,r=0;Fi.info(`一共需要发送${e}个直播间`),Fi.verbose("所需时间可能很长，请耐心等待");for(let o=0;o<e;o++){const{room_info:i,anchor_info:a,medal:s}=t[o];null!=i&&i.room_id?100===s.today_feed||s.guard_level>0?r++:(await ju(i.room_id,a.nick_name)&&n++,o<e-1&&await pa(Ri(1e4,25e3))):(Fi.info(`【${a.nick_name}】没有直播间哦`),r++)}Fi.info(`成功发送${n}个弹幕，跳过${r}个`)},charging:async function(){if(Fi.info("----【给目标充电】----"),await Bu(),await pa(),function(){const t=Pi(),e=t.getDate(),n=Ci(t),r=fa.CHARGE_PRESET_TIME;return la.bCoinCouponBalance<2?(Fi.info(`剩余券为${la.bCoinCouponBalance}，不足2跳过充电`),!1):n===e?(Fi.info("今天是最后一天了"),!0):!(r>e&&(Fi.info(`预设时间为${r}，不符合条件`),1))}())try{const t=la.bCoinCouponBalance||0,e=fa.CHARGE_ID;let n=0;Fi.info(`b 币券余额${t}`);const r=async()=>{const{code:n,message:r,data:o}=await function(t,e,n=fa.USERID,r,o){return au.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:fa.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:o})}(t,!0,e);0===n?(Fi.info(`【充值结果】${Du[o.status]}`),o.status===Du["成功"]&&(la.chargeOrderNo=o.order_no,await pa(),await async function(){try{if(!la.chargeOrderNo)return!1;const t=h[Ri(0,h.length-1)],{code:e}=await function(t,e){return au.post("/x/ugcpay/trade/elec/message",{csrf:fa.BILIJCT,message:e,order_id:t})}(la.chargeOrderNo,t);0===e&&Fi.info("留言成功！")}catch{}}())):Fi.warn(`充电失败：${n} ${r}`)};for(la.chargeOrderNo="";!(la.chargeOrderNo||(await r(),await pa(),n++>2)););}catch(t){Fi.error(`充电出现异常：${t.message}`)}},getVipPrivilege:async function(){Fi.info("----【领取大会员权益】----"),function(){if(2!==la.vipType)return Fi.info("账号非年度大会员，不需要领取权益"),!1;const t=Pi(),e=t.getDate(),n=Ci(t);return 1===e||n===e||(Fi.info("今天非预订领取时间，跳过领取"),!1)}()&&(await Mu(1),await Mu(2))},giveGift:async function(){Fi.info("----【投喂过期食物】----");try{const t=await Hu();if(await pa(),null==t||!t.length)return void Fi.info("没有2天内过期的简单礼物");const e=await async function(){const t=Object.assign([],fa.BILI_GIFT_UP),e=()=>t.splice(Ri(fa.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await Ku(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await fu();if(await pa(),!t)return;const n=e[Ri(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void Fi.info("没有找到投喂目标");await async function({roomid:t,mid:e,name:n},r){for(const o of r){await pa();try{const{code:r,message:i,data:a}=await lu({roomid:t,ruid:e,bag_id:o.bag_id,gift_id:o.gift_id,gift_num:o.gift_num});if(0!==r){Fi.warn(`向[${n}]投喂[${o.gift_name}]，${i}`);continue}a.gift_list.forEach((t=>{Fi.info(`成功给 [${n}] 投喂${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){Fi.info(`投喂过期食物异常 ${t}`)}},matchGame:async function(){if(Fi.info("----【赛事硬币竞猜】----"),fa.MATCH_COINS<=0)return void Fi.info("硬币数量不能小于 0");if(Ju())return;const t=await async function(){try{const{code:n,message:r,data:{list:o,page:i}}=await au.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`);return 0!==n?void Fi.warn(`获取赛事错误 ${n} ${r}`):0===i.total?(Fi.info("今日已经无法获取赛事"),null):o}catch(t){}var t,e}();if(await pa(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,o=t.id,[{id:i,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(Ju())return e;if(c)continue;Fi.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=fa.MATCH_SELECTION>0?l?f:u:l?u:f,Fi.info(`预测[ ${d.option} ] ${fa.MATCH_COINS} 颗硬币`),await pa();const{code:p}=await Yu(o,i,d.detail_id,fa.MATCH_COINS);0!==p?Fi.info("预测失败"):(e++,la.money-=fa.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:o}]=n;if(o)return!1;const[i,a]=r;return Math.abs(i.odds-a.odds)>=e}))}(t,fa.MATCH_DIFF));Fi.info(`【竞猜结束】一共参与${e}次预测`)},liveHeart:async function(){Fi.info("----【直播心跳】----");const{heartNum:t,fansMedalList:e}=await Zu(),n=e&&e.length;if(!n)return void Fi.info("没有勋章列表");const r=Math.ceil(t/n);for(let n=0;n<r;n++)await ef(e,t);Fi.info("完成")},liveLottery:async function(){Fi.info("----【天选时刻】----");try{const t=await rf();Fi.info(`最后一个关注的UP: ${t.uname}`);const e=await async function(){mf=[];const t=await hf();for(const e of t)for(const t of e)await bf(t.areaId,t.parentId,fa.LOTTERY_PAGE_NUM);return mf}();Fi.info("扫描完成");const n=[];await cf(n,e,null==t?void 0:t.mid),await sf(n),Fi.info("移动关注UP到分组成功")}catch(t){Fi.warn(`天选时刻异常: ${t.message}`),Fi.debug(t)}Fi.info("结束天选时刻")},liveRedPack:async function(){Fi.info("----【天选红包】----");try{const t=await rf();Fi.info(`最后一个关注的UP: ${t.uname}`);const e=await async function(){mf=[];const t=await hf();for(const e of t)for(const t of e)await Ef(t.areaId,t.parentId,fa.LOTTERY_PAGE_NUM);return mf}();Fi.info("扫描完成，获取新关注的UP");const n=[];await cf(n,e,null==t?void 0:t.mid),Fi.info("开始读取消息"),await Cf(n),Fi.info("移动关注UP到分组"),await sf(n),Fi.info("移动关注UP到分组成功")}catch(t){Fi.warn(`天选时刻异常: ${t.message}`),Fi.debug(t)}Fi.info("结束天选红包")}};async function xf(t,...e){Ji.value="";try{await async function(){Fi.info("----【登录】----");const{data:t,message:e,code:n}=await du();if(0!==n)throw Fi.error(`登录错误 ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("接口返回为未登录");await pa(),await yu(t)}()}catch(t){return Fi.error(`登录失败: ${t}`),await ru("登录失败",Ji.value),"未完成"}const n=Oc([...Object.values(Pf)]);for(const t of n)await t(),await pa();return t&&await t(...e),await ru("每日完成",Ji.value),"完成"}function Af(t,e){return"scf"===t?e.Message:e.payload}async function Rf(t,e,n){const r="scf"===t?(await Promise.resolve().then((function(){return Nf}))).default:(await Promise.resolve().then((function(){return kf}))).default;return(...t)=>r(e,n,...t)}var Lf=Object.freeze({__proto__:null,dailyHandle:async function({event:t,context:e,slsType:n}){const r=Af(n,t),o=await Rf(n,t,e);let i;try{i=JSON.parse(r)}catch(t){}return i&&i.lastTime===Pi().getDate().toString()?"今日重复执行":await xf(o)},liveHeartHandle:async function({event:t,context:e,slsType:n}){const r=Af(n,t),o=await Rf(n,t,e);let i;try{i=JSON.parse(r)}catch(t){}if(i&&!i.d&&i.lastTime===Pi().getDate().toString())return"今日重复执行";const a=await nf(r);return 0===a?(await o(),"今日完成"):1===a?(await o({hn:{v:0},d:[{seq:{v:0}}]},Ai(5e3,n)),"等待继续下一轮心跳"):(await o(a,Ai(62e3-1e3*a.l,n)),"等待继续下次心跳")}});var Nf=Object.freeze({__proto__:null,default:async function(t,e,n,r,o=2){if(!t.TriggerName)return!1;if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return Fi.info("环境变量不存在TENCENT_SECRET_ID和TENCENT_SECRET_KEY"),!1;const i=await async function(){try{return await Promise.resolve().then((function(){return u(require("tencentcloud-sdk-nodejs"))}))}catch{Fi.warn("tencentcloud-sdk-nodejs not found，运行 cd src && yarn add tencentcloud-sdk-nodejs")}}();if(!i)return!1;const a=i.scf.v20180416.Client,s=e.function_name,c=t.TriggerName,f=new a({credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:e.tencentcloud_region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}});async function l(){const t=r||Li(fa.config.dailyRunTime,"scf"),e={FunctionName:s,TriggerName:c,Type:"timer",TriggerDesc:t.value,Qualifier:"$DEFAULT"},o=await async function(){try{const{Triggers:t}=await f.ListTriggers({FunctionName:s});return-1!==(null==t?void 0:t.findIndex((t=>t.TriggerName===c)))}catch({code:t,message:e}){return Fi.error(`获取trigger失败 ${t} => ${e}`),!1}}();if(Fi.info(`修改时间为：${t.string}`),o){const t=await async function(t){try{return await f.DeleteTrigger(t)}catch({code:t,message:e}){return Fi.warn(`删除trigger失败 ${t} => ${e}`),!1}}(e);if(!t)return}return!!await async function(t){const e=Pi();t.CustomArgument=JSON.stringify({...n,lastTime:e.getDate().toString()});try{return await f.CreateTrigger(t)}catch({code:t,message:e}){return Fi.error(`创建trigger失败 ${t} => ${e}`),!1}}(e)}let d=!1;for(;!d&&o;)d=await l(),o--;return d}});var kf=Object.freeze({__proto__:null,default:async function(t,e,n,r,o=2){if(!t.triggerName)return!1;if(!process.env.ALI_SECRET_ID||!process.env.ALI_SECRET_KEY)return Fi.info("环境变量不存在ALI_SECRET_ID和ALI_SECRET_KEY"),!1;const i=await async function(){try{return await Promise.resolve().then((function(){return u(require("@alicloud/fc2"))}))}catch{Fi.warn("@alicloud/fc2 not found，运行 yarn add @alicloud/fc2")}}();if(!i)return!1;const a=i.default,s=e.function.name,c=t.triggerName,f=e.service.name,l=new a(e.accountId,{accessKeyID:process.env.ALI_SECRET_ID,accessKeySecret:process.env.ALI_SECRET_KEY,region:e.region});async function d(){const t=r||Li(fa.config.dailyRunTime,"fc");return Fi.info(`修改时间为：${t.string}`),!!await async function(t){const e=Pi(),r=`CRON_TZ=Asia/Shanghai ${t}`;try{return await l.updateTrigger(f,s,c,{triggerConfig:{cronExpression:r,payload:JSON.stringify({...n,lastTime:e.getDate().toString()})}})}catch(t){return Fi.error(`更新trigger失败 ${t.message}`),!1}}(t.value)}let p=!1;for(;!p&&o;)p=await d(),o--;return p}});
