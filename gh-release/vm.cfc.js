"use strict";var t=require("path"),e=require("fs");require("crypto");var n=require("zlib"),r=require("json5"),o=require("nodemailer"),i=require("got");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var c=s(t),u=s(e),f=s(r),l=s(o),d=a(i),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g=function(t){return t&&t.Math==Math&&t},m=g("object"==typeof globalThis&&globalThis)||g("object"==typeof window&&window)||g("object"==typeof self&&self)||g("object"==typeof p&&p)||function(){return this}()||Function("return this")(),h={},y=function(t){try{return!!t()}catch(t){return!0}},w=!y((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),_=!y((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),v=_,b=Function.prototype.call,$=v?b.bind(b):function(){return b.apply(b,arguments)},T={},I={}.propertyIsEnumerable,S=Object.getOwnPropertyDescriptor,O=S&&!I.call({1:2},1);T.f=O?function(t){var e=S(this,t);return!!e&&e.enumerable}:I;var E,C,P=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},L=_,k=Function.prototype,R=k.bind,A=k.call,U=L&&R.bind(A,A),x=L?function(t){return t&&U(t)}:function(t){return t&&function(){return A.apply(t,arguments)}},N=x,j=N({}.toString),B=N("".slice),D=function(t){return B(j(t),8,-1)},G=y,M=D,F=Object,q=x("".split),H=G((function(){return!F("z").propertyIsEnumerable(0)}))?function(t){return"String"==M(t)?q(t,""):F(t)}:F,K=TypeError,J=function(t){if(null==t)throw K("Can't call method on "+t);return t},Y=H,z=J,Q=function(t){return Y(z(t))},W=function(t){return"function"==typeof t},X=W,V=function(t){return"object"==typeof t?null!==t:X(t)},Z=m,tt=W,et=function(t){return tt(t)?t:void 0},nt=function(t,e){return arguments.length<2?et(Z[t]):Z[t]&&Z[t][e]},rt=x({}.isPrototypeOf),ot=m,it=nt("navigator","userAgent")||"",at=ot.process,st=ot.Deno,ct=at&&at.versions||st&&st.version,ut=ct&&ct.v8;ut&&(C=(E=ut.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!C&&it&&(!(E=it.match(/Edge\/(\d+)/))||E[1]>=74)&&(E=it.match(/Chrome\/(\d+)/))&&(C=+E[1]);var ft=C,lt=y,dt=!!Object.getOwnPropertySymbols&&!lt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ft&&ft<41})),pt=dt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,gt=nt,mt=W,ht=rt,yt=Object,wt=pt?function(t){return"symbol"==typeof t}:function(t){var e=gt("Symbol");return mt(e)&&ht(e.prototype,yt(t))},_t=String,vt=function(t){try{return _t(t)}catch(t){return"Object"}},bt=W,$t=vt,Tt=TypeError,It=function(t){if(bt(t))return t;throw Tt($t(t)+" is not a function")},St=It,Ot=function(t,e){var n=t[e];return null==n?void 0:St(n)},Et=$,Ct=W,Pt=V,Lt=TypeError,kt={exports:{}},Rt=m,At=Object.defineProperty,Ut=function(t,e){try{At(Rt,t,{value:e,configurable:!0,writable:!0})}catch(n){Rt[t]=e}return e},xt=Ut,Nt=m["__core-js_shared__"]||xt("__core-js_shared__",{}),jt=Nt;(kt.exports=function(t,e){return jt[t]||(jt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.8",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.8/LICENSE",source:"https://github.com/zloirock/core-js"});var Bt=J,Dt=Object,Gt=function(t){return Dt(Bt(t))},Mt=Gt,Ft=x({}.hasOwnProperty),qt=Object.hasOwn||function(t,e){return Ft(Mt(t),e)},Ht=x,Kt=0,Jt=Math.random(),Yt=Ht(1..toString),zt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Yt(++Kt+Jt,36)},Qt=m,Wt=kt.exports,Xt=qt,Vt=zt,Zt=dt,te=pt,ee=Wt("wks"),ne=Qt.Symbol,re=ne&&ne.for,oe=te?ne:ne&&ne.withoutSetter||Vt,ie=function(t){if(!Xt(ee,t)||!Zt&&"string"!=typeof ee[t]){var e="Symbol."+t;Zt&&Xt(ne,t)?ee[t]=ne[t]:ee[t]=te&&re?re(e):oe(e)}return ee[t]},ae=$,se=V,ce=wt,ue=Ot,fe=function(t,e){var n,r;if("string"===e&&Ct(n=t.toString)&&!Pt(r=Et(n,t)))return r;if(Ct(n=t.valueOf)&&!Pt(r=Et(n,t)))return r;if("string"!==e&&Ct(n=t.toString)&&!Pt(r=Et(n,t)))return r;throw Lt("Can't convert object to primitive value")},le=TypeError,de=ie("toPrimitive"),pe=function(t,e){if(!se(t)||ce(t))return t;var n,r=ue(t,de);if(r){if(void 0===e&&(e="default"),n=ae(r,t,e),!se(n)||ce(n))return n;throw le("Can't convert object to primitive value")}return void 0===e&&(e="number"),fe(t,e)},ge=wt,me=function(t){var e=pe(t,"string");return ge(e)?e:e+""},he=V,ye=m.document,we=he(ye)&&he(ye.createElement),_e=function(t){return we?ye.createElement(t):{}},ve=_e,be=!w&&!y((function(){return 7!=Object.defineProperty(ve("div"),"a",{get:function(){return 7}}).a})),$e=w,Te=$,Ie=T,Se=P,Oe=Q,Ee=me,Ce=qt,Pe=be,Le=Object.getOwnPropertyDescriptor;h.f=$e?Le:function(t,e){if(t=Oe(t),e=Ee(e),Pe)try{return Le(t,e)}catch(t){}if(Ce(t,e))return Se(!Te(Ie.f,t,e),t[e])};var ke={},Re=w&&y((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ae=V,Ue=String,xe=TypeError,Ne=function(t){if(Ae(t))return t;throw xe(Ue(t)+" is not an object")},je=w,Be=be,De=Re,Ge=Ne,Me=me,Fe=TypeError,qe=Object.defineProperty,He=Object.getOwnPropertyDescriptor;ke.f=je?De?function(t,e,n){if(Ge(t),e=Me(e),Ge(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=He(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return qe(t,e,n)}:qe:function(t,e,n){if(Ge(t),e=Me(e),Ge(n),Be)try{return qe(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Fe("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var Ke=ke,Je=P,Ye=w?function(t,e,n){return Ke.f(t,e,Je(1,n))}:function(t,e,n){return t[e]=n,t},ze={exports:{}},Qe=w,We=qt,Xe=Function.prototype,Ve=Qe&&Object.getOwnPropertyDescriptor,Ze=We(Xe,"name"),tn={EXISTS:Ze,PROPER:Ze&&"something"===function(){}.name,CONFIGURABLE:Ze&&(!Qe||Qe&&Ve(Xe,"name").configurable)},en=W,nn=Nt,rn=x(Function.toString);en(nn.inspectSource)||(nn.inspectSource=function(t){return rn(t)});var on,an,sn,cn=nn.inspectSource,un=W,fn=cn,ln=m.WeakMap,dn=un(ln)&&/native code/.test(fn(ln)),pn=kt.exports,gn=zt,mn=pn("keys"),hn=function(t){return mn[t]||(mn[t]=gn(t))},yn={},wn=dn,_n=m,vn=x,bn=V,$n=Ye,Tn=qt,In=Nt,Sn=hn,On=yn,En=_n.TypeError,Cn=_n.WeakMap;if(wn||In.state){var Pn=In.state||(In.state=new Cn),Ln=vn(Pn.get),kn=vn(Pn.has),Rn=vn(Pn.set);on=function(t,e){if(kn(Pn,t))throw new En("Object already initialized");return e.facade=t,Rn(Pn,t,e),e},an=function(t){return Ln(Pn,t)||{}},sn=function(t){return kn(Pn,t)}}else{var An=Sn("state");On[An]=!0,on=function(t,e){if(Tn(t,An))throw new En("Object already initialized");return e.facade=t,$n(t,An,e),e},an=function(t){return Tn(t,An)?t[An]:{}},sn=function(t){return Tn(t,An)}}var Un={set:on,get:an,has:sn,enforce:function(t){return sn(t)?an(t):on(t,{})},getterFor:function(t){return function(e){var n;if(!bn(e)||(n=an(e)).type!==t)throw En("Incompatible receiver, "+t+" required");return n}}},xn=y,Nn=W,jn=qt,Bn=w,Dn=tn.CONFIGURABLE,Gn=cn,Mn=Un.enforce,Fn=Un.get,qn=Object.defineProperty,Hn=Bn&&!xn((function(){return 8!==qn((function(){}),"length",{value:8}).length})),Kn=String(String).split("String"),Jn=ze.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!jn(t,"name")||Dn&&t.name!==e)&&qn(t,"name",{value:e,configurable:!0}),Hn&&n&&jn(n,"arity")&&t.length!==n.arity&&qn(t,"length",{value:n.arity});try{n&&jn(n,"constructor")&&n.constructor?Bn&&qn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Mn(t);return jn(r,"source")||(r.source=Kn.join("string"==typeof e?e:"")),t};Function.prototype.toString=Jn((function(){return Nn(this)&&Fn(this).source||Gn(this)}),"toString");var Yn=W,zn=Ye,Qn=ze.exports,Wn=Ut,Xn={},Vn=Math.ceil,Zn=Math.floor,tr=Math.trunc||function(t){var e=+t;return(e>0?Zn:Vn)(e)},er=function(t){var e=+t;return e!=e||0===e?0:tr(e)},nr=er,rr=Math.max,or=Math.min,ir=er,ar=Math.min,sr=function(t){return t>0?ar(ir(t),9007199254740991):0},cr=function(t){return sr(t.length)},ur=Q,fr=function(t,e){var n=nr(t);return n<0?rr(n+e,0):or(n,e)},lr=cr,dr=function(t){return function(e,n,r){var o,i=ur(e),a=lr(i),s=fr(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},pr={includes:dr(!0),indexOf:dr(!1)},gr=qt,mr=Q,hr=pr.indexOf,yr=yn,wr=x([].push),_r=function(t,e){var n,r=mr(t),o=0,i=[];for(n in r)!gr(yr,n)&&gr(r,n)&&wr(i,n);for(;e.length>o;)gr(r,n=e[o++])&&(~hr(i,n)||wr(i,n));return i},vr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],br=_r,$r=vr.concat("length","prototype");Xn.f=Object.getOwnPropertyNames||function(t){return br(t,$r)};var Tr={};Tr.f=Object.getOwnPropertySymbols;var Ir=nt,Sr=Xn,Or=Tr,Er=Ne,Cr=x([].concat),Pr=Ir("Reflect","ownKeys")||function(t){var e=Sr.f(Er(t)),n=Or.f;return n?Cr(e,n(t)):e},Lr=qt,kr=Pr,Rr=h,Ar=ke,Ur=function(t,e,n){for(var r=kr(e),o=Ar.f,i=Rr.f,a=0;a<r.length;a++){var s=r[a];Lr(t,s)||n&&Lr(n,s)||o(t,s,i(e,s))}},xr=y,Nr=W,jr=/#|\.prototype\./,Br=function(t,e){var n=Gr[Dr(t)];return n==Fr||n!=Mr&&(Nr(e)?xr(e):!!e)},Dr=Br.normalize=function(t){return String(t).replace(jr,".").toLowerCase()},Gr=Br.data={},Mr=Br.NATIVE="N",Fr=Br.POLYFILL="P",qr=Br,Hr=m,Kr=h.f,Jr=Ye,Yr=function(t,e,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:e;return Yn(n)&&Qn(n,i,r),r.global?o?t[e]=n:Wn(e,n):(r.unsafe?t[e]&&(o=!0):delete t[e],o?t[e]=n:zn(t,e,n)),t},zr=Ut,Qr=Ur,Wr=qr,Xr=function(t,e){var n,r,o,i,a,s=t.target,c=t.global,u=t.stat;if(n=c?Hr:u?Hr[s]||zr(s,{}):(Hr[s]||{}).prototype)for(r in e){if(i=e[r],o=t.dontCallGetSet?(a=Kr(n,r))&&a.value:n[r],!Wr(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qr(i,o)}(t.sham||o&&o.sham)&&Jr(i,"sham",!0),Yr(n,r,i,t)}},Vr=ke.f,Zr=qt,to=ie("toStringTag"),eo=m,no=function(t,e,n){t&&!n&&(t=t.prototype),t&&!Zr(t,to)&&Vr(t,to,{configurable:!0,value:e})};Xr({global:!0},{Reflect:{}}),no(eo.Reflect,"Reflect",!0);var ro=_,oo=Function.prototype,io=oo.apply,ao=oo.call,so="object"==typeof Reflect&&Reflect.apply||(ro?ao.bind(io):function(){return ao.apply(io,arguments)}),co=W,uo=String,fo=TypeError,lo=x,po=Ne,go=function(t){if("object"==typeof t||co(t))return t;throw fo("Can't set "+uo(t)+" as a prototype")},mo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=lo(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return po(n),go(r),e?t(n,r):n.__proto__=r,n}}():void 0),ho=ke.f,yo=W,wo=V,_o=mo,vo={};vo[ie("toStringTag")]="z";var bo="[object z]"===String(vo),$o=W,To=D,Io=ie("toStringTag"),So=Object,Oo="Arguments"==To(function(){return arguments}()),Eo=bo?To:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=So(t),Io))?n:Oo?To(e):"Object"==(r=To(e))&&$o(e.callee)?"Arguments":r},Co=Eo,Po=String,Lo=function(t){if("Symbol"===Co(t))throw TypeError("Cannot convert a Symbol value to a string");return Po(t)},ko=function(t,e){return void 0===t?arguments.length<2?"":e:Lo(t)},Ro=V,Ao=Ye,Uo=function(t,e){Ro(e)&&"cause"in e&&Ao(t,"cause",e.cause)},xo=Error,No=x("".replace),jo=String(xo("zxcasd").stack),Bo=/\n\s*at [^:]*:[^\n]*/,Do=Bo.test(jo),Go=function(t,e){if(Do&&"string"==typeof t&&!xo.prepareStackTrace)for(;e--;)t=No(t,Bo,"");return t},Mo=P,Fo=!y((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Mo(1,7)),7!==t.stack)})),qo=nt,Ho=qt,Ko=Ye,Jo=rt,Yo=mo,zo=Ur,Qo=function(t,e,n){n in t||ho(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},Wo=function(t,e,n){var r,o;return _o&&yo(r=e.constructor)&&r!==n&&wo(o=r.prototype)&&o!==n.prototype&&_o(t,o),t},Xo=ko,Vo=Uo,Zo=Go,ti=Fo,ei=w,ni=Xr,ri=so,oi=function(t,e,n,r){var o="stackTraceLimit",i=r?2:1,a=t.split("."),s=a[a.length-1],c=qo.apply(null,a);if(c){var u=c.prototype;if(Ho(u,"cause")&&delete u.cause,!n)return c;var f=qo("Error"),l=e((function(t,e){var n=Xo(r?e:t,void 0),o=r?new c(t):new c;return void 0!==n&&Ko(o,"message",n),ti&&Ko(o,"stack",Zo(o.stack,2)),this&&Jo(u,this)&&Wo(o,this,l),arguments.length>i&&Vo(o,arguments[i]),o}));l.prototype=u,"Error"!==s?Yo?Yo(l,f):zo(l,f,{name:!0}):ei&&o in c&&(Qo(l,c,o),Qo(l,c,"prepareStackTrace")),zo(l,c);try{u.name!==s&&Ko(u,"name",s),u.constructor=l}catch(t){}return l}},ii=m.WebAssembly,ai=7!==Error("e",{cause:7}).cause,si=function(t,e){var n={};n[t]=oi(t,e,ai),ni({global:!0,constructor:!0,arity:1,forced:ai},n)},ci=function(t,e){if(ii&&ii[t]){var n={};n[t]=oi("WebAssembly."+t,e,ai),ni({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:ai},n)}};si("Error",(function(t){return function(e){return ri(t,this,arguments)}})),si("EvalError",(function(t){return function(e){return ri(t,this,arguments)}})),si("RangeError",(function(t){return function(e){return ri(t,this,arguments)}})),si("ReferenceError",(function(t){return function(e){return ri(t,this,arguments)}})),si("SyntaxError",(function(t){return function(e){return ri(t,this,arguments)}})),si("TypeError",(function(t){return function(e){return ri(t,this,arguments)}})),si("URIError",(function(t){return function(e){return ri(t,this,arguments)}})),ci("CompileError",(function(t){return function(e){return ri(t,this,arguments)}})),ci("LinkError",(function(t){return function(e){return ri(t,this,arguments)}})),ci("RuntimeError",(function(t){return function(e){return ri(t,this,arguments)}}));const ui=()=>process.env.QL_BRANCH;function fi(){return function(){const t=Object.keys(process.env),e=t.filter((t=>t.startsWith("SCF_"))).length>=10,n=t.filter((t=>t.startsWith("TENCENTCLOUD_"))).length>=3;return e&&n||!1}()||function(){const t=Object.keys(process.env),e=["securityToken","accessKeyID","accessKeySecret","FC_FUNCTION_MEMORY_SIZE","FC_FUNC_CODE_PATH","FC_RUNTIME_VERSION"];return t.filter((t=>e.includes(t))).length>=3||!1}()||global.IS_CFC||!1||global.IS_CFC||!0}const li=["æ£","æ£å","æ£è¶","å æ²¹~","UPå æ²¹!","æ¯æ~","æ¯ææ¯æï¼","å¬æ´å¦","é¡¶é¡¶","çä¸èå°~","å¹²æ¯","bilibiliå¹²æ¯","o(*ï¿£â½ï¿£*)o","(ï½¡ï½¥âï½¥)ï¾ï¾å¨","(âËâËâ)","( â¢Ì Ï â¢Ì )y","(à¸ â¢_â¢)à¸",">.<","^_~"],di=Object.prototype.toString;function pi(t,e){return di.call(t)===`[object ${e}]`}function gi(t){return null!==t&&pi(t,"Object")}function mi(t){return pi(t,"String")}function hi(t){return t&&Array.isArray(t)}function yi(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function wi(t,e){return Math.ceil(e/t)}function _i(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function vi(){return`${_i(1,9)}${function(t,e){let n="";for(let e=0;e<t;e++)n+=Si("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}(10,!0)}0`}function bi(t,e){t.includes(e)||t.push(e)}function $i(t,e=!1){return gi(t)?Array.isArray(t)?t.map((t=>$i(t,e))):e?Object.keys(t).reduce(((n,r)=>(n[r]=$i(t[r],e),n)),{}):Object.assign({},t):t}function Ti(t,e){return void 0===t||void 0===e?t||e:gi(t)&&gi(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=Ti(t[r],e[r]),n)),t):e}function Ii(t){if(!gi(t)&&!hi(t))return t;const e=new URLSearchParams;return Array.isArray(t)||(t=Object.entries(t)),t.forEach((([t,n])=>{gi(n)?e.append(t,JSON.stringify(n)):e.append(t,String(n))})),e.toString()}function Si(t){return t[_i(t.length-1)]}function Oi(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}function Ei(t,e=!0){return e?t.toLocaleString("zh-CN",{hour12:!1}):t.toLocaleString("zh-CN",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})}function Ci(t="info"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}function Pi(t){return c.resolve(process.cwd(),t)}class Li{static pushValue="";month=yi().getMonth()+1;errorFile=Pi(`./logs/bt_error-${this.month}.log`);logFile=Pi(`./logs/bt_combined-${this.month}.log`);noFile=!1;constructor(t={console:"info",file:"info",push:"info"},e="default"){this.options=t,this.name=e,this.consoleLeval=Ci(this.options.console),this.fileLeval=Ci(this.options.file),this.pushLeval=Ci(this.options.push),this.noFile=ui()||fi(),this.noFile||this.createLogFile()}log({level:t},e){const n=yi(),r=`[${t} ${Ei(n,!1)}] ${e}\n`,o=["error","warn"].includes(t);this.consoleLeval.includes(t)&&this.Conslole(r,o),!this.noFile&&this.fileLeval.includes(t)&&this.File(`[${t} ${Ei(n,!0)}] ${e}\n`,o),this.pushLeval.includes(t)&&this.Push(r)}error(t){this.log({level:"error"},t)}warn(t){this.log({level:"warn"},t)}info(t){this.log({level:"info"},t)}verbose(t){this.log({level:"verbose"},t)}debug(t){this.log({level:"debug"},t)}Conslole(t,e){e?process.stderr.write(t):process.stdout.write(t)}File(t,e){e&&u.appendFileSync(this.errorFile,t,"utf-8"),u.appendFileSync(this.logFile,t,"utf-8")}Push(t){Li.pushValue+=t}createLogFile(){const t=Pi("./logs");u.existsSync(t)||u.mkdirSync(t)}}const ki=new Li({console:"debug",file:"debug",push:"debug"});function Ri(t){try{const e=n.unzipSync(Buffer.from(t,"base64")).toString();try{return decodeURIComponent(function(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}(e))}catch(t){return unescape(e)}}catch(t){throw new Error("Error: å½åå­ç¬¦ä¸²ä¸è½è¢«Gzipè§£å")}}class Ai{static configFileName=function(){const t=ui()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=ui()}const Ui=f.default?f.default:f;function xi(t){try{let n;if((e.existsSync(t)||e.existsSync(t+="5"))&&(n=e.readFileSync(t,"utf-8")),!n)return;return ki.verbose(`è¯»åéç½®æä»¶ ${t}`),Ui.parse(n)}catch(t){!function(t){if(!mi(t))return;if(t.includes("SyntaxError: JSON5"))throw ki.error(t),new SyntaxError("éç½®æä»¶å­å¨ï¼ä½æ¯æ æ³è§£æï¼å¯è½ JSON5 æ ¼å¼ä¸æ­£ç¡®ï¼");throw new Error(t)}(t.message)}}const Ni=t=>c.resolve(process.cwd(),t),ji=t=>c.resolve(__dirname,"../",t),Bi=Array.from(new Set([Ni("./config/config.dev.json"),Ni(`./config/${Ai.configFileName}`),Ni(`./${Ai.configFileName}`),ji(`./config/${Ai.configFileName}`),ji(`./${Ai.configFileName}`)])),Di=["./config.json",Ni("./config/config.json")];function Gi(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(Ai.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(ki.warn("ä¼¼ä¹æ³è¦æå®ä¸ä¸ªä¸å­å¨çç¨æ·ï¼æä»¬å°æå®ç¬¬ä¸ä¸ªç¨æ·"),t[0]):t[n]}(e);ki.warn("å¨åç¨æ·åºæ¯ä¸éç½®äºå¤ç¨æ·ï¼æä»¬å°æ¾å¼å¤ä½çéç½®");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function Mi(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;Ai.isQingLongPanel&&Bi.splice(0,1,...Di);for(let t=0;t<Bi.length;t++){const e=xi(Bi[t]);if(e)return e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return Ui.parse(Ri(r))}catch{throw new Error("ç¯å¢ä¸­çéç½®ä¸æ¯ææç JSON å­ç¬¦ä¸²ï¼")}})()}function Fi(t){if(!t)throw new Error("è·åéç½®å¤±è´¥ï¼æªæ¾å°éç½®æä»¶ï¼");if(function(t){if(Array.isArray(t))return!0;return Boolean(t.account&&t.account.length)}(t)){const e=Gi(t);if(e)return e}if(!t.cookie)throw new Error("éç½®æä»¶ä¸­æ²¡æ cookieï¼");return t}function qi(t){return t?t.split("; ").map((t=>t.split("="))):[]}function Hi(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=qi(null==e?void 0:e[0]).filter((t=>2===t.length)),r=qi(t).concat(n).filter((t=>2===t.length)),o={};for(const t of r)o[t[0]]?o[t[0]]=t[1]:Object.defineProperty(o,t[0],{value:t[1],enumerable:!0,writable:!0});return o}(t,e)):t:""}function Ki(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}const Ji={cookie:"",message:{email:{host:"smtp.163.com",port:465},pushplusToken:process.env.PUSHPLUS_TOKEN,api:void 0},function:{silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1,liveRedPack:!1,liveIntimacy:!1},apiDelay:[2,6],userAgent:"",dailyRunTime:"17:30:00-23:40:00",targetLevel:void 0,stayCoins:void 0,targetCoins:void 0,customizeUp:void 0,giftUp:void 0,coinRetryNum:void 0,chargeUpId:void 0,chargePresetTime:void 0,matchCoins:void 0,matchSelection:void 0,matchDiff:void 0,match:{coins:5,selection:1,diff:0},charge:{mid:0,presetTime:31},gift:{mids:[]},coin:{customizeUp:[],retryNum:4,targetLevel:6,stayCoins:0,targetCoins:5},sls:{name:"",description:"",region:"ap-chengdu",dailyRunTime:"17:30:00-23:40:00"},lottery:{excludeAward:["è°","è¹","èªæµ·","ä»£éå¸","ä¼æ å¸","èªæ","ç§","åç","å¾","æç£","è½¦è½¦ä¸å±","åæ¥ä¸å±","æ¸¸æéå·"],includeAward:["è°¢"],blackUid:[65566781,1277481241,1643654862,603676925],isMoveTag:!0,moveTag:"å¤©éæ¶å»",pageNum:2,actFollowMsg:"read",scanFollow:void 0,skipNeedFollow:!1},redPack:{},intimacy:{liveSendMessage:!0,liveShare:!0,liveLike:!0,whiteList:[],blackList:[]},BILIJCT:"",USERID:0};function Yi(){return $i(Ji,!0)}function zi(t){return function(t){!function(t){t.BILIJCT=function(t){return Ki(t,"bili_jct")||""}(t.cookie),t.USERID=function(t){return Number(Ki(t,"DedeUserID"))||0}(t.cookie)}(t);const{coin:e,gift:n,charge:r}=t;hi(t.apiDelay)?t.apiDelay=Oi(t.apiDelay):t.apiDelay=[Number(t.apiDelay)];e.customizeUp=Oi(e.customizeUp),n.mids=Oi(n.mids),0===n.mids.length&&(n.mids=e.customizeUp);r.mid||(r.mid=t.USERID);return t}(function(t){return Object.keys(Qi).forEach((e=>{if(void 0!==t[e]){const[n,r]=Qi[e];t[n]=t[n]||{},t[n][r]=t[e]}delete t[e]})),t}(Ti(Yi(),t)))}const Qi={targetLevel:["coin","targetLevel"],stayCoins:["coin","stayCoins"],targetCoins:["coin","targetCoins"],customizeUp:["coin","customizeUp"],coinRetryNum:["coin","retryNum"],giftUp:["gift","mids"],chargeUpId:["charge","mid"],chargePresetTime:["charge","presetTime"],matchCoins:["match","coins"],matchSelection:["match","selection"],matchDiff:["match","diff"]};class Wi{constructor(t){this.COOKIE=t.cookie,this.BILIJCT=t.BILIJCT,this.USERID=t.USERID,this.USER_AGENT=t.userAgent,this.BILI_API_DELAY=t.apiDelay;const e=t.message;this.MESSAGE_API=e.api,this.PUSHPLUS_TOKEN=e.pushplusToken;const n=t.coin;this.BILI_CUSTOMIZE_UP=n.customizeUp,this.BILI_COIN_RETRY_NUM=n.retryNum,this.BILI_TARGET_LEVEL=n.targetLevel,this.BILI_STAY_COINS=n.stayCoins,this.BILI_TARGET_COINS=n.targetCoins;const r=t.gift;this.BILI_GIFT_UP=r.mids;const o=t.charge;this.CHARGE_ID=o.mid,this.CHARGE_PRESET_TIME=o.presetTime;const i=t.match;this.MATCH_COINS=i.coins,this.MATCH_SELECTION=i.selection,this.MATCH_DIFF=i.diff}}let Xi;const Vi=new Proxy({},{get:(t,e)=>(Xi||ta(),Reflect.get(Xi,e)),set:(t,e,n)=>"config"===e&&n?(ta(n),!0):Reflect.set(Xi,e,n)});let Zi=null;function ta(t){t||(t=Fi(Mi()));const e=zi(t);Xi={...new Wi(Fi(e)),...e},Zi=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},Zi.coinsTask=Xi.BILI_TARGET_COINS}function ea(t){const e=function(){const t=Vi.function;return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t.liveIntimacy&&(t.liveSendMessage=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}function na(t,e){const n=function(t,e){if(t&&e)return _i(t,e);if(t)return t;const n=Vi.BILI_API_DELAY;if(1===n.length)return 1e3*n[0];return 1e3*_i(n[0]||2,n[1]||6)}(t,e);return new Promise((t=>{setTimeout((()=>{t(n)}),n)}))}var ra;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t["åºç¨ç¨åºä¸å­å¨æå·²è¢«å°ç¦"]=-1]="åºç¨ç¨åºä¸å­å¨æå·²è¢«å°ç¦",t[t["Access Keyéè¯¯"]=-2]="Access Keyéè¯¯",t[t["APIæ ¡éªå¯åéè¯¯"]=-3]="APIæ ¡éªå¯åéè¯¯",t[t["è°ç¨æ¹å¯¹è¯¥Methodæ²¡ææé"]=-4]="è°ç¨æ¹å¯¹è¯¥Methodæ²¡ææé",t[t["è´¦å·æªç»å½"]=-101]="è´¦å·æªç»å½",t[t["è´¦å·è¢«å°å"]=-102]="è´¦å·è¢«å°å",t[t["ç§¯åä¸è¶³"]=-103]="ç§¯åä¸è¶³",t[t["ç¡¬å¸ä¸è¶³"]=-104]="ç¡¬å¸ä¸è¶³",t[t["éªè¯ç éè¯¯"]=-105]="éªè¯ç éè¯¯",t[t["è´¦å·éæ­£å¼ä¼åæå¨éåºæ"]=-106]="è´¦å·éæ­£å¼ä¼åæå¨éåºæ",t[t["åºç¨ä¸å­å¨æèè¢«å°ç¦"]=-107]="åºç¨ä¸å­å¨æèè¢«å°ç¦",t[t["æªç»å®ææº?"]=-108]="æªç»å®ææº?",t[t["æªç»å®ææº"]=-110]="æªç»å®ææº",t[t["csrf æ ¡éªå¤±è´¥"]=-111]="csrf æ ¡éªå¤±è´¥",t[t["ç³»ç»åçº§ä¸­"]=-112]="ç³»ç»åçº§ä¸­",t[t["è´¦å·å°æªå®åè®¤è¯"]=-113]="è´¦å·å°æªå®åè®¤è¯",t[t["è¯·åç»å®ææº"]=-114]="è¯·åç»å®ææº",t[t["è¯·åå®æå®åè®¤è¯"]=-115]="è¯·åå®æå®åè®¤è¯"}(ra||(ra={}));const oa="https://account.bilibili.com",ia="https://live.bilibili.com",aa="https://space.bilibili.com",sa="https://message.bilibili.com",ca="https://www.bilibili.com",ua="https://www.bilibili.com/",fa="https://account.bilibili.com",la="https://api.live.bilibili.com",da="https://api.bilibili.com",pa="https://manga.bilibili.com",ga="https://api.vc.bilibili.com",ma={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate, br"},ha=(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!1===n)return t.body;const{body:o}=t;if(e.isJsonp&&mi(o))return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(o);try{if(mi(o)&&o.startsWith("{"))return JSON.parse(o)}catch{}return o};class ya{name="VGot";constructor(t){t.baseURL&&(t.prefixUrl=t.baseURL),this.options=t,this.gotInstance=d.default.extend(t,{hooks:{afterResponse:[t=>{const{requestOptions:e}=t.request.options;var n;null!=e&&e.withBiliCookie&&(Vi.COOKIE=Hi(Vi.COOKIE,(null===(n=t.headers)||void 0===n?void 0:n["set-cookie"])||[]));return t}]}})}request(t){const{requestOptions:e={},headers:n={}}=this.options;return t.requestOptions=Object.assign({},e,t.requestOptions),t.headers=function(t={},e={}){function n(t){return Object.keys(t).reduce(((e,n)=>(e[n.toLowerCase()]=t[n],e)),{})}return Object.assign({},n(t),n(e))}(n,t.headers),e.withBiliCookie&&(t.headers.Cookie=Vi.COOKIE),e.retry&&(t.retry=e.retry),t=function(t){mi(t.url)||(t.url=t.url.toString()),gi(t.params)&&!mi(t.searchParams)&&(t.searchParams={...t.searchParams,...t.params});const e=t.headers["content-type"],n=null==e?void 0:e.startsWith("application/x-www-form-urlencoded");function r(e){t.agent||(t.agent={}),t.agent[e]=t[`${e}Agent`]}return gi(t.data)&&(n?t.body=Ii(t.data):t.json=t.data),mi(t.data)&&n&&(t.body=t.data),t.httpAgent&&r("http"),t.httpsAgent&&r("https"),t.url&&t.url.startsWith("/")&&(t.url=t.url.substring(1)),t}(t),new Promise(((e,n)=>{this.gotInstance(t).then((r=>{{"function"!=typeof ha;try{const n=ha(r,t.requestOptions);e(n)}catch(t){n(t||new Error("è¯·æ±éè¯¯!"))}}})).catch((t=>{n(t)}))}))}get(t,e){return mi(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return mi(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}}function wa(t){return new ya(Ti({timeout:1e4,headers:{"content-type":ma["content-type"],"user-agent":ma["user-agent"],"accept-language":ma["accept-language"],"accept-encoding":ma["accept-encoding"]},requestOptions:{isTransformResponse:!0,ignoreCancelToken:!0,withBiliCookie:!0}},t||{}))}const _a=wa({requestOptions:{withBiliCookie:!1}}),va=wa();let ba;function $a(){const t=Vi.message||{};ba={},["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((e=>{const n=t[(r=e,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||t[e]||process.env[e];var r;n&&(ba[e]=n)})),Vi.PUSHPLUS_TOKEN&&(ba.PUSH_PLUS_TOKEN=Vi.PUSHPLUS_TOKEN),function(){ba.PUSH_KEY&&(Ta=ba.PUSH_KEY);ba.QQ_SKEY&&(Ga=ba.QQ_SKEY);ba.QQ_MODE&&(Ma=ba.QQ_MODE);ba.BARK_PUSH?(Ia=ba.BARK_PUSH.indexOf("https")>-1||ba.BARK_PUSH.indexOf("http")>-1?ba.BARK_PUSH:`https://api.day.app/${ba.BARK_PUSH}`,ba.BARK_SOUND&&(Sa=ba.BARK_SOUND),ba.BARK_GROUP&&(Oa=ba.BARK_GROUP)):Ia&&-1===Ia.indexOf("https")&&-1===Ia.indexOf("http")&&(Ia=`https://api.day.app/${Ia}`);ba.TG_BOT_TOKEN&&(Ea=ba.TG_BOT_TOKEN);ba.TG_USER_ID&&(Ca=ba.TG_USER_ID);ba.TG_PROXY_AUTH&&(ka=ba.TG_PROXY_AUTH);ba.TG_PROXY_HOST&&(Pa=ba.TG_PROXY_HOST);ba.TG_PROXY_PORT&&(La=ba.TG_PROXY_PORT);ba.TG_API_HOST&&(Ra=ba.TG_API_HOST);ba.DD_BOT_TOKEN&&(Aa=ba.DD_BOT_TOKEN,ba.DD_BOT_SECRET&&(Ua=ba.DD_BOT_SECRET));ba.QYWX_KEY&&(xa=ba.QYWX_KEY);ba.QYWX_AM&&(Na=ba.QYWX_AM);ba.IGOT_PUSH_KEY&&(ja=ba.IGOT_PUSH_KEY);ba.PUSH_PLUS_TOKEN&&(Ba=ba.PUSH_PLUS_TOKEN);ba.PUSH_PLUS_USER&&(Da=ba.PUSH_PLUS_USER)}()}let Ta="",Ia="",Sa="",Oa="QingLong",Ea="",Ca="",Pa="",La="",ka="",Ra="api.telegram.org",Aa="",Ua="",xa="",Na="",ja="",Ba="",Da="",Ga="",Ma="";async function Fa(t,e){var n;const r=null===(n=Vi.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const o=Number(r.port)||465,i=l.createTransport({host:r.host,port:o,secure:465===o,auth:{user:r.from,pass:r.pass}}),a=await i.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});ki.info(`é®ä»¶æ¶æ¯å·²åé: ${a.messageId}`)}async function qa(t,e){try{const n=Vi.MESSAGE_API;if(!n)return;const r=n.replace("{title}",t).replace("{text}",e);await _a.get(r)}catch(t){ki.info(`èªå®ä¹æ¥å£æ¶æ¯åéå¤±è´¥: ${t}`),ki.error(t)}}function Ha(t,e,n=2100){return new Promise((r=>{if(Ta){e=e.replace(/[\n\r]/g,"\n\n");const o={url:Ta.includes("SCT")?`https://sctapi.ftqq.com/${Ta}.send`:`https://sc.ftqq.com/${Ta}.send`,params:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{_a.post(o).then((t=>{0===t.errno||0===t.data.errno?ki.info("serveré±åééç¥æ¶æ¯æåð"):1024===t.errno?ki.info(`serveré±åééç¥æ¶æ¯å¼å¸¸: ${t.errmsg}`):ki.info(`serveré±åééç¥æ¶æ¯å¼å¸¸\n${JSON.stringify(t)}`)})).catch((t=>{ki.info("åééç¥è°ç¨APIå¤±è´¥ï¼ï¼"),ki.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function Ka(t,e){return new Promise((n=>{if(Ga){const r={url:`https://push.xuthus.cc/${Ma}/${Ga}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/äº¬è±/g,"è±è±"),e=(e=(e=e.replace(/äº¬è±/g,"")).replace(/ð¶/g,"")).replace(/çº¢å/g,"Hå"),"email"===Ma?r.data={t:t,c:e}:r.params=`${t}\n\n${e}`;const o=function(t){switch(t){case"send":return"ä¸ªäºº";case"group":return"QQç¾¤";case"wx":return"å¾®ä¿¡";case"ww":return"ä¼ä¸å¾®ä¿¡";case"email":return"é®ä»¶";default:return"æªç¥æ¹å¼"}};_a.post(r).then((t=>{200===t.code?ki.info(`é·æ¨åé${o(Ma)}éç¥æ¶æ¯æåð`):400===t.code?ki.info(`QQé·æ¨(Cool Push)åé${o(Ma)}æ¨éå¤±è´¥ï¼${t.msg}`):503===t.code?ki.info(`QQé·æ¨åºéï¼${t.message}ï¼${t.data}`):ki.info(`é·æ¨æ¨éå¼å¸¸: ${JSON.stringify(t)}`)})).catch((t=>{ki.info(`åé${o(Ma)}éç¥è°ç¨APIå¤±è´¥ï¼ï¼`),ki.info(t)})).finally((()=>{n("")}))}else n("")}))}function Ja(t,e,n={}){return new Promise((r=>{if(Ia){const o={url:`${Ia}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${Sa}&group=${Oa}&${Ii(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};_a.get(o).then((t=>{200===t.code?ki.info("Bark APPåééç¥æ¶æ¯æåð"):ki.info(`Bark APPåééå¤±è´¥ï¼${t.message}`)})).catch((t=>{ki.info("Bark APPåééç¥è°ç¨APIå¤±è´¥ï¼ï¼"),ki.error(t)})).finally((()=>{r("")}))}r("")}))}function Ya(t,e){return new Promise((async n=>{if(Ea&&Ca){const r={url:`https://${Ra}/bot${Ea}/sendMessage`,data:`chat_id=${Ca}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(Pa&&La){const t=(await Promise.resolve().then((function(){return s(require("tunnel"))}))).httpsOverHttp({proxy:{host:Pa,port:+La,proxyAuth:ka},maxSockets:1});Object.assign(r,{httpsAgent:t})}_a.post(r).then((t=>{t.ok?ki.info("Telegramåééç¥æ¶æ¯æåðã"):400===t.error_code?ki.info("è¯·ä¸»å¨ç»botåéä¸æ¡æ¶æ¯å¹¶æ£æ¥æ¥æ¶ç¨æ·IDæ¯å¦æ­£ç¡®ã"):401===t.error_code&&ki.info("Telegram bot token å¡«åéè¯¯ã")})).catch((t=>{ki.info("telegramåééç¥æ¶æ¯å¤±è´¥ï¼ï¼"),ki.info(t)})).finally((()=>{n("")}))}else n("")}))}function za(t,e){return new Promise((n=>{const r={url:`https://oapi.dingtalk.com/robot/send?access_token=${Aa}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(Aa){if(Ua){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",Ua);n.update(`${e}\n${Ua}`);const o=encodeURIComponent(n.digest("base64"));r.url=`${r.url}&timestamp=${e}&sign=${o}`}_a.post(r).then((t=>{0===t.errcode?ki.info("ééåééç¥æ¶æ¯æåðã"):ki.info(`ééåééç¥å¤±è´¥ï¼${t.errmsg}`)})).catch((t=>{ki.info("ééåééç¥æ¶æ¯å¤±è´¥ï¼ï¼"),ki.info(t)})),n("")}else n("")}))}function Qa(t,e){return new Promise((n=>{const r={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${xa}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};xa&&_a.post(r).then((t=>{0===t.errcode?ki.info("ä¼ä¸å¾®ä¿¡åééç¥æ¶æ¯æåðã"):ki.info(`ä¼ä¸å¾®ä¿¡åééç¥å¤±è´¥ï¼${t.errmsg}`)})).catch((t=>{ki.info("ä¼ä¸å¾®ä¿¡åééç¥æ¶æ¯å¤±è´¥ï¼ï¼"),ki.info(t)})).finally((()=>{n("")})),n("")}))}function Wa(t){const e=Na.split(",");if(e[2]){const n=e[2].split("|");let r="";for(let e=0;e<n.length;e++){const o="ç­¾å°å· "+(e+1);t.match(o)&&(r=n[e])}return r||(r=e[2]),r}return"@all"}function Xa(t,e){return new Promise((n=>{if(Na){const r=Na.split(","),o={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${r[0]}`,corpsecret:`${r[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};_a.post(o).then((o=>{const i=e.replace(/\n/g,"<br/>"),a=JSON.parse(o).access_token;let s;switch(r[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"æ´å¤"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${r[4]}`,author:"æºè½å©æ",content_source_url:"",content:`${i}`,digest:`${e}`}]}}}r[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${Wa(e)}`,agentid:`${r[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},_a.post(s).then((t=>{0===t.errcode?ki.info("æåID:"+Wa(e)+"ä¼ä¸å¾®ä¿¡åºç¨æ¶æ¯åééç¥æ¶æ¯æåðã"):ki.info(`ä¼ä¸å¾®ä¿¡åºç¨ï¼${t.errmsg}`)})).catch((t=>{ki.info("æåID:"+Wa(e)+"ä¼ä¸å¾®ä¿¡åºç¨æ¶æ¯åééç¥æ¶æ¯å¤±è´¥ï¼ï¼"),ki.info(t)})).finally((()=>{n("")}))})).catch((t=>{ki.error("ä¼ä¸å¾®ä¿¡åºç¨æ¶æ¯åééç¥æ¶æ¯å¤±è´¥ï¼ï¼")}))}else n("")}))}function Va(t,e,n={}){return new Promise((r=>{if(ja){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(ja))return ki.info("æ¨ææä¾çIGOT_PUSH_KEYæ æ"),void r("");const o={url:`https://push.hellyw.com/${ja.toLowerCase()}`,params:`title=${t}&content=${e}&${Ii(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};_a.post(o).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?ki.info("iGotåééç¥æ¶æ¯æåð"):ki.info(`iGotåééç¥æ¶æ¯å¤±è´¥ï¼${t.errMsg}`)})).catch((t=>{ki.info("åééç¥è°ç¨APIå¤±è´¥ï¼ï¼"),ki.info(t)})).finally((()=>{r("")}))}else r("")}))}function Za(t,e){return new Promise((n=>{if(Ba){e=e.replace(/[\n\r]/g,"<br>");const r={url:"https://www.pushplus.plus/send",params:{token:`${Ba}`,title:`${t}`,content:`${e}`,topic:`${Da}`},headers:{"Content-Type":" application/json"},timeout:15e3};_a.post(r).then((t=>{200===t.code?ki.info(`push+åé${Da?"ä¸å¯¹å¤":"ä¸å¯¹ä¸"}éç¥æ¶æ¯å®æã`):ki.info(`push+åé${Da?"ä¸å¯¹å¤":"ä¸å¯¹ä¸"}éç¥æ¶æ¯å¤±è´¥ï¼${t.msg}`)})).catch((t=>{ki.info(`push+åé${Da?"ä¸å¯¹å¤":"ä¸å¯¹ä¸"}éç¥æ¶æ¯å¤±è´¥ï¼ï¼`),ki.info(t)})).finally((()=>{n("")}))}else n("")}))}async function ts(t,e){ki.info("----ãæ¶æ¯æ¨éã----"),t=`Bili-${Zi.nickname}-${t}`,await async function(t,e,n={},r="\n\næ¬éç¥ Byï¼https://github.com/catlair/BiliTools"){$a(),e+=r,await Promise.all([Ha(t,e),Za(t,e)]),await Promise.all([Ja(t,e,n),Ya(t,e),za(t,e),Qa(t,e),Xa(t,e),Va(t,e,n),Fa(t,e),qa(t,e),Ka(t,e)])}(t,e,void 0,"")}const es=wa({baseURL:fa,headers:{"user-agent":Vi.USER_AGENT}}),ns=wa({baseURL:la,headers:{Referer:ua,"user-agent":Vi.USER_AGENT}}),rs=wa({baseURL:da,headers:{Referer:ua,"user-agent":Vi.USER_AGENT}}),os=wa({baseURL:pa,headers:{"user-agent":Vi.USER_AGENT}}),is=wa({baseURL:ga,headers:{"user-agent":Vi.USER_AGENT}});function as(t=1,e=50,n=1){return ns.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`)}function ss({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:o}){const i=Vi.BILIJCT,a=i,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:o,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:i,platform:"pc",biz_code:"Live",csrf_token:a,uid:Vi.USERID};return ns.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:ia}})}function cs(t){return ns.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${t}`)}function us(){return rs.get("/x/web-interface/nav",{headers:{Origin:oa}})}function fs(){return rs.get("/x/web-interface/coin/today/exp")}function ls(t=1,e=50,n=-10){return rs.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function ds(t,e){return rs.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:Vi.BILIJCT},{headers:{Origin:aa}})}function ps(t){const e=t.level_info,n=e.current_level;if(n>=Vi.BILI_TARGET_LEVEL&&(Zi.coinsTask=0),ki.info(`å½åç­çº§: ${e.current_level}`),n>=6){const t=Vi.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,ki.info("å·²ç»æ»¡çº§ï¼ä¸éè¦åæå¸äºï¼åä¸ªç½å«æªå§")}else{const t=e.next_exp-e.current_exp;ki.info(`è·ç¦»åçº§è¿éè¦ ${t} ç»éªï¼é¢è®¡ ${function(t){if(Vi.BILI_TARGET_COINS<=0)return t/15;const e=10*Vi.BILI_TARGET_COINS+15,n=t/e,r=Zi.money/(Vi.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} å¤©`)}}async function gs(t){try{var e;const{data:n}=await es.get("/site/getCoin");ki.info(`ç»å½æå: ${t.uname}`),ki.info(`ç¡¬å¸ä½é¢: ${n.money||0}`),Zi.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),Zi.money=n.money||0,Zi.userLevel=t.level_info.current_level,Zi.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,ps(t),function(t){let e="";switch(Zi.vipType=t.vipType,t.vipType){case 0:e="æ å¤§ä¼å";break;case 1:e="æåº¦å¤§ä¼å";break;case 2:e="å¹´åº¦å¤§ä¼å"}0===t.vipStatus&&(e="æ å¤§ä¼å"===e?e:e+"[å·²è¿æ]"),ki.info(`å¤§ä¼åç¶æ: ${e}`)}(t)}catch(t){ki.error(`è·åç¡¬å¸ä¿¡æ¯å¼å¸¸: ${t.message}`),ki.debug(t)}}function ms(t,e,n=1){return rs.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:Vi.BILIJCT})}function hs(t,e=1){return va.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:Vi.BILIJCT})}const ys="video",ws="audio",_s="article";async function vs(t=!0){try{const e=Vi.USERID,{data:n,message:r,code:o}=await(t?function(t=1,e=50){return ls(t,e,-10)}():function(t,e=1,n=50,r="desc",o="attention"){return rs.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:o}})}(e)),i=t?n:n.list;if(!i||0===i.length)return{msg:"-1",data:{}};if(0===o){await na();const{mid:t}=Si(i)||{};return await Ts(t)}return{msg:t?`æªè·åå°ç¹å«å³æ³¨åè¡¨: ${o}-${r}`:`æªè·åå°å³æ³¨åè¡¨: ${o}-${r}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function bs(){const t=Si([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t=1,e=3){return rs.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=Si(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`æªè·åå°æè¡ä¿¡æ¯: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function $s(){const t=Vi.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await Ts(Si(t))}async function Ts(t){try{const{code:e,data:n,message:r}=await function(t){return rs.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`éè¿uidè·åè§é¢å¤±è´¥: ${e}-${r}`,data:{}};await na();const{video:o,audio:i,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const o=_i(0,r-1);let i=o;if(o<t)return{type:ys,page:wi(30,i+1),index:i%30};const a=t+e;return i=o-t,o<a?{type:ws,page:wi(30,i+1),index:i%30}:(i=o-a,{type:_s,page:wi(12,i+1),index:i%12})}([o,i,a]),f={[ys]:Is,[ws]:Ss,[_s]:Os},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return ki.debug(t),{msg:t.message,data:{}}}}async function Is(t,e,n){const{code:r,data:o,message:i}=await function(t,e=30,n=1,r=""){return rs.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:i};const{aid:a,title:s,author:c}=o.list.vlist[n];return{type:ys,id:a,title:s,author:c}}async function Ss(t,e,n){const{code:r,data:o,msg:i}=await function(t,e=30,n=1){return rs.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:i};const{data:a}=o,{id:s,uname:c,title:u}=a[n];return{type:ws,id:s,title:u,author:c}}async function Os(t,e,n){const{code:r,data:o,message:i}=await function(t,e=12,n=1){return rs.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:i};const{articles:a}=o,{id:s,title:c,author:{name:u}}=a[n];return{type:_s,id:s,title:c,author:u,mid:t}}const Es=function(){const t=[$s,vs,()=>vs(!1),bs];return Vi.BILI_CUSTOMIZE_UP||t.shift(),t}();async function Cs(t=0){Es.splice(0,Zi.currentStartFun+t);for(let t=0;t<Es.length;t++){var e;const n=Es[t];let r=Number(null!==(e=Vi.BILI_COIN_RETRY_NUM)&&void 0!==e?e:4);for(r=r<1?1:r>8?8:r;r--;){await na();const t=await n();if("-1"===t.msg&&(r=0),"0"===t.msg)return t}r<=0&&(Zi.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function Ps({id:t,coin:e=1,type:n="video",mid:r}){const o={[ys]:ms,[ws]:hs,[_s]:(t,e=1)=>function(t,e,n=1){return rs.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:Vi.BILIJCT})}(r,t,e)},i=await o[n](Number(t),e);return{code:i.code,message:i.message||i.msg}}async function Ls(t){if(await async function(){try{const{data:t,code:e}=await fs();if(0==e){const e=Vi.BILI_TARGET_COINS-t/10;Zi.coinsTask=e>0?e:0}}catch(t){}}(),Zi.coinsTask<=0||Zi.money<=0)return!0;const{data:e,msg:n}=await Cs(t.priority);return null!=e&&e.id&&"0"==n?(await na(),await async function(t,e){const{id:n,title:r,author:o,type:i,mid:a}=t;try{const t=await Ps({id:n,type:i,mid:a});if(0===t.code)Zi.money--,Zi.coinsTask--,e.num++,ki.info(`ç»[${r}--upã${o}ã]æå¸æå`);else if(34005===t.code)e.fillCount++,ki.verbose(`å½åç¨¿ä»¶[${n}]ä¸è½åæå¸äº`),e.fillCount>=3&&(ki.warn("èªå®ä¹ç¨æ·ç»æå¸ä¼¼ä¹æ²¡æå¸å¯æäº"),e.priority++);else{if(-111===t.code||-104===t.code)return ki.warn(`${n} ${t.message} æ æ³ç»§ç»­è¿è¡æå¸`),!0;if(e.eCount++,ki.warn(`ç»${n}æå¸å¤±è´¥ ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,ki.error(`æå¸å¼å¸¸ ${t.message}`)}finally{await na(1500)}return!1}(e,t)):(t.eCount++,!1)}async function ks(){try{const{data:t,code:e,message:n}=await is.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(ki.warn(`è·åèªå·±çåºæ´å¢å¼å¸¸å¤±è´¥: ${n}`),[])}catch(t){ki.error(`è·åèªå·±çåºæ´å¢å¼å¸¸: ${t}`)}}const Rs=["(ââ½â)","ï¼ï¿£â½ï¿£ï¼","(=ã»Ïã»=)","(ï½ã»Ïã»Â´)","(ãï¿£â³ï¿£)ã","(ï½¥âï½¥)","(Â°âÂ°)ï¾","(ï¿£3ï¿£)","â®(ï¿£â½ï¿£)â­","_(:3ãâ )_","( Â´_ãï½)","â_â","â_â","(<_<)","(>_>)","(;Â¬_Â¬)","(ï¾Ðï¾â¡ï¾Ð´ï¾)!?","Î£(ï¾Ð´ï¾;)","Î£( ï¿£â¡ï¿£||)","(Â´ï¼Ïï¼`)","ï¼/TÐT)/","(^ã»Ïã»^ )","(ï½¡ï½¥Ïï½¥ï½¡)","(âï¿£(ï½´)ï¿£â)","Îµ=Îµ=(ãâ§ââ¦)ã","(Â´ï½¥_ï½¥`)","(-_-#)","ï¼ï¿£ã¸ï¿£ï¼","(ï¿£Îµ(#ï¿£) Î£","ã½(`ÐÂ´)ï¾","ï¼#-_-)â¯ââ¯","(â¯Â°å£Â°)â¯(â´ââ´","ââ¡â","( â¥Ð´â¥)","Î£>â(ãÂ°ÏÂ°ã)â¡â","â(â ââ¢âÏââ¢â â)â","(â¬ï¾Ð´ï¾)âï¸»â»â³âä¸","ï½¥*ï½¥:â¡(ãÎµ:)","(æ±)","(è¦ç¬)"].concat("1","2","3","4","5","6","7","8","9","ç­¾å°","åå"),As=new Li({console:"debug",file:"debug"},"live");async function Us(){let t=99,e=0;const n=[];try{for(;e<t;){const{code:r,message:o,data:i}=await as(e+1,50,Vi.USERID);if(0!==r)return ki.verbose(`è·ååç« ä¿¡æ¯å¤±è´¥ ${r} ${o}`),null;if(!i)return n;t=i.page_info.total_page,e=i.page_info.current_page,n.push(...i.list,...i.special_list)}return n}catch(t){return ki.error(`è·ååç« å¼å¸¸ ${t.message}`),null}}function xs({room_info:t,medal:e}){if(null==t||!t.room_id)return!1;if(e.level>=20)return!1;if(e.today_feed>=e.day_limit)return!1;const{whiteList:n,blackList:r}=Vi.intimacy;return n&&n.length?!!n.includes(t.room_id):!r||!r.includes(t.room_id)}async function Ns(t,e){const n=Rs[_i(Rs.length-1)];try{const{code:r,message:o}=await function(t,e){const n=Vi.BILIJCT,r=n;return e||(e=_i(10).toString()),ns.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(ki.warn(`ã${e}ã${t}-å¯è½æªå¼å¯è¯è®º`),!1):(ki.warn(`ã${e}ã${t}-åéå¤±è´¥ ${o}`),ki.verbose(`code: ${r}`),!1))}catch(t){ki.verbose(`åéå¼¹å¹å¼å¸¸ ${t.message}`)}}async function js(t){try{const{code:n,message:r,data:o}=await(e=t,ns.post("xlive/web-room/v1/index/TrigerInteract",{roomid:e,interact_type:3,csrf:Vi.BILIJCT,csrf_token:Vi.BILIJCT,visit_id:""}));if(0===n)return o;ki.info(`ã${t}ãç´æ­é´åäº«å¤±è´¥ ${n} ${r}`)}catch(e){ki.warn(`åäº«ç´æ­é´ [${t}] å¼å¸¸ ${e.message}`)}var e}async function Bs(t){try{const{code:n,message:r,data:o}=await(e=t,ns.post("xlive/web-ucenter/v1/interact/likeInteract",{roomid:e,csrf:Vi.BILIJCT,csrf_token:Vi.BILIJCT}));if(0===n)return o;ki.info(`ã${t}ãç´æ­é´ç¹èµå¤±è´¥ ${n} ${r}`)}catch(t){ki.warn(`ç¹èµç´æ­é´å¼å¸¸ ${t.message}`)}var e}async function Ds(){const t=(e=await Us())&&0!==e.length?e.filter(xs):[];var e;for(let e=0;e<t.length;e++){const n=t[e];await Gs(n)}}async function Gs(t){const{room_info:e,anchor_info:n}=t;if(!e||!n)return;const{liveLike:r,liveSendMessage:o,liveShare:i}=Vi.intimacy,a=n.nick_name,s=e.room_id;o&&(As.verbose(`ã${a}ãå¼å§åéç´æ­å¼¹å¹`),await Ns(s,a)),i&&async function(){await na(100,300);for(let t=0;t<5;t++)As.verbose(`åäº« [${a}] ç´æ­é´`),await js(s),await na(4e3)}().catch((t=>ki.error(t))),r&&async function(){await na(100,300);for(let t=0;t<3;t++)As.verbose(`ç» [${a}] ç´æ­é´ç¹èµ`),await Bs(s),await na(6500)}().catch((t=>ki.error(t))),await na(22e3)}async function Ms(){try{const{data:t,message:e,code:n}=await us();if(0!==n)return void ki.warn(`è·åç¨æ·ä¿¡æ¯å¤±è´¥ï¼${n} ${e}`);!function(t){var e;Zi.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){ki.error(`è·åç¨æ·ä¿¡æ¯å¼å¸¸ï¼${t.message}`)}}var Fs;function qs(){const t=yi(),e=t.getDate(),n=function(t){const e=t||yi(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}(t),r=Vi.CHARGE_PRESET_TIME;return Zi.bCoinCouponBalance<2?(ki.info(`å©ä½å¸ä¸º${Zi.bCoinCouponBalance}ï¼ä¸è¶³2è·³è¿åçµ`),!1):n===e?(ki.info("ä»å¤©æ¯æåä¸å¤©äº"),!0):!(r>e)||(ki.info(`é¢è®¾æ¶é´ä¸º${r}ï¼ä¸ç¬¦åæ¡ä»¶`),!1)}async function Hs(){try{const{data:t,code:e,message:n}=await rs.get("/x/vip/privilege/my",{headers:{origin:oa,referer:ua}});if(0!==e)return void ki.info(`è·åé¢åç¶æå¤±è´¥ï¼${e} ${n}`);const{list:r}=t;return r.slice(0,2).filter((t=>{const e=parseInt(((new Date).getTime()/1e3).toString());return 0===t.state&&e>t.period_end_unix}))}catch(t){ki.error(`è·åé¢åç¶æåºç°å¼å¸¸ï¼${t.message}`)}}async function Ks(t){try{const e=function(t){switch(t){case 1:return"B å¸å¸";case 2:return"å¤§ä¼åä¼æ å¸";default:return""}}(t),{code:n,message:r}=await function(t=1){return rs.post("/x/vip/privilege/receive",{csrf:Vi.BILIJCT,type:t},{headers:{origin:ca,referer:ua}})}(t);let o="æå";return 0===n&&(o=`å¤±è´¥ ${r}`),ki.info(`é¢å${e} ${o}`),!0}catch(t){ki.error(`é¢åæçåºç°å¼å¸¸ï¼${t.message}`)}return!1}async function Js(t){let e=0,n=!1;for(;!(n||(n=await Ks(t),e>2));)e++;return n}!function(t){t[t["æå"]=4]="æå",t[t["ä½äº20çµæ± "]=-2]="ä½äº20çµæ± ",t[t["Bå¸ä¸è¶³"]=-4]="Bå¸ä¸è¶³"}(Fs||(Fs={}));let Ys=0;async function zs(){try{const{data:{list:t}}=await function(t=3394945){const e=(new Date).getTime();return ns.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(t.gift_id);return n&&e&&ki.info(`${t.gift_name} å³å°è¿æè¯·å°½å¿«æå`),!n&&e}))}catch(t){if(Ys)return null;await zs(),Ys++}}async function Qs(t){try{const{data:{live_room:e,name:n}}=await function(t){return rs.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await na(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function Ws(t,e,n,r){const o=Vi.BILIJCT,i={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:o,csrf_token:o};return rs.post("/x/esports/guess/add",i)}function Xs(){return Zi.money-Vi.MATCH_COINS<Vi.BILI_TARGET_COINS&&(ki.info(`éè¦ä¿ç${Vi.BILI_TARGET_COINS}ä¸ªç¡¬å¸ï¼ä»»å¡ç»æ`),!0)}async function Vs(){const{data:t,code:e}=await ls(1,1,0);if(0!==e)throw new Error(`è·åæåä¸ä¸ªå³æ³¨å¤±è´¥: ${e}`);return t[0]}async function Zs(t){const{data:e,code:n}=await rs.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));ki.warn(`è·ååç»åè¡¨å¤±è´¥: ${n}`)}async function tc(t){const e=await Zs(t);if(e)return e.tagid;await na(300);const{data:n,code:r,message:o}=await(i=t,rs.post("/x/relation/tag/create",{tag:i,jsonp:"jsonp",csrf:Vi.BILIJCT}));var i;if(22106===r){await na(300);const e=await Zs(t);return e&&e.tagid}return 0!==r&&ki.warn(`åå»ºåç»å¤±è´¥: ${r}-${o}`),n.tagid}async function ec(t,e="å¤©éæ¶å»"){if(0===t.length)return;const n=await tc(e);if(n)for(const e of t){const{code:t,message:r}=await ds(e.mid,n);0!==t&&ki.warn(`ç§»å¨ã${e.uname}ãå¤±è´¥: ${t}-${r}`),await na()}}async function nc(t,e,n,r=1){if(t.length>e.length)return;const{data:o,code:i,message:a}=await ls(r,20,0);if(0===i){for(const{mid:r,uname:i}of o){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(i))&&t.push({mid:r,uname:i})}if(!(o.length<20))return await nc(t,e,n,r+1)}else ki.warn(`è·åå³æ³¨ç¨æ·å¤±è´¥: ${i}-${a}`)}const rc=0,oc=1,ic=5,ac=1,sc=504,cc=1096;let uc;async function fc(){try{const{data:t,code:e,message:n}=await ns.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&ki.info(`è·åç´æ­ååºå¤±è´¥: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw ki.error(`è·åç´æ­ååºå¼å¸¸: ${t.message}`),t}}async function lc(t,e,n=1,r="lottery"){try{await na(100);const{data:o,code:i,message:a}=await function(t,e,n=1){return ns.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==i&&ki.info(`è·åç´æ­é´åè¡¨å¤±è´¥: ${i}-${a}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===sc?e.push(t):r.pendent_id===cc&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(o.list)["lottery"===r?"lotteryTime":"lotteryPacket"]}catch(t){throw ki.error(`è·åç´æ­é´åè¡¨å¼å¸¸: ${t.message}`),t}}async function dc(t,e,n=1){const r=await lc(t,e,n),o=[];for(const t of r){const e=await pc(t);e&&(o.push({...e,uid:t.uid,uname:t.uname}),await na(100))}return o}async function pc(t){const{blackUid:e}=Vi.lottery;if(e.includes(t.uid))return void ki.info(`è·³è¿é»ååç¨æ·: ${t.uname}`);let n,r,o;try{({data:r,code:n,message:o}=await cs(t.roomid))}catch(e){return void ki.info(`ç´æ­é´${t.roomid}æ£æµå¼å¸¸: ${e.message}`)}if(0!==n)return void ki.debug(`ç´æ­é´${t.roomid}æ£æµå¤±è´¥: ${n}-${o}`);if(null===r)return;const{excludeAward:i,includeAward:a}=Vi.lottery,s=i.some((t=>r.award_name.match(t)));if(a.some((t=>r.award_name.match(t)))||!s){if(r.status===ac&&!(r.gift_price>0))return 4===r.require_type&&(ki.info("æ¨è½åé¦ç»ä½èè¾åºäºä»ä¹åï¼"),ki.info(`${r.require_type}--${r.require_text}--${r.require_value}`),ki.info("ä¹è®¸è¿æ­£æ¯æä»¬æ³è¦çã")),r.require_type===ic&&Zi.userLevel>=r.require_value||r.require_type===rc?r:r.require_type!==oc||Vi.lottery.skipNeedFollow?void 0:r}else ki.info(`è·³è¿å±è½å¥å: ${r.award_name}`)}async function gc(t,e=!0){try{const{id:r,gift_id:o,gift_num:i,award_name:a,uid:s,uname:c,require_type:u,require_text:f}=t;ki.info(`å¤©éä¸»æ­ï¼ã${c}ã`),ki.info(`å¥åï¼${a}`);const{code:l,message:d}=await(n={id:r,gift_id:o,gift_num:i},ns.post("/xlive/lottery-interface/v1/Anchor/Join",{...n,csrf:Vi.BILIJCT,csrf_token:Vi.BILIJCT,visit_id:vi(),platform:"pc"}));if(0!==l)return void ki.info(`å¤©éå¤±è´¥: ${l}-${d}`);if(ki.info("å¤©éæå â"),u===oc&&e){bi(uc,s);(function(t){const e=(t=t.replace("å³æ³¨ä¸»æ­","")).split(/\s*\+\s*/);return e.shift(),e})(f).forEach((t=>bi(uc,t)))}}catch(t){ki.info(`å¤©éå¼å¸¸: ${t.message}`)}var n}async function mc(t,e,n=2){for(let r=1;r<=n;r++){const n=await dc(t,e,r);for(const t of n)await gc(t),await na(300)}}async function hc(t){try{const{data:e,code:n}=await function(t){return ns.get(`/xlive/lottery-interface/v1/lottery/getLotteryInfoWeb?roomid=${t}`)}(t);if(0!==n)return;const{popularity_red_pocket:r}=e;if(!r)return;const{lot_id:o,lot_status:i}=r[0];if(2===i)return;return o}catch(t){}}async function yc(t,e,n=1){const r=await lc(t,e,n,"redPack"),o=[];for(const t of r){const e=await hc(t.roomid);e&&(o.push({uid:t.uid,uname:t.uname,lot_id:e,room_id:t.roomid}),await na(100))}return o}async function wc(t){try{const{lot_id:n,uid:r,uname:o,room_id:i}=t;ki.info(`çº¢åä¸»æ­ï¼ã${o}ã`);const{code:a,message:s}=await(e={room_id:i,lot_id:n,ruid:r},ns.post("/xlive/lottery-interface/v1/popularityRedPocket/RedPocketDraw",{...e,spm_id:"444.8.red_envelope.extract",jump_from:"",session_id:"",csrf_token:Vi.BILIJCT,csrf:Vi.BILIJCT,visit_id:""}));if(0!==a)return void ki.info(`çº¢åå¤±è´¥: ${a}-${s}`);uc.push(r),ki.info("çº¢åæå â")}catch(t){ki.info(`çº¢åå¼å¸¸: ${t.message}`)}var e}async function _c(t,e,n=2){for(let r=1;r<=n;r++){const n=await yc(t,e,r);for(const t of n)await wc(t),await na(200)}}async function vc(){const t=[];return await async function e(n=1){try{var r;const{data:o,code:i,message:a}=await function(t=1,e=9){return ns.get(`/xlive/web-ucenter/user/following?page=${t}}&page_size=${e}`)}(n,9);if(0!==i)return void ki.info(`è·åå³æ³¨ç´æ­é´å¤±è´¥: ${i}-${a}`);const s=null===(r=o.list)||void 0===r?void 0:r.filter((t=>1===t.live_status));if(9===s.length&&n<o.totalPage)return t.push(...s),e(n+1);t.push(...s)}catch(t){ki.error(`è·åå³æ³¨ç´æ­é´å¼å¸¸: ${t.message}`)}}(),t}async function bc(t){try{const{code:e,message:n,data:r}=await cs(t.roomid);if(0!==e)return void ki.debug(`ç´æ­é´${t.roomid}æ£æµå¤±è´¥: ${e}-${n}`);if(null===r)return;if(r.status!==ac)return;if(r.gift_price>0)return;return r}catch(e){return void ki.info(`ç´æ­é´${t.roomid}æ£æµå¼å¸¸: ${e.message}`)}}async function $c(){const{scanFollow:t}=Vi.lottery;if(!t)return!0;try{ki.info("å¼å§æ«æå³æ³¨çä¸»æ­");const t=await async function(){const t=await vc(),e=[];for(const n of t){const t=await bc(n);t&&e.push({...t,uid:n.uid,uname:n.uname}),await na(100)}return e}();for(const e of t)await gc(e,!1),await na(300);ki.info("å³æ³¨çä¸»æ­å¤©éå®æ")}catch(t){ki.error(`å³æ³¨çä¸»æ­å¤©éå¼å¸¸: ${t.message}`)}return"only"!==t}async function Tc(t){try{const{code:e,message:n,data:r}=await function({session_type:t}={session_type:1}){return is.get(`/session_svr/v1/session_svr/get_sessions?session_type=${t}&group_fold=1&unfollow_fold=1&sort_rule=2&build=0&mobi_app=web`)}();if(0!==e)return void ki.warn(`è·åä¼è¯å¤±è´¥ï¼${e}-${n}`);const{session_list:o}=r;if(o.length<=0)return;return o.filter((({unread_count:e,talker_id:n,is_follow:r,last_msg:o})=>{return t.find((t=>t.mid===n))&&e>0&&n===o.sender_uid&&1===r&&(i=o.timestamp,Date.now()-1e3*i<36e5);var i}))}catch(t){ki.error(`è·åä¼è¯å¼å¸¸ï¼${t.message}`)}}async function Ic(t){const e=await Tc(t);await na(200);try{for(let t=0;t<e.length;t++){const n=e[t];await Sc(n)}}catch(t){ki.error(`æ´æ°ä¼è¯å¼å¸¸ï¼${t.message}`)}e.length>=19&&await Ic(t)}async function Sc(t){switch(Vi.lottery.actFollowMsg){case"del":case"delete":await function({talker_id:t,session_type:e}){return is.post("/session_svr/v1/session_svr/remove_session",{talker_id:t,session_type:e,build:0,mobi_app:"web",csrf_token:Vi.BILIJCT,csrf:Vi.BILIJCT})}(t);break;case"read":await function({talker_id:t,session_type:e,ack_seqno:n}){return is.post("/session_svr/v1/session_svr/update_ack",{talker_id:t,session_type:e,ack_seqno:n,build:0,mobi_app:"web",csrf_token:Vi.BILIJCT,csrf:Vi.BILIJCT},{headers:{origin:sa}})}(t)}await na(50)}var Oc={taskReward:async function(){ki.info("----ãæ¯æ¥ä»»å¡å®ææåµã----");try{const{data:t,message:e,code:n}=await rs.get("/x/member/web/exp/reward");await na();const{data:r}=await fs();if(0!=n)return void ki.warn(`ç¶æè·åå¤±è´¥: ${n} ${e}`);const o=Zi.money-Vi.BILI_STAY_COINS;let i=0;0===Zi.coinsTask?ki.info(`ä»æ¥æå¸è·åç»éª: ${r}ï¼è¿éæå¸0é¢ï¼ç»éªå¤äºï¼ä¸æ³æäº`):o<=0?ki.info(`ä»æ¥æå¸è·åç»éª: ${r}ï¼è¿éæå¸0é¢ï¼ç¡¬å¸ä¸å¤äºï¼ä¸æå¸äº`):o<Zi.coinsTask?(i=Zi.coinsTask-o,ki.info(`æå¸è·åç»éª: ${r}ï¼è¿éæå¸æ°é: ${i}é¢;(ç®æ ${Zi.coinsTask}é¢ï¼å¿½ç¥é¨åæå¸)`)):(i=Zi.coinsTask-r/10,ki.info(`æå¸è·åç»éª: ${r}ï¼è¿éæå¸æ°é: ${i}é¢;(ç®æ ${Zi.coinsTask}é¢)`)),Zi.coinsTask=i,ki.info("æ¯æ¥åäº«: "+(t.share?"å·²å®æ":"[æªå®æ]")),ki.info("æ¯æ¥æ­æ¾: "+(t.watch?"å·²å®æ":"[æªå®æ]")),Zi.share=t.share,Zi.watch=t.watch}catch(t){ki.error(`ç¶æè·åå¼å¸¸ ${t.message}`)}},liveSignTask:async function(){ki.info("----ãç´æ­ç­¾å°ã----");try{const{data:t}=await ns.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return ki.info("å·²ç­¾å°ï¼è·³è¿ç­¾å°"),void ki.info(`å·²ç»ç­¾å°${t.hadSignDays}å¤©ï¼${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await ns.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?ki.info(`ç´æ­ç­¾å°æå: ${e.text}ï¼ç¹å«ä¿¡æ¯: ${e.specialText}ï¼æ¬æç­¾å°å¤©æ°: ${e.hadSignDays}å¤©;`):ki.warn(`ç´æ­ç­¾å°å¤±è´¥: ${t} ${n}`)}catch(t){ki.error(`ç´æ­ç­¾å°å¼å¸¸: ${t.message}`)}},shareAndWatch:async function(){if(ki.info("----ãåäº«/æ­æ¾è§é¢ã----"),Zi.share&&Zi.watch)return void ki.info("å·²å®æï¼è·³è¿åäº«/æ­æ¾");let t=0;try{let e=await Cs();if("-1"===e.msg&&(e=await bs()),"0"!==e.msg)return ki.warn(`è·åè§é¢å¤±è´¥ ${e.msg}`),!1;{const{id:n,author:r,title:o}=e.data;t=n,ki.info(`è·åè§é¢: ${o} --upã${r}ã`)}}catch(t){return ki.error(`è·åè§é¢åºç°å¼å¸¸: ${t.message}`),!1}if(!Zi.share){await na();try{const{code:e,message:n}=await function(t){const e={csrf:Vi.BILIJCT,aid:t};return rs.post("/x/web-interface/share/add",e)}(t);0===e?ki.info("åäº«è§é¢æå!"):ki.warn(`åäº«è§é¢å¤±è´¥: ${e} ${n}`)}catch(t){ki.error(`åäº«è§é¢å¼å¸¸: ${t.message}`)}}if(!Zi.watch){await na();try{const{code:r,message:o}=await(e=t,n=_i(4,60),rs.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?ki.info("æ­æ¾è§é¢æå!"):ki.warn(`æ­æ¾è§é¢å¤±è´¥: ${r} ${o}`)}catch(t){ki.error(`æ­æ¾è§é¢å¼å¸¸: ${t.message}`)}}var e,n},silver2Coin:async function(){ki.info("----ãé¶çå­åæ¢ç¡¬å¸ã----");try{const{data:t,code:e,message:n}=await ns.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&ki.info(`è·åçå­è¯¦æå¤±è´¥ ${n}`),0===t.silver_2_coin_left)ki.info("ä»æ¥å·²åæ¢ä¸æ¬¡");else if(t.silver<700)ki.info("åæ¢å¤±è´¥ï¼ä½ çå­ä¸å¤äº");else{const{message:t}=await ns.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:Vi.BILIJCT,csrf:Vi.BILIJCT});ki.info(`åæ¢ç¡¬å¸ï¼ ${t}`),await ns.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){ki.error(`æä½å¼å¸¸ ${t.message}`)}},addCoins:async function(){if(ki.info("----ãè§é¢æå¸ã----"),!Zi.coinsTask)return void ki.info("è·³è¿æå¸ï¼ä»æ¥å·²å®æ");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;Zi.coinsTask&&!e&&t.eCount<5;)e=await Ls(t);t.eCount>=5&&ki.info("åºç°å¼å¸¸/éè¯¯5æ¬¡ï¼èªå¨éåºæå¸"),ki.info(`ä¸å±æåæå¸${t.num}é¢`),ki.info(`ç¡¬å¸è¿å©${Zi.money}é¢`)},mangaSign:async function(){ki.info("----ãæ¼«ç»ç­¾å°ã----");try{const{code:t}=await function(t="android"){return os.post("/twirp/activity.v1.Activity/ClockIn",{platform:t})}();0==t?ki.info("æ¼«ç»ç­¾å°æå"):ki.warn("æ¼«ç»ç­¾å°å¤±è´¥")}catch(e){var t;400===(null===(t=e.response)||void 0===t?void 0:t.status)?ki.info("å·²ç»ç­¾å°è¿äºï¼è·³è¿ä»»å¡"):ki.error(`æ¼«ç»ç­¾å°å¼å¸¸ ${e.message}`)}},supGroupSign:async function(){ki.info("----ãåºæ´å¢ç­¾å°ã----");const t=await ks();await na();let e=0;for(let o=0;o<t.length;){const i=t[o];try{const{data:t,code:o,message:a}=await(n=i.group_id,r=i.owner_uid,is.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===o?0===t.status?e++:ki.info(a):ki.warn(`[${i.group_name}]ç­¾å°å¤±è´¥ ${a}`)}catch(t){ki.error(`ç­¾å°å¼å¸¸ ${t.message}`)}finally{await na()}}var n,r;ki.info(`ç­¾å°ç»æï¼æå${e}/${t.length}`)},liveSendMessage:async function(){ki.info("----ãåéç´æ­å¼¹å¹ã----"),ki.info("è¯¥å½æ°å³å°åºå¼ï¼è¯·ä½¿ç¨ liveIntimacy æ¿ä»£");try{const t=await Us(),e=t.length;let n=0,r=0;ki.info(`ä¸å±éè¦åé${e}ä¸ªç´æ­é´`),ki.verbose("æéæ¶é´å¯è½å¾é¿ï¼è¯·èå¿ç­å¾");for(let o=0;o<e;o++){const{room_info:i,anchor_info:a,medal:s}=t[o];null!=i&&i.room_id?100===s.today_feed||s.level>=20?r++:(await Ns(i.room_id,a.nick_name)&&n++,o<e-1&&await na(_i(1e4,25e3))):(ki.info(`ã${a.nick_name}ãæ²¡æç´æ­é´å¦`),r++)}ki.info(`æååé${n}ä¸ªå¼¹å¹ï¼è·³è¿${r}ä¸ª`)}catch(t){ki.error(`ç´æ­é´åéå¼¹å¹å¼å¸¸: ${t.message}`)}},charging:async function(){if(ki.info("----ãç»ç®æ åçµã----"),await Ms(),await na(),qs())try{const t=Zi.bCoinCouponBalance||0,e=Vi.CHARGE_ID;let n=0;ki.info(`b å¸å¸ä½é¢${t}`);const r=async()=>{const{code:n,message:r,data:o}=await function(t=50,e=!0,n=Vi.USERID,r="up",o=n){return rs.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:Vi.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:o})}(t,!0,e);0===n?(ki.info(`ãåå¼ç»æã${Fs[o.status]}`),o.status===Fs["æå"]&&(Zi.chargeOrderNo=o.order_no,await na(),await async function(){try{if(!Zi.chargeOrderNo)return!1;const t=li[_i(0,li.length-1)],{code:e}=await function(t,e="æ¯æå¤§ä½¬ä¸æ³¢"){return rs.post("/x/ugcpay/trade/elec/message",{csrf:Vi.BILIJCT,message:e,order_id:t})}(Zi.chargeOrderNo,t);0===e&&ki.info("çè¨æåï¼")}catch{}}())):ki.warn(`åçµå¤±è´¥ï¼${n} ${r}`)};for(Zi.chargeOrderNo="";!(Zi.chargeOrderNo||(await r(),await na(),n++>2)););}catch(t){ki.error(`åçµåºç°å¼å¸¸ï¼${t.message}`)}},getVipPrivilege:async function(){try{if(ki.info("----ãé¢åå¤§ä¼åæçã----"),2!==Zi.vipType)return ki.info("è´¦å·éå¹´åº¦å¤§ä¼åï¼ä¸éè¦é¢åæç"),!1;const t=await Hs();if(0===t.length)return void ki.info("å·²ç»é¢åè¿æçï¼ä¸éè¦åé¢å");for(let e=0;e<t.length;e++){const n=t[e];await Js(n.type)}}catch(t){ki.error(`é¢åå¤§ä¼åæçåºç°å¼å¸¸ï¼${t.message}`)}},giveGift:async function(){ki.info("----ãæåè¿æé£ç©ã----");try{const t=await zs();if(await na(),null==t||!t.length)return void ki.info("æ²¡æ2å¤©åè¿æçç®åç¤¼ç©");const e=await async function(){const t=Object.assign([],Vi.BILI_GIFT_UP),e=()=>t.splice(_i(Vi.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await Qs(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await function(t=1,e=10){return t>10&&(t=10),ns.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}();if(await na(),!t)return;const n=e[_i(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void ki.info("æ²¡ææ¾å°æåç®æ ");await async function({roomid:t,mid:e,name:n},r){for(const o of r){await na();try{const{code:r,message:i,data:a}=await ss({roomid:t,ruid:e,bag_id:o.bag_id,gift_id:o.gift_id,gift_num:o.gift_num});if(0!==r){ki.warn(`å[${n}]æå[${o.gift_name}]ï¼${i}`);continue}a.gift_list.forEach((t=>{ki.info(`æåç» [${n}] æå${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){ki.info(`æåè¿æé£ç©å¼å¸¸ ${t}`)}},matchGame:async function(){if(ki.info("----ãèµäºç¡¬å¸ç«çã----"),Vi.MATCH_COINS<=0)return void ki.info("ç¡¬å¸æ°éä¸è½å°äº 0");if(Xs())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:r}}=await function(t="",e=""){return rs.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`)}();return 0!==t?void ki.warn(`è·åèµäºéè¯¯ ${t} ${e}`):0===r.total?(ki.info("ä»æ¥å·²ç»æ æ³è·åèµäº"),null):n}catch(t){}}();if(await na(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,o=t.id,[{id:i,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(Xs())return e;if(c)continue;ki.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=Vi.MATCH_SELECTION>0?l?f:u:l?u:f,ki.info(`é¢æµ[ ${d.option} ] ${Vi.MATCH_COINS} é¢ç¡¬å¸`),await na();const{code:p}=await Ws(o,i,d.detail_id,Vi.MATCH_COINS);0!==p?ki.info("é¢æµå¤±è´¥"):(e++,Zi.money-=Vi.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:o}]=n;if(o)return!1;const[i,a]=r;return Math.abs(i.odds-a.odds)>=e}))}(t,Vi.MATCH_DIFF));ki.info(`ãç«çç»æãä¸å±åä¸${e}æ¬¡é¢æµ`)},liveLottery:async function(){ki.info("----ãå¤©éæ¶å»ã----");const t=await $c();if(!t)return t;try{const t=await Vs();ki.info(`æåä¸ä¸ªå³æ³¨çUP: ${t.uname}`);const e=await async function(){uc=[];const{pageNum:t}=Vi.lottery,e=await fc();for(const n of e)for(const e of n)await mc(e.areaId,e.parentId,t);return uc}();ki.info("æ«æå®æ");const n=[];await nc(n,e,null==t?void 0:t.mid),await ec(n),ki.info("ç§»å¨å³æ³¨UPå°åç»æå")}catch(t){ki.warn(`å¤©éæ¶å»å¼å¸¸: ${t.message}`),ki.debug(t)}ki.info("ç»æå¤©éæ¶å»")},liveRedPack:async function(){ki.info("----ãå¤©éçº¢åã----");try{const t=await Vs();ki.info(`æåä¸ä¸ªå³æ³¨çUP: ${t.uname}`);const e=await async function(){uc=[];const{pageNum:t}=Vi.lottery,e=await fc();for(const n of e)for(const e of n)await _c(e.areaId,e.parentId,t);return uc}();ki.info("æ«æå®æï¼è·åæ°å³æ³¨çUP");const n=[];await nc(n,e,null==t?void 0:t.mid),ki.info("å¼å§è¯»åæ¶æ¯"),await Ic(n),ki.info("ç§»å¨å³æ³¨UPå°åç»"),await ec(n),ki.info("ç§»å¨å³æ³¨UPå°åç»æå")}catch(t){ki.warn(`å¤©éæ¶å»å¼å¸¸: ${t.message}`),ki.debug(t)}ki.info("ç»æå¤©éçº¢å")},liveIntimacy:async function(){ki.info("----ãç´æ­äº²å¯åº¦ã----");try{await Ds(),ki.info("ç´æ­äº²å¯åº¦å®æ")}catch(t){ki.error(`ç´æ­äº²å¯åº¦: ${t.message}`)}}};var Ec=!y((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Cc=qt,Pc=W,Lc=Gt,kc=Ec,Rc=hn("IE_PROTO"),Ac=Object,Uc=Ac.prototype,xc=kc?Ac.getPrototypeOf:function(t){var e=Lc(t);if(Cc(e,Rc))return e[Rc];var n=e.constructor;return Pc(n)&&e instanceof n?n.prototype:e instanceof Ac?Uc:null},Nc={},jc=_r,Bc=vr,Dc=Object.keys||function(t){return jc(t,Bc)},Gc=w,Mc=Re,Fc=ke,qc=Ne,Hc=Q,Kc=Dc;Nc.f=Gc&&!Mc?Object.defineProperties:function(t,e){qc(t);for(var n,r=Hc(e),o=Kc(e),i=o.length,a=0;i>a;)Fc.f(t,n=o[a++],r[n]);return t};var Jc,Yc=nt("document","documentElement"),zc=Ne,Qc=Nc,Wc=vr,Xc=yn,Vc=Yc,Zc=_e,tu=hn("IE_PROTO"),eu=function(){},nu=function(t){return"<script>"+t+"<\/script>"},ru=function(t){t.write(nu("")),t.close();var e=t.parentWindow.Object;return t=null,e},ou=function(){try{Jc=new ActiveXObject("htmlfile")}catch(t){}var t,e;ou="undefined"!=typeof document?document.domain&&Jc?ru(Jc):((e=Zc("iframe")).style.display="none",Vc.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(nu("document.F=Object")),t.close(),t.F):ru(Jc);for(var n=Wc.length;n--;)delete ou.prototype[Wc[n]];return ou()};Xc[tu]=!0;var iu=Object.create||function(t,e){var n;return null!==t?(eu.prototype=zc(t),n=new eu,eu.prototype=null,n[tu]=t):n=ou(),void 0===e?n:Qc.f(n,e)},au=It,su=_,cu=x(x.bind),uu={},fu=uu,lu=ie("iterator"),du=Array.prototype,pu=Eo,gu=Ot,mu=uu,hu=ie("iterator"),yu=function(t){if(null!=t)return gu(t,hu)||gu(t,"@@iterator")||mu[pu(t)]},wu=$,_u=It,vu=Ne,bu=vt,$u=yu,Tu=TypeError,Iu=$,Su=Ne,Ou=Ot,Eu=function(t,e){return au(t),void 0===e?t:su?cu(t,e):function(){return t.apply(e,arguments)}},Cu=$,Pu=Ne,Lu=vt,ku=function(t){return void 0!==t&&(fu.Array===t||du[lu]===t)},Ru=cr,Au=rt,Uu=function(t,e){var n=arguments.length<2?$u(t):e;if(_u(n))return vu(wu(n,t));throw Tu(bu(t)+" is not iterable")},xu=yu,Nu=function(t,e,n){var r,o;Su(t);try{if(!(r=Ou(t,"return"))){if("throw"===e)throw n;return n}r=Iu(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return Su(r),n},ju=TypeError,Bu=function(t,e){this.stopped=t,this.result=e},Du=Bu.prototype,Gu=function(t,e,n){var r,o,i,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=Eu(e,f),m=function(t){return r&&Nu(r,"normal",t),new Bu(!0,t)},h=function(t){return l?(Pu(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(o=xu(t)))throw ju(Lu(t)+" is not iterable");if(ku(o)){for(i=0,a=Ru(t);a>i;i++)if((s=h(t[i]))&&Au(Du,s))return s;return new Bu(!1)}r=Uu(t,o)}for(c=r.next;!(u=Cu(c,r)).done;){try{s=h(u.value)}catch(t){Nu(r,"throw",t)}if("object"==typeof s&&s&&Au(Du,s))return s}return new Bu(!1)},Mu=Xr,Fu=rt,qu=xc,Hu=mo,Ku=Ur,Ju=iu,Yu=Ye,zu=P,Qu=Go,Wu=Uo,Xu=Gu,Vu=ko,Zu=Fo,tf=ie("toStringTag"),ef=Error,nf=[].push,rf=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,o=Fu(of,this);Hu?n=Hu(new ef,o?qu(this):of):(n=o?this:Ju(of),Yu(n,tf,"Error")),void 0!==e&&Yu(n,"message",Vu(e)),Zu&&Yu(n,"stack",Qu(n.stack,1)),Wu(n,r);var i=[];return Xu(t,nf,{that:i}),Yu(n,"errors",i),n};Hu?Hu(rf,ef):Ku(rf,ef,{name:!0});var of=rf.prototype=Ju(ef.prototype,{constructor:zu(1,rf),message:zu(1,""),name:zu(1,"AggregateError")});Mu({global:!0,constructor:!0,arity:2},{AggregateError:rf});var af={},sf=It,cf=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=sf(e),this.reject=sf(n)};af.f=function(t){return new cf(t)};var uf=$,ff=It,lf=nt,df=af,pf=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},gf=Gu;Xr({target:"Promise",stat:!0},{any:function(t){var e=this,n=lf("AggregateError"),r=df.f(e),o=r.resolve,i=r.reject,a=pf((function(){var r=ff(e.resolve),a=[],s=0,c=1,u=!1;gf(t,(function(t){var f=s++,l=!1;c++,uf(r,e,t).then((function(t){l||u||(u=!0,o(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||i(new n(a,"No one promise resolved")))}))})),--c||i(new n(a,"No one promise resolved"))}));return a.error&&i(a.value),r.promise}}),ki.info("å¼å§æ§è¡ç½ç»ä»£ç "),ki.info("å½åçæ¬ãv0.5.1ã"),async function(t,...e){Li.pushValue="";try{await async function(){ki.info("----ãç»å½ã----");const{data:t,message:e,code:n}=await us();if(0!==n)throw ki.error(`ç»å½éè¯¯ ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("æ¥å£è¿åä¸ºæªç»å½");await na(),await gs(t)}()}catch(t){return ki.error(`ç»å½å¤±è´¥: ${t}`),await ts("ç»å½å¤±è´¥",Li.pushValue),"æªå®æ"}const n=ea([...Object.values(Oc)]);for(const t of n)try{await t()}catch(e){ki.error(`${t.name}å¤±è´¥: ${e}`)}finally{await na()}return t&&await t(...e),await ts("æ¯æ¥å®æ",Li.pushValue),"å®æ"}().then((t=>{VMThis.message=t,VMThis.resolve(t)})).catch((t=>{VMThis.error=t,VMThis.reject(t)}));
